{"version":3,"sources":["utils/async-save-text.js"],"names":["$","click_to_edit_elt","text_elt_id","save_url","text_parm_name","num_cols","use_textarea","num_rows","on_start","on_finish","undefined","click","length","t","text_elt","old_text","text","attr","rows","cols","trim","value","blur","remove","show","keyup","e","keyCode","this","ajax_data","val","url","data","success","processed_text","hide","insertAfter"],"mappings":"oIAGIA,uDAAAA,kBAKJ,SACIC,EACAC,EACAC,EACAC,EACAC,EACAC,EAbHC,EAeGC,EAbJC,QAiBqBC,IAAbL,IACAA,EAAW,SAFfK,IAAAH,IACAA,EAAIF,GAIAE,EAAAA,IAAAA,GAAAI,MAAA,WAMA,KAAIX,EAAE,oBAAoBY,OAAS,GAAnC,CADA,IAEIC,EAFJC,EAAAd,EAAAA,IAAAE,GACAa,EAAMD,EAAAE,QAINH,EADAP,EACIS,EAAAA,yBACJE,MAAAC,KAAAX,EAAAY,KAAAd,IAKSW,KAAKhB,EAAEoB,KAAKL,IAFjBF,EAAAA,+BACKI,MAFTI,MAIOrB,EAAAoB,KAAAL,GACHF,KAAMR,KAAoCY,KAAA,KAA1C,mBAIHJ,EAAAS,KAAA,WACDT,EAAEI,MAAKM,SACPV,EAAOW,OACHxB,GACAc,EAASU,KAGRX,EAAAY,MAAA,SAAAC,GACJ,GAND,KAAAA,EAAAC,QAQI3B,EAAA4B,MAAMD,QAAF,aACA,GAAA,KAAAD,EAAAC,QAAA,CAEH,IAHDE,KAIIA,EAAAzB,GAAAJ,EAAA4B,MAAAE,MACA9B,EAAA4B,MAAIC,QAAAA,QACJA,EAAAA,MACA7B,IAAEG,EACFH,KAAA6B,EACIE,MAAAA,WACAC,MAAAA,wBAFG9B,EAEH8B,YAGIC,QAAA,SAAAC,GAEK,KAATD,EACInB,EAAAE,KAAAkB,GAEIpB,EAAAA,KAASE,iBAETF,GACHL,EAAAI,SAOhBL,GAGGA,EAASK,GACZC,EAAAqB,OACDtB,EAAAuB,YAAAtB,GACAA,EAAAA,QACAD,EAAAA","file":"../../scripts/utils/async-save-text.js","sourcesContent":["import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n// ============================================================================\n/**\n * Edit and save text asynchronously.\n */\nfunction async_save_text(\n    click_to_edit_elt,\n    text_elt_id,\n    save_url,\n    text_parm_name,\n    num_cols,\n    use_textarea,\n    num_rows,\n    on_start,\n    on_finish\n) {\n    // Set defaults if necessary.\n    if (num_cols === undefined) {\n        num_cols = 30;\n    }\n    if (num_rows === undefined) {\n        num_rows = 4;\n    }\n\n    // Set up input element.\n    $(`#${click_to_edit_elt}`).click(() => {\n        // Check if this is already active\n        if ($(\"#renaming-active\").length > 0) {\n            return;\n        }\n        var text_elt = $(`#${text_elt_id}`);\n        var old_text = text_elt.text();\n        var t;\n\n        if (use_textarea) {\n            t = $(\"<textarea></textarea>\")\n                .attr({ rows: num_rows, cols: num_cols })\n                .text($.trim(old_text));\n        } else {\n            t = $(\"<input type='text'></input>\").attr({\n                value: $.trim(old_text),\n                size: num_cols\n            });\n        }\n        t.attr(\"id\", \"renaming-active\");\n        t.blur(function() {\n            $(this).remove();\n            text_elt.show();\n            if (on_finish) {\n                on_finish(t);\n            }\n        });\n        t.keyup(function(e) {\n            if (e.keyCode === 27) {\n                // Escape key\n                $(this).trigger(\"blur\");\n            } else if (e.keyCode === 13) {\n                // Enter key submits\n                var ajax_data = {};\n                ajax_data[text_parm_name] = $(this).val();\n                $(this).trigger(\"blur\");\n                $.ajax({\n                    url: save_url,\n                    data: ajax_data,\n                    error: function() {\n                        alert(`Text editing for elt ${text_elt_id} failed`);\n                        // TODO: call finish or no? For now, let's not because error occurred.\n                    },\n                    success: function(processed_text) {\n                        // Set new text and call finish method.\n                        if (processed_text !== \"\") {\n                            text_elt.text(processed_text);\n                        } else {\n                            text_elt.html(\"<em>None</em>\");\n                        }\n                        if (on_finish) {\n                            on_finish(t);\n                        }\n                    }\n                });\n            }\n        });\n\n        if (on_start) {\n            on_start(t);\n        }\n        // Replace text with input object and focus & select.\n        text_elt.hide();\n        t.insertAfter(text_elt);\n        t.focus();\n        t.select();\n\n        return;\n    });\n}\n\n// ============================================================================\nexport default async_save_text;\n"]}