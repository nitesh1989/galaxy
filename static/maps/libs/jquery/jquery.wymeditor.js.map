{"version":3,"sources":["libs/jquery/jquery.wymeditor.js"],"names":["WYMeditor","console","firebug","i","length","names","window","jQuery","extend","VERSION","INSTANCES","STRINGS","SKINS","NAME","INDEX","WYM_INDEX","BASE_PATH","CSS_PATH","WYM_PATH","SKINS_DEFAULT_PATH","SKINS_DEFAULT_CSS","SKINS_DEFAULT_JS","LANG_DEFAULT_PATH","IFRAME_BASE_PATH","IFRAME_DEFAULT","JQUERY_PATH","DIRECTION","LOGO","TOOLS","TOOLS_ITEMS","TOOL_NAME","TOOL_TITLE","TOOL_CLASS","CLASSES","CLASSES_ITEMS","CLASS_NAME","CLASS_TITLE","CONTAINERS","CONTAINERS_ITEMS","CONTAINER_NAME","CONTAINER_TITLE","CONTAINER_CLASS","HTML","IFRAME","STATUS","DIALOG_TITLE","DIALOG_BODY","STRING","BODY","DIV","P","H1","H2","H3","H4","H5","H6","PRE","BLOCKQUOTE","A","BR","IMG","TABLE","TD","TH","UL","OL","LI","CLASS","HREF","SRC","TITLE","ALT","DIALOG_LINK","DIALOG_IMAGE","DIALOG_TABLE","DIALOG_PASTE","BOLD","ITALIC","CREATE_LINK","INSERT_IMAGE","INSERT_TABLE","INSERT_HTML","PASTE","INDENT","OUTDENT","TOGGLE_HTML","FORMAT_BLOCK","PREVIEW","INSERT_UNORDEREDLIST","Array","BLOCKS","MAIN_CONTAINERS","KEY","BACKSPACE","ENTER","END","HOME","LEFT","UP","RIGHT","DOWN","CURSOR","DELETE","NODE","ELEMENT","ATTRIBUTE","TEXT","editor","elem","options","this","_index","push","_options","html","basePath","skinPath","_html","jQueryPath","skin","wymPath","computeWymPath","langPath","iframeBasePath","computeJqueryPath","init","fn","wymeditor","initSkin","styles","stylesheet","editorStyles","toolsHtml","toolsItemHtml","toolsItems","containersHtml","containersItems","classesItemHtml","logoHtml","htmlHtml","htmlSelector","toolSelector","classSelector","hrefSelector","srcSelector","textSelector","dialogTypeSelector","title","css","dialogLinkSelector","dialogImageSelector","dialogTableSelector","dialogPasteSelector","dialogPreviewSelector","name","updateSelector","updateEvent","dialogFeatures","dialogFeaturesPreview","dialogHtml","dialogLinkHtml","dialogImageHtml","dialogTableHtml","dialogPasteHtml","preBind","wymeditors","classesHtml","classesItems","statusHtml","msie","browser","boxSelector","toolsSelector","toolsListSelector","containersSelector","classesSelector","isFunction","iframeSelector","iframeBodySelector","SaxListener","containerSelector","htmlValSelector","configureEditorUsingRawCss","titleSelector","altSelector","rowsSelector","WymClass","colsSelector","captionSelector","summarySelector","submitSelector","cancelSelector","previewSelector","_element","Helper","iframeHtml","replaceAll","boxHtml","oTool","eval","toggleClass","dialogPreviewHtml","dialogStyles","stringDelimiterLeft","stringDelimiterRight","preInit","postInit","preInitDialog","postInitDialog","container","cmd","WymClassExplorer","mozilla","prototype","sType","opera","WymClassOpera","toLowerCase","safari","chrome","WymClassSafari","XhtmlSaxListener","parser","aTypes","XmlHelper","prop","_box","hide","after","next","addClass","data","get","newNode","h","blockquote","appendChild","nodes","childNodes","lgt","firstNode","aTools","switchTo","update","sTool","sTools","jqexpr","parentsOrSelf","attr","oClass","aClasses","sClass","sClasses","tagname","tagName","sContainers","aContainers","oContainer","filter","node","parentNode","containersItemHtml","sContainer","bFound","replaceStrings","find","loadSkin","bindEvents","click","wym","setFocusToNode","focus","exec","lang","keyup","_doc","body","val","blur","sVal","encloseString","sName","expr","contentWindow","status","bind","ready","wDialog","box","sBodyHtml","xhtml","dialog","doc","write","close","toggleHtml","is","listen","now","Date","getTime","_exec","selected","sTmp","append","findUp","paste","_iframe","getSelection","focusNode","styleSheets","createElement","insertBefore","oCss","aCss","firstChild","computeBasePath","item","grep","src","removeChild","_selected_image","CssParser","WymCssParser","removeAttr","_class","_typeof","stopPropagation","link","href","head","replaceChild","ajax","url","responseText","e","error","key","each","match","sMessage","statusSelector","dialogType","sStamp","uniqueStamp","not","features","_wym","open","addCssRules","direction","document","toggle","sData","aP","split","_newLine","rExp","sCaption","newCaption","table","createCaption","innerHTML","x","newRow","insertRow","replace","insert","wrap","left","right","toString","unwrap","_entitiesDiv","addCssRule","s","computeCssPath","parse","async","css_settings","tagOptions","mousedown","images","getElementsByTagName","evt","escapeOnce","_fixDoubleEscape","escapeEntities","loadCss","rel","formated_options","shift","found","RegExp","_formated_options","result","parseAttributes","INIT_DIALOG","index","value","delimiter","tag_attributes","sUrl","iRows","iCols","y","insertCell","sText","tag","contentTag","content","cdataSection","xml","escaped","parseInt","pop","string","escape_quotes","textContent","matches","k","v","re","charAt","XhtmlValidator","_attributes","core","except","attributes","language","dir","0","1","keyboard","accesskey","tabindex","_events","only","skiped_attribute_values","getValidTagAttributes","form","valid_attributes","getUniqueAttributesAndEventsForTag","getDefaultAttributesAndEventsForTags","isValidTag","mouse","getDefaultAttributesAndEventsForTag","default_attributes","_tags","doesAttributeNeedsValidation","2","3","4","rev","getPossibleTagAttributes","5","area","nohref","shape","required","base","bdo","count","6","button","disabled","type","inside","_patterns","7","8","9","col","align","span","valign","colgroup","ParallelRegex","10","_regex","del","datetime","11","regex","12","13","14","15","fieldset","method","16","_stack","17","18","19","20","21","22","23","img","checked","maxlength","LEXER_ENTER","LEXER_MATCHED","LEXER_UNMATCHED","LEXER_EXIT","LEXER_SPECIAL","ins","24","label","start","25","_regexes","26","_parser","media","map","mode","meta","http-equiv","27","object","28","optgroup","option","29","valuetype","_mode_handlers","30","q","31","script","defer","select","parsed","raw","unmatched","matched","_dispatchTokens","32","33","34","style","35","36","frame","rules","td","_isSpecialMode","_mode","colspan","rowspan","scope","enter","textarea","tfoot","th","Lexer","thead","test","37","handler","tr","38","39","40","skiped_attributes","action","attribute","unparsed_character_count","unparsed","substr","substring","contains","possible_attributes","validateAttribute","mapHandler","addTokens","addCommentTokens","addScriptTokens","addTagTokens","XhtmlLexer","addExitPattern","addSpecialPattern","addEntryPattern","addInTagDeclarationTokens","defaults","default_attributes_and_events","tag_defaults","addPattern","XhtmlParser","_Listener","concat","_last_match","case_sensitive","_labels","Comment","_addNonTagBlock","subject","_getCompoundedRegex","_callOpenTagListener","_tag_attributes","_untokenizeRegex","_tokenizeRegex","_callCloseTagListener","normalizeTag","_getPerlMatchingFlags","isBlockTag","_increaseOpenTagCounter","isInlineTag","autoCloseUnclosedBeforeTagClosing","expected_tag","last_tag_opened","StateStack","getCurrent","_autoCloseUnclosed","state","leave","_current_attribute","output","helper","_open_tags","validator","_tag_stack","avoided_tags","entities","pattern","_case","new_mode","special","inline_tags","now_on_tag","replaceNamedEntities","removeEmptyTags","joinRepeatedEntities","tags","removeBrInPre","_invokeParser","remove_comments","_isModeEnd","text","_decodeSpecial","addCss","closeBlockTag","_insertContentWhenClosingTag","is_match","fixNestingBeforeOpeningBlockTag","current","insertContentAfterClosingTag","_reduce","WymCssLexer","only_wym_blocks","indexOf","_in_style","addCssTokens","_current_item","_current_element","addStyleSetting","addAttributeTokens","_Lexer","Listener","style_details","_current_match","beforeParsing","details","feedback_style","getResult","afterParsing","_avoiding_tags_implicitly","allowStylingTagsAndAttributes","Ignore","nodeType","Text","addContent","Script","Css","_non_tag","insertAt","str","addComment","trim","addScript","OpeningTag","ret","_tag","autoCloseUnclosedBeforeNewOpening","openBlockTag","inlineTag","openUnknownTag","last_tag","last_tag_attributes","closeUnknownTag","closeUnopenedTag","_decreaseOpenTagCounter","undefined","new_tag","saveCaret","closing","clipboardData","getData","counter","shouldCloseTagAutomatically","getTagReplacements","_initialized","TagAttributes","DoubleQuotedAttribute","SingleQuotedAttribute","execCommand","param","UnquotedAttribute","&nbsp;","range","selection","createRange","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","parentElement","parents","&not;","&shy;","&reg;","&macr;","&deg;","&plusmn;","pasteHTML","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ouml;","&divide;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&OElig;","&oelig;","&Scaron;","&scaron;","&Yuml;","&fnof;","&circ;","&Beta;","&Gamma;","&Delta;","&Epsilon;","&Zeta;","&Eta;","&Theta;","&Kappa;","&Lambda;","&Mu;","&Nu;","&Pi;","&Rho;","&Sigma;","&Tau;","&Upsilon;","&Phi;","&Chi;","&Psi;","&Omega;","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigmaf;","&sigma;","&chi;","moveToElementText","&piv;","collapse","&emsp;","&thinsp;","&zwj;","&lrm;","&ndash;","&mdash;","&rsquo;","&sbquo;","&ldquo;","&rdquo;","&bdquo;","&dagger;","&Dagger;","&bull;","&hellip;","&permil;","&prime;","&Prime;","&lsaquo;","&rsaquo;","&oline;","&frasl;","&euro;","&image;","&weierp;","&real;","&trade;","&alefsym;","&larr;","&uarr;","&rarr;","&darr;","&harr;","&crarr;","&lArr;","&uArr;","&rArr;","&dArr;","&hArr;","&forall;","&part;","&exist;","&empty;","&nabla;","&isin;","&notin;","&ni;","&prod;","&sum;","&minus;","&lowast;","&radic;","&prop;","&infin;","&ang;","&and;","&or;","&cap;","&cup;","&int;","&there4;","&sim;","&cong;","&asymp;","&ne;","&equiv;","&le;","&ge;","&sub;","&sup;","&nsub;","&sube;","&supe;","&oplus;","&otimes;","&perp;","&sdot;","WymClassMozilla","&lfloor;","&rfloor;","&lang;","&rang;","&loz;","&spades;","&clubs;","&hearts;","&diams;","block_tags","initIframe","iframe","contentDocument","entity","join","sel","anchorNode","String","fromCharCode","ancestor","b","remove_scripts","keydown","$parent","$container","$embedded","size","_getClosingTagContent","hasClass","avoidStylingTagsAndAttributes","keyCode","insertContentBeforeClosingTag","children","remove","position","enableDesignMode","designMode","getTagForStyle","_has_title","WymCssComment","expressions","WymCssStyle","WymCssFeedbackStyle","WymCssStyleDeclaration","parts","toUpperCase","insertRule","startNode","getRangeAt","startContainer","isPhantomNode","n","isPhantomString","slice","old","rep","inserted","pos","arr","nodeName","findByName","$","onfocus","onkeyup","onclick","onbeforepaste","event","returnValue","onpaste","selectNode","caretPos","move","cssRules","parent","$newNode","before","ctrlKey","shiftKey","preventDefault","metaKey","addRange","INSERT_ORDEREDLIST","replaceWith"],"mappings":"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","file":"../../../scripts/libs/jquery/jquery.wymeditor.js","sourcesContent":["/**\n * @version 0.5-rc1\n *\n * WYMeditor : what you see is What You Mean web-based editor\n * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/\n * Dual licensed under the MIT (MIT-license.txt)\n * and GPL (GPL-license.txt) licenses.\n *\n * For further information visit:\n *        http://www.wymeditor.org/\n *\n * File: jquery.wymeditor.js\n *\n *        Main JS file with core classes and functions.\n *        See the documentation for more info.\n *\n * About: authors\n *\n *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)\n *        Volker Mische (vmx a-t gmx dotde)\n *        Scott Lewis (lewiscot a-t gmail dotcom)\n *        Bermi Ferrer (wymeditor a-t bermi dotorg)\n *        Daniel Reszka (d.reszka a-t wymeditor dotorg)\n *        Jonatan Lundin (jonatan.lundin _at_ gmail.com)\n */\n\n/*\n   Namespace: WYMeditor\n   Global WYMeditor namespace.\n*/\nif(!WYMeditor) var WYMeditor = {};\n\n//Wrap the Firebug console in WYMeditor.console\n(function() {\n    if ( !window.console || !console.firebug ) {\n        var names = [\"log\", \"debug\", \"info\", \"warn\", \"error\", \"assert\", \"dir\", \"dirxml\",\n        \"group\", \"groupEnd\", \"time\", \"timeEnd\", \"count\", \"trace\", \"profile\", \"profileEnd\"];\n\n        WYMeditor.console = {};\n        for (var i = 0; i < names.length; ++i)\n            WYMeditor.console[names[i]] = function() {}\n\n    } else WYMeditor.console = window.console;\n})();\n\njQuery.extend(WYMeditor, {\n\n/*\n    Constants: Global WYMeditor constants.\n\n    VERSION             - Defines WYMeditor version.\n    INSTANCES           - An array of loaded WYMeditor.editor instances.\n    STRINGS             - An array of loaded WYMeditor language pairs/values.\n    SKINS               - An array of loaded WYMeditor skins.\n    NAME                - The \"name\" attribute.\n    INDEX               - A string replaced by the instance index.\n    WYM_INDEX           - A string used to get/set the instance index.\n    BASE_PATH           - A string replaced by WYMeditor's base path.\n    SKIN_PATH           - A string replaced by WYMeditor's skin path.\n    WYM_PATH            - A string replaced by WYMeditor's main JS file path.\n    SKINS_DEFAULT_PATH  - The skins default base path.\n    SKINS_DEFAULT_CSS   - The skins default CSS file.\n    LANG_DEFAULT_PATH   - The language files default path.\n    IFRAME_BASE_PATH    - A string replaced by the designmode iframe's base path.\n    IFRAME_DEFAULT      - The iframe's default base path.\n    JQUERY_PATH         - A string replaced by the computed jQuery path.\n    DIRECTION           - A string replaced by the text direction (rtl or ltr).\n    LOGO                - A string replaced by WYMeditor logo.\n    TOOLS               - A string replaced by the toolbar's HTML.\n    TOOLS_ITEMS         - A string replaced by the toolbar items.\n    TOOL_NAME           - A string replaced by a toolbar item's name.\n    TOOL_TITLE          - A string replaced by a toolbar item's title.\n    TOOL_CLASS          - A string replaced by a toolbar item's class.\n    CLASSES             - A string replaced by the classes panel's HTML.\n    CLASSES_ITEMS       - A string replaced by the classes items.\n    CLASS_NAME          - A string replaced by a class item's name.\n    CLASS_TITLE         - A string replaced by a class item's title.\n    CONTAINERS          - A string replaced by the containers panel's HTML.\n    CONTAINERS_ITEMS    - A string replaced by the containers items.\n    CONTAINER_NAME      - A string replaced by a container item's name.\n    CONTAINER_TITLE     - A string replaced by a container item's title.\n    CONTAINER_CLASS     - A string replaced by a container item's class.\n    HTML                - A string replaced by the HTML view panel's HTML.\n    IFRAME              - A string replaced by the designmode iframe.\n    STATUS              - A string replaced by the status panel's HTML.\n    DIALOG_TITLE        - A string replaced by a dialog's title.\n    DIALOG_BODY         - A string replaced by a dialog's HTML body.\n    BODY                - The BODY element.\n    STRING              - The \"string\" type.\n    BODY,DIV,P,\n    H1,H2,H3,H4,H5,H6,\n    PRE,BLOCKQUOTE,\n    A,BR,IMG,\n    TABLE,TD,TH,\n    UL,OL,LI            - HTML elements string representation.\n    CLASS,HREF,SRC,\n    TITLE,ALT           - HTML attributes string representation.\n    DIALOG_LINK         - A link dialog type.\n    DIALOG_IMAGE        - An image dialog type.\n    DIALOG_TABLE        - A table dialog type.\n    DIALOG_PASTE        - A 'Paste from Word' dialog type.\n    BOLD                - Command: (un)set selection to <strong>.\n    ITALIC              - Command: (un)set selection to <em>.\n    CREATE_LINK         - Command: open the link dialog or (un)set link.\n    INSERT_IMAGE        - Command: open the image dialog or insert an image.\n    INSERT_TABLE        - Command: open the table dialog.\n    PASTE               - Command: open the paste dialog.\n    INDENT              - Command: nest a list item.\n    OUTDENT             - Command: unnest a list item.\n    TOGGLE_HTML         - Command: display/hide the HTML view.\n    FORMAT_BLOCK        - Command: set a block element to another type.\n    PREVIEW             - Command: open the preview dialog.\n    UNLINK              - Command: unset a link.\n    INSERT_UNORDEREDLIST- Command: insert an unordered list.\n    INSERT_ORDEREDLIST  - Command: insert an ordered list.\n    MAIN_CONTAINERS     - An array of the main HTML containers used in WYMeditor.\n    BLOCKS              - An array of the HTML block elements.\n    KEY                 - Standard key codes.\n    NODE                - Node types.\n\n*/\n\n    VERSION             : \"0.5-rc1\",\n    INSTANCES           : [],\n    STRINGS             : [],\n    SKINS               : [],\n    NAME                : \"name\",\n    INDEX               : \"{Wym_Index}\",\n    WYM_INDEX           : \"wym_index\",\n    BASE_PATH           : \"{Wym_Base_Path}\",\n    CSS_PATH            : \"{Wym_Css_Path}\",\n    WYM_PATH            : \"{Wym_Wym_Path}\",\n    SKINS_DEFAULT_PATH  : \"skins/\",\n    SKINS_DEFAULT_CSS   : \"skin.css\",\n    SKINS_DEFAULT_JS    : \"skin.js\",\n    LANG_DEFAULT_PATH   : \"lang/\",\n    IFRAME_BASE_PATH    : \"{Wym_Iframe_Base_Path}\",\n    IFRAME_DEFAULT      : \"iframe/default/\",\n    JQUERY_PATH         : \"{Wym_Jquery_Path}\",\n    DIRECTION           : \"{Wym_Direction}\",\n    LOGO                : \"{Wym_Logo}\",\n    TOOLS               : \"{Wym_Tools}\",\n    TOOLS_ITEMS         : \"{Wym_Tools_Items}\",\n    TOOL_NAME           : \"{Wym_Tool_Name}\",\n    TOOL_TITLE          : \"{Wym_Tool_Title}\",\n    TOOL_CLASS          : \"{Wym_Tool_Class}\",\n    CLASSES             : \"{Wym_Classes}\",\n    CLASSES_ITEMS       : \"{Wym_Classes_Items}\",\n    CLASS_NAME          : \"{Wym_Class_Name}\",\n    CLASS_TITLE         : \"{Wym_Class_Title}\",\n    CONTAINERS          : \"{Wym_Containers}\",\n    CONTAINERS_ITEMS    : \"{Wym_Containers_Items}\",\n    CONTAINER_NAME      : \"{Wym_Container_Name}\",\n    CONTAINER_TITLE     : \"{Wym_Containers_Title}\",\n    CONTAINER_CLASS     : \"{Wym_Container_Class}\",\n    HTML                : \"{Wym_Html}\",\n    IFRAME              : \"{Wym_Iframe}\",\n    STATUS              : \"{Wym_Status}\",\n    DIALOG_TITLE        : \"{Wym_Dialog_Title}\",\n    DIALOG_BODY         : \"{Wym_Dialog_Body}\",\n    STRING              : \"string\",\n    BODY                : \"body\",\n    DIV                 : \"div\",\n    P                   : \"p\",\n    H1                  : \"h1\",\n    H2                  : \"h2\",\n    H3                  : \"h3\",\n    H4                  : \"h4\",\n    H5                  : \"h5\",\n    H6                  : \"h6\",\n    PRE                 : \"pre\",\n    BLOCKQUOTE          : \"blockquote\",\n    A                   : \"a\",\n    BR                  : \"br\",\n    IMG                 : \"img\",\n    TABLE               : \"table\",\n    TD                  : \"td\",\n    TH                  : \"th\",\n    UL                  : \"ul\",\n    OL                  : \"ol\",\n    LI                  : \"li\",\n    CLASS               : \"class\",\n    HREF                : \"href\",\n    SRC                 : \"src\",\n    TITLE               : \"title\",\n    ALT                 : \"alt\",\n    DIALOG_LINK         : \"Link\",\n    DIALOG_IMAGE        : \"Image\",\n    DIALOG_TABLE        : \"Table\",\n    DIALOG_PASTE        : \"Paste_From_Word\",\n    BOLD                : \"Bold\",\n    ITALIC              : \"Italic\",\n    CREATE_LINK         : \"CreateLink\",\n    INSERT_IMAGE        : \"InsertImage\",\n    INSERT_TABLE        : \"InsertTable\",\n    INSERT_HTML         : \"InsertHTML\",\n    PASTE               : \"Paste\",\n    INDENT              : \"Indent\",\n    OUTDENT             : \"Outdent\",\n    TOGGLE_HTML         : \"ToggleHtml\",\n    FORMAT_BLOCK        : \"FormatBlock\",\n    PREVIEW             : \"Preview\",\n    UNLINK\t\t\t        : \"Unlink\",\n    INSERT_UNORDEREDLIST: \"InsertUnorderedList\",\n    INSERT_ORDEREDLIST\t: \"InsertOrderedList\",\n\n    MAIN_CONTAINERS : new Array(\"p\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"pre\",\"blockquote\"),\n\n    BLOCKS : new Array(\"address\", \"blockquote\", \"div\", \"dl\",\n\t   \"fieldset\", \"form\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"hr\",\n\t   \"noscript\", \"ol\", \"p\", \"pre\", \"table\", \"ul\", \"dd\", \"dt\",\n\t   \"li\", \"tbody\", \"td\", \"tfoot\", \"th\", \"thead\", \"tr\"),\n\n    KEY : {\n      BACKSPACE: 8,\n      ENTER: 13,\n      END: 35,\n      HOME: 36,\n      LEFT: 37,\n      UP: 38,\n      RIGHT: 39,\n      DOWN: 40,\n      CURSOR: new Array(37, 38, 39, 40),\n      DELETE: 46\n    },\n\n    NODE : {\n      ELEMENT: 1,\n      ATTRIBUTE: 2,\n      TEXT: 3\n    },\n\t\n    /*\n        Class: WYMeditor.editor\n        WYMeditor editor main class, instanciated for each editor occurrence.\n    */\n\n\teditor : function(elem, options) {\n\n        /*\n            Constructor: WYMeditor.editor\n\n            Initializes main values (index, elements, paths, ...)\n            and call WYMeditor.editor.init which initializes the editor.\n\n            Parameters:\n\n                elem - The HTML element to be replaced by the editor.\n                options - The hash of options.\n\n            Returns:\n\n                Nothing.\n\n            See Also:\n\n                <WYMeditor.editor.init>\n        */\n\n        //store the instance in the INSTANCES array and store the index\n        this._index = WYMeditor.INSTANCES.push(this) - 1;\n        //store the element replaced by the editor\n        this._element = elem;\n        //store the options\n        this._options = options;\n        //store the element's inner value\n        this._html = jQuery(elem).val();\n\n        //store the HTML option, if any\n        if(this._options.html) this._html = this._options.html;\n        //get or compute the base path (where the main JS file is located)\n        this._options.basePath = this._options.basePath\n        || this.computeBasePath();\n        //get or set the skin path (where the skin files are located)\n        this._options.skinPath = this._options.skinPath\n        || this._options.basePath + WYMeditor.SKINS_DEFAULT_PATH\n           + this._options.skin + '/';\n        //get or compute the main JS file location\n        this._options.wymPath = this._options.wymPath\n        || this.computeWymPath();\n        //get or set the language files path\n        this._options.langPath = this._options.langPath\n        || this._options.basePath + WYMeditor.LANG_DEFAULT_PATH;\n        //get or set the designmode iframe's base path\n        this._options.iframeBasePath = this._options.iframeBasePath\n        || this._options.basePath + WYMeditor.IFRAME_DEFAULT;\n        //get or compute the jQuery JS file location\n        this._options.jQueryPath = this._options.jQueryPath\n        || this.computeJqueryPath();\n\n        //initialize the editor instance\n        this.init();\n\t\n\t}\n\n});\n\n/********** JQUERY **********/\n\n/**\n * Replace an HTML element by WYMeditor\n *\n * @example jQuery(\".wymeditor\").wymeditor(\n *        {\n *\n *        }\n *      );\n * @desc Example description here\n * \n * @name WYMeditor\n * @description WYMeditor is a web-based WYSIWYM XHTML editor\n * @param Hash hash A hash of parameters\n * @option Integer iExample Description here\n * @option String sExample Description here\n *\n * @type jQuery\n * @cat Plugins/WYMeditor\n * @author Jean-Francois Hovinne\n */\njQuery.fn.wymeditor = function(options) {\n\n  options = jQuery.extend({\n\n    html:       \"\",\n    \n    basePath:   false,\n    \n    skinPath:    false,\n    \n    wymPath:    false,\n    \n    iframeBasePath: false,\n    \n    jQueryPath: false,\n    \n    styles: false,\n    \n    stylesheet: false,\n    \n    skin:       \"default\",\n    initSkin:   true,\n    loadSkin:   true,\n\n    lang:       \"en\",\n\n    direction:  \"ltr\",\n\n    boxHtml:   \"<div class='wym_box'>\"\n              + \"<div class='wym_area_top'>\" \n              + WYMeditor.TOOLS\n              + \"</div>\"\n              + \"<div class='wym_area_left'></div>\"\n              + \"<div class='wym_area_right'>\"\n              + WYMeditor.CONTAINERS\n              + WYMeditor.CLASSES\n              + \"</div>\"\n              + \"<div class='wym_area_main'>\"\n              + WYMeditor.HTML\n              + WYMeditor.IFRAME\n              + WYMeditor.STATUS\n              + \"</div>\"\n              + \"<div class='wym_area_bottom'>\"\n              + WYMeditor.LOGO\n              + \"</div>\"\n              + \"</div>\",\n\n    logoHtml:  \"<a class='wym_wymeditor_link' \"\n              + \"href='http://www.wymeditor.org/'>WYMeditor</a>\",\n\n    iframeHtml:\"<div class='wym_iframe wym_section'>\"\n              + \"<iframe \"\n              + \"src='\"\n              + \"/page/get_editor_iframe' \"\n              //+ WYMeditor.IFRAME_BASE_PATH\n              //+ \"wymiframe.html' \"\n              + \"onload='this.contentWindow.parent.WYMeditor.INSTANCES[\"\n              + WYMeditor.INDEX + \"].initIframe(this)'\"\n              + \"></iframe>\"\n              + \"</div>\",\n              \n    editorStyles: [],\n\n    toolsHtml: \"<div class='wym_tools wym_section'>\"\n              + \"<h2>{Tools}</h2>\"\n              + \"<ul>\"\n              + WYMeditor.TOOLS_ITEMS\n              + \"</ul>\"\n              + \"</div>\",\n              \n    toolsItemHtml:   \"<li class='\"\n                        + WYMeditor.TOOL_CLASS\n                        + \"'><a href='#' name='\"\n                        + WYMeditor.TOOL_NAME\n                        + \"' title='\"\n                        + WYMeditor.TOOL_TITLE\n                        + \"'>\"\n                        + WYMeditor.TOOL_TITLE\n                        + \"</a></li>\",\n\n    toolsItems: [\n        {'name': 'Bold', 'title': 'Strong', 'css': 'wym_tools_strong'}, \n        {'name': 'Italic', 'title': 'Emphasis', 'css': 'wym_tools_emphasis'},\n        {'name': 'Superscript', 'title': 'Superscript',\n            'css': 'wym_tools_superscript'},\n        {'name': 'Subscript', 'title': 'Subscript',\n            'css': 'wym_tools_subscript'},\n        {'name': 'InsertOrderedList', 'title': 'Ordered_List',\n            'css': 'wym_tools_ordered_list'},\n        {'name': 'InsertUnorderedList', 'title': 'Unordered_List',\n            'css': 'wym_tools_unordered_list'},\n        {'name': 'Indent', 'title': 'Indent', 'css': 'wym_tools_indent'},\n        {'name': 'Outdent', 'title': 'Outdent', 'css': 'wym_tools_outdent'},\n        {'name': 'Undo', 'title': 'Undo', 'css': 'wym_tools_undo'},\n        {'name': 'Redo', 'title': 'Redo', 'css': 'wym_tools_redo'},\n        {'name': 'CreateLink', 'title': 'Link', 'css': 'wym_tools_link'},\n        {'name': 'Unlink', 'title': 'Unlink', 'css': 'wym_tools_unlink'},\n        {'name': 'InsertImage', 'title': 'Image', 'css': 'wym_tools_image'},\n        {'name': 'InsertTable', 'title': 'Table', 'css': 'wym_tools_table'},\n        {'name': 'Paste', 'title': 'Paste_From_Word',\n            'css': 'wym_tools_paste'},\n        {'name': 'ToggleHtml', 'title': 'HTML', 'css': 'wym_tools_html'},\n        {'name': 'Preview', 'title': 'Preview', 'css': 'wym_tools_preview'}\n    ],\n\n    containersHtml:    \"<div class='wym_containers wym_section'>\"\n                        + \"<h2>{Containers}</h2>\"\n                        + \"<ul>\"\n                        + WYMeditor.CONTAINERS_ITEMS\n                        + \"</ul>\"\n                        + \"</div>\",\n                        \n    containersItemHtml:\"<li class='\"\n                        + WYMeditor.CONTAINER_CLASS\n                        + \"'>\"\n                        + \"<a href='#' name='\"\n                        + WYMeditor.CONTAINER_NAME\n                        + \"'>\"\n                        + WYMeditor.CONTAINER_TITLE\n                        + \"</a></li>\",\n                        \n    containersItems: [\n        {'name': 'P', 'title': 'Paragraph', 'css': 'wym_containers_p'},\n        {'name': 'H1', 'title': 'Heading_1', 'css': 'wym_containers_h1'},\n        {'name': 'H2', 'title': 'Heading_2', 'css': 'wym_containers_h2'},\n        {'name': 'H3', 'title': 'Heading_3', 'css': 'wym_containers_h3'},\n        {'name': 'H4', 'title': 'Heading_4', 'css': 'wym_containers_h4'},\n        {'name': 'H5', 'title': 'Heading_5', 'css': 'wym_containers_h5'},\n        {'name': 'H6', 'title': 'Heading_6', 'css': 'wym_containers_h6'},\n        {'name': 'PRE', 'title': 'Preformatted', 'css': 'wym_containers_pre'},\n        {'name': 'BLOCKQUOTE', 'title': 'Blockquote',\n            'css': 'wym_containers_blockquote'},\n        {'name': 'TH', 'title': 'Table_Header', 'css': 'wym_containers_th'}\n    ],\n\n    classesHtml:       \"<div class='wym_classes wym_section'>\"\n                        + \"<h2>{Classes}</h2><ul>\"\n                        + WYMeditor.CLASSES_ITEMS\n                        + \"</ul></div>\",\n\n    classesItemHtml:   \"<li><a href='#' name='\"\n                        + WYMeditor.CLASS_NAME\n                        + \"'>\"\n                        + WYMeditor.CLASS_TITLE\n                        + \"</a></li>\",\n\n    classesItems:      [],\n\n    statusHtml:        \"<div class='wym_status wym_section'>\"\n                        + \"<h2>{Status}</h2>\"\n                        + \"</div>\",\n\n    htmlHtml:          \"<div class='wym_html wym_section'>\"\n                        + \"<h2>{Source_Code}</h2>\"\n                        + \"<textarea class='wym_html_val'></textarea>\"\n                        + \"</div>\",\n\n    boxSelector:       \".wym_box\",\n    toolsSelector:     \".wym_tools\",\n    toolsListSelector: \" ul\",\n    containersSelector:\".wym_containers\",\n    classesSelector:   \".wym_classes\",\n    htmlSelector:      \".wym_html\",\n    iframeSelector:    \".wym_iframe iframe\",\n    iframeBodySelector:\".wym_iframe\",\n    statusSelector:    \".wym_status\",\n    toolSelector:      \".wym_tools a\",\n    containerSelector: \".wym_containers a\",\n    classSelector:     \".wym_classes a\",\n    htmlValSelector:   \".wym_html_val\",\n    \n    hrefSelector:      \".wym_href\",\n    srcSelector:       \".wym_src\",\n    titleSelector:     \".wym_title\",\n    altSelector:       \".wym_alt\",\n    textSelector:      \".wym_text\",\n    \n    rowsSelector:      \".wym_rows\",\n    colsSelector:      \".wym_cols\",\n    captionSelector:   \".wym_caption\",\n    summarySelector:   \".wym_summary\",\n    \n    submitSelector:    \".wym_submit\",\n    cancelSelector:    \".wym_cancel\",\n    previewSelector:   \"\",\n    \n    dialogTypeSelector:    \".wym_dialog_type\",\n    dialogLinkSelector:    \".wym_dialog_link\",\n    dialogImageSelector:   \".wym_dialog_image\",\n    dialogTableSelector:   \".wym_dialog_table\",\n    dialogPasteSelector:   \".wym_dialog_paste\",\n    dialogPreviewSelector: \".wym_dialog_preview\",\n    \n    updateSelector:    \".wymupdate\",\n    updateEvent:       \"click\",\n    \n    dialogFeatures:    \"menubar=no,titlebar=no,toolbar=no,resizable=no\"\n                      + \",width=560,height=300,top=0,left=0\",\n    dialogFeaturesPreview: \"menubar=no,titlebar=no,toolbar=no,resizable=no\"\n                      + \",scrollbars=yes,width=560,height=300,top=0,left=0\",\n\n    dialogHtml:      \"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN'\"\n                      + \" 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>\"\n                      + \"<html dir='\"\n                      + WYMeditor.DIRECTION\n                      + \"'><head>\"\n                      + \"<link rel='stylesheet' type='text/css' media='screen'\"\n                      + \" href='\"\n                      + WYMeditor.CSS_PATH\n                      + \"' />\"\n                      + \"<title>\"\n                      + WYMeditor.DIALOG_TITLE\n                      + \"</title>\"\n                      + \"<script type='text/javascript'\"\n                      + \" src='\"\n                      + WYMeditor.JQUERY_PATH\n                      + \"'></script>\"\n                      + \"<script type='text/javascript'\"\n                      + \" src='\"\n                      + WYMeditor.WYM_PATH\n                      + \"'></script>\"\n                      + \"</head>\"\n                      + WYMeditor.DIALOG_BODY\n                      + \"</html>\",\n                      \n    dialogLinkHtml:  \"<body class='wym_dialog wym_dialog_link'\"\n               + \" onload='WYMeditor.INIT_DIALOG(\" + WYMeditor.INDEX + \")'\"\n               + \">\"\n               + \"<form>\"\n               + \"<fieldset>\"\n               + \"<input type='hidden' class='wym_dialog_type' value='\"\n               + WYMeditor.DIALOG_LINK\n               + \"' />\"\n               + \"<legend>{Link}</legend>\"\n               + \"<div class='row'>\"\n               + \"<label>{URL}</label>\"\n               + \"<input type='text' class='wym_href' value='' size='40' />\"\n               + \"</div>\"\n               + \"<div class='row'>\"\n               + \"<label>{Title}</label>\"\n               + \"<input type='text' class='wym_title' value='' size='40' />\"\n               + \"</div>\"\n               + \"<div class='row row-indent'>\"\n               + \"<input class='wym_submit' type='button'\"\n               + \" value='{Submit}' />\"\n               + \"<input class='wym_cancel' type='button'\"\n               + \"value='{Cancel}' />\"\n               + \"</div>\"\n               + \"</fieldset>\"\n               + \"</form>\"\n               + \"</body>\",\n    \n    dialogImageHtml:  \"<body class='wym_dialog wym_dialog_image'\"\n               + \" onload='WYMeditor.INIT_DIALOG(\" + WYMeditor.INDEX + \")'\"\n               + \">\"\n               + \"<form>\"\n               + \"<fieldset>\"\n               + \"<input type='hidden' class='wym_dialog_type' value='\"\n               + WYMeditor.DIALOG_IMAGE\n               + \"' />\"\n               + \"<legend>{Image}</legend>\"\n               + \"<div class='row'>\"\n               + \"<label>{URL}</label>\"\n               + \"<input type='text' class='wym_src' value='' size='40' />\"\n               + \"</div>\"\n               + \"<div class='row'>\"\n               + \"<label>{Alternative_Text}</label>\"\n               + \"<input type='text' class='wym_alt' value='' size='40' />\"\n               + \"</div>\"\n               + \"<div class='row'>\"\n               + \"<label>{Title}</label>\"\n               + \"<input type='text' class='wym_title' value='' size='40' />\"\n               + \"</div>\"\n               + \"<div class='row row-indent'>\"\n               + \"<input class='wym_submit' type='button'\"\n               + \" value='{Submit}' />\"\n               + \"<input class='wym_cancel' type='button'\"\n               + \"value='{Cancel}' />\"\n               + \"</div>\"\n               + \"</fieldset>\"\n               + \"</form>\"\n               + \"</body>\",\n    \n    dialogTableHtml:  \"<body class='wym_dialog wym_dialog_table'\"\n               + \" onload='WYMeditor.INIT_DIALOG(\" + WYMeditor.INDEX + \")'\"\n               + \">\"\n               + \"<form>\"\n               + \"<fieldset>\"\n               + \"<input type='hidden' class='wym_dialog_type' value='\"\n               + WYMeditor.DIALOG_TABLE\n               + \"' />\"\n               + \"<legend>{Table}</legend>\"\n               + \"<div class='row'>\"\n               + \"<label>{Caption}</label>\"\n               + \"<input type='text' class='wym_caption' value='' size='40' />\"\n               + \"</div>\"\n               + \"<div class='row'>\"\n               + \"<label>{Summary}</label>\"\n               + \"<input type='text' class='wym_summary' value='' size='40' />\"\n               + \"</div>\"\n               + \"<div class='row'>\"\n               + \"<label>{Number_Of_Rows}</label>\"\n               + \"<input type='text' class='wym_rows' value='3' size='3' />\"\n               + \"</div>\"\n               + \"<div class='row'>\"\n               + \"<label>{Number_Of_Cols}</label>\"\n               + \"<input type='text' class='wym_cols' value='2' size='3' />\"\n               + \"</div>\"\n               + \"<div class='row row-indent'>\"\n               + \"<input class='wym_submit' type='button'\"\n               + \" value='{Submit}' />\"\n               + \"<input class='wym_cancel' type='button'\"\n               + \"value='{Cancel}' />\"\n               + \"</div>\"\n               + \"</fieldset>\"\n               + \"</form>\"\n               + \"</body>\",\n\n    dialogPasteHtml:  \"<body class='wym_dialog wym_dialog_paste'\"\n               + \" onload='WYMeditor.INIT_DIALOG(\" + WYMeditor.INDEX + \")'\"\n               + \">\"\n               + \"<form>\"\n               + \"<input type='hidden' class='wym_dialog_type' value='\"\n               + WYMeditor.DIALOG_PASTE\n               + \"' />\"\n               + \"<fieldset>\"\n               + \"<legend>{Paste_From_Word}</legend>\"\n               + \"<div class='row'>\"\n               + \"<textarea class='wym_text' rows='10' cols='50'></textarea>\"\n               + \"</div>\"\n               + \"<div class='row'>\"\n               + \"<input class='wym_submit' type='button'\"\n               + \" value='{Submit}' />\"\n               + \"<input class='wym_cancel' type='button'\"\n               + \"value='{Cancel}' />\"\n               + \"</div>\"\n               + \"</fieldset>\"\n               + \"</form>\"\n               + \"</body>\",\n\n    dialogPreviewHtml: \"<body class='wym_dialog wym_dialog_preview'\"\n                      + \" onload='WYMeditor.INIT_DIALOG(\" + WYMeditor.INDEX + \")'\"\n                      + \"></body>\",\n                      \n    dialogStyles: [],\n\n    stringDelimiterLeft: \"{\",\n    stringDelimiterRight:\"}\",\n    \n    preInit: null,\n    preBind: null,\n    postInit: null,\n    \n    preInitDialog: null,\n    postInitDialog: null\n\n  }, options);\n\n  return this.each(function() {\n\n    new WYMeditor.editor(jQuery(this),options);\n  });\n};\n\n/* @name extend\n * @description Returns the WYMeditor instance based on its index\n */\njQuery.extend({\n  wymeditors: function(i) {\n    return (WYMeditor.INSTANCES[i]);\n  }\n});\n\n\n/********** WYMeditor **********/\n\n/* @name Wymeditor\n * @description WYMeditor class\n */\n\n/* @name init\n * @description Initializes a WYMeditor instance\n */\nWYMeditor.editor.prototype.init = function() {\n\n  //load subclass - browser specific\n  //unsupported browsers: do nothing\n  if (jQuery.browser.msie) {\n    var WymClass = new WYMeditor.WymClassExplorer(this);\n  }\n  else if (jQuery.browser.mozilla) {\n    var WymClass = new WYMeditor.WymClassMozilla(this);\n  }\n  else if (jQuery.browser.opera) {\n    var WymClass = new WYMeditor.WymClassOpera(this);\n  }\n  // Galaxy HACK: add Chrome to browser detection; this is fixed in later versions of WYMEditor.\n  else if (jQuery.browser.safari || jQuery.browser.chrome) {\n    var WymClass = new WYMeditor.WymClassSafari(this);\n  }\n  \n  if(WymClass) {\n  \n      if(jQuery.isFunction(this._options.preInit)) this._options.preInit(this);\n\n      var SaxListener = new WYMeditor.XhtmlSaxListener();\n      jQuery.extend(SaxListener, WymClass);\n      this.parser = new WYMeditor.XhtmlParser(SaxListener);\n      \n      if(this._options.styles || this._options.stylesheet){\n        this.configureEditorUsingRawCss();\n      }\n      \n      this.helper = new WYMeditor.XmlHelper();\n      \n      //extend the Wymeditor object\n      //don't use jQuery.extend since 1.1.4\n      //jQuery.extend(this, WymClass);\n      for (var prop in WymClass) { this[prop] = WymClass[prop]; }\n\n      //load wymbox\n      this._box = jQuery(this._element).hide().after(this._options.boxHtml).next().addClass('wym_box_' + this._index);\n\n      //store the instance index in wymbox and element replaced by editor instance\n      //but keep it compatible with jQuery < 1.2.3, see #122\n      if( jQuery.isFunction( jQuery.fn.data ) ) {\n        jQuery.data(this._box.get(0), WYMeditor.WYM_INDEX, this._index);\n        jQuery.data(this._element.get(0), WYMeditor.WYM_INDEX, this._index);\n      }\n      \n      var h = WYMeditor.Helper;\n\n      //construct the iframe\n      var iframeHtml = this._options.iframeHtml;\n      iframeHtml = h.replaceAll(iframeHtml, WYMeditor.INDEX, this._index);\n      iframeHtml = h.replaceAll(iframeHtml, WYMeditor.IFRAME_BASE_PATH, this._options.iframeBasePath);\n      \n      //construct wymbox\n      var boxHtml = jQuery(this._box).html();\n      \n      boxHtml = h.replaceAll(boxHtml, WYMeditor.LOGO, this._options.logoHtml);\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.TOOLS, this._options.toolsHtml);\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.CONTAINERS,this._options.containersHtml);\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.CLASSES, this._options.classesHtml);\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.HTML, this._options.htmlHtml);\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.IFRAME, iframeHtml);\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.STATUS, this._options.statusHtml);\n      \n      //construct tools list\n      var aTools = eval(this._options.toolsItems);\n      var sTools = \"\";\n\n      for(var i = 0; i < aTools.length; i++) {\n        var oTool = aTools[i];\n        if(oTool.name && oTool.title)\n          var sTool = this._options.toolsItemHtml;\n          var sTool = h.replaceAll(sTool, WYMeditor.TOOL_NAME, oTool.name);\n          sTool = h.replaceAll(sTool, WYMeditor.TOOL_TITLE, this._options.stringDelimiterLeft\n            + oTool.title\n            + this._options.stringDelimiterRight);\n          sTool = h.replaceAll(sTool, WYMeditor.TOOL_CLASS, oTool.css);\n          sTools += sTool;\n      }\n\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.TOOLS_ITEMS, sTools);\n      \n      //construct classes list\n      var aClasses = eval(this._options.classesItems);\n      var sClasses = \"\";\n\n      for(var i = 0; i < aClasses.length; i++) {\n        var oClass = aClasses[i];\n        if(oClass.name && oClass.title)\n          var sClass = this._options.classesItemHtml;\n          sClass = h.replaceAll(sClass, WYMeditor.CLASS_NAME, oClass.name);\n          sClass = h.replaceAll(sClass, WYMeditor.CLASS_TITLE, oClass.title);\n          sClasses += sClass;\n      }\n\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.CLASSES_ITEMS, sClasses);\n      \n      //construct containers list\n      var aContainers = eval(this._options.containersItems);\n      var sContainers = \"\";\n\n      for(var i = 0; i < aContainers.length; i++) {\n        var oContainer = aContainers[i];\n        if(oContainer.name && oContainer.title)\n          var sContainer = this._options.containersItemHtml;\n          sContainer = h.replaceAll(sContainer, WYMeditor.CONTAINER_NAME, oContainer.name);\n          sContainer = h.replaceAll(sContainer, WYMeditor.CONTAINER_TITLE,\n              this._options.stringDelimiterLeft\n            + oContainer.title\n            + this._options.stringDelimiterRight);\n          sContainer = h.replaceAll(sContainer, WYMeditor.CONTAINER_CLASS, oContainer.css);\n          sContainers += sContainer;\n      }\n\n      boxHtml = h.replaceAll(boxHtml, WYMeditor.CONTAINERS_ITEMS, sContainers);\n\n      //l10n\n      boxHtml = this.replaceStrings(boxHtml);\n      \n      //load html in wymbox\n      jQuery(this._box).html(boxHtml);\n      \n      //hide the html value\n      jQuery(this._box).find(this._options.htmlSelector).hide();\n      \n      //enable the skin\n      this.loadSkin();\n      \n    }\n};\n\nWYMeditor.editor.prototype.bindEvents = function() {\n\n  //copy the instance\n  var wym = this;\n  \n  //handle click event on tools buttons\n  jQuery(this._box).find(this._options.toolSelector).click(function() {\n    wym._iframe.contentWindow.focus(); //See #154\n    wym.exec(jQuery(this).attr(WYMeditor.NAME));    \n    return(false);\n  });\n  \n  //handle click event on containers buttons\n  jQuery(this._box).find(this._options.containerSelector).click(function() {\n    wym.container(jQuery(this).attr(WYMeditor.NAME));\n    return(false);\n  });\n  \n  //handle keyup event on html value: set the editor value\n  //handle focus/blur events to check if the element has focus, see #147\n  jQuery(this._box).find(this._options.htmlValSelector)\n    .keyup(function() { jQuery(wym._doc.body).html(jQuery(this).val());})\n    .focus(function() { jQuery(this).toggleClass('hasfocus'); })\n    .blur(function() { jQuery(this).toggleClass('hasfocus'); });\n\n  //handle click event on classes buttons\n  jQuery(this._box).find(this._options.classSelector).click(function() {\n  \n    var aClasses = eval(wym._options.classesItems);\n    var sName = jQuery(this).attr(WYMeditor.NAME);\n    \n    var oClass = WYMeditor.Helper.findByName(aClasses, sName);\n    \n    if(oClass) {\n      var jqexpr = oClass.expr;\n      wym.toggleClass(sName, jqexpr);\n    }\n    wym._iframe.contentWindow.focus(); //See #154\n    return(false);\n  });\n  \n  //handle event on update element\n  jQuery(this._options.updateSelector)\n    .bind(this._options.updateEvent, function() {\n      wym.update();\n  });\n};\n\nWYMeditor.editor.prototype.ready = function() {\n  return(this._doc != null);\n};\n\n\n/********** METHODS **********/\n\n/* @name box\n * @description Returns the WYMeditor container\n */\nWYMeditor.editor.prototype.box = function() {\n  return(this._box);\n};\n\n/* @name html\n * @description Get/Set the html value\n */\nWYMeditor.editor.prototype.html = function(html) {\n\n  if(typeof html === 'string') jQuery(this._doc.body).html(html);\n  else return(jQuery(this._doc.body).html());\n};\n\n/* @name xhtml\n * @description Cleans up the HTML\n */\nWYMeditor.editor.prototype.xhtml = function() {\n    return this.parser.parse(this.html());\n};\n\n/* @name exec\n * @description Executes a button command\n */\nWYMeditor.editor.prototype.exec = function(cmd) {\n  \n  //base function for execCommand\n  //open a dialog or exec\n  switch(cmd) {\n    case WYMeditor.CREATE_LINK:\n      var container = this.container();\n      if(container || this._selected_image) this.dialog(WYMeditor.DIALOG_LINK);\n    break;\n    \n    case WYMeditor.INSERT_IMAGE:\n      this.dialog(WYMeditor.DIALOG_IMAGE);\n    break;\n    \n    case WYMeditor.INSERT_TABLE:\n      this.dialog(WYMeditor.DIALOG_TABLE);\n    break;\n    \n    case WYMeditor.PASTE:\n      this.dialog(WYMeditor.DIALOG_PASTE);\n    break;\n    \n    case WYMeditor.TOGGLE_HTML:\n      this.update();\n      this.toggleHtml();\n\n      //partially fixes #121 when the user manually inserts an image\n      if(!jQuery(this._box).find(this._options.htmlSelector).is(':visible'))\n        this.listen();\n    break;\n    \n    case WYMeditor.PREVIEW:\n      this.dialog(WYMeditor.PREVIEW, this._options.dialogFeaturesPreview);\n    break;\n    \n    default:\n      this._exec(cmd);\n    break;\n  }\n};\n\n/* @name container\n * @description Get/Set the selected container\n */\nWYMeditor.editor.prototype.container = function(sType) {\n\n  if(sType) {\n  \n    var container = null;\n    \n    if(sType.toLowerCase() == WYMeditor.TH) {\n    \n      container = this.container();\n      \n      //find the TD or TH container\n      switch(container.tagName.toLowerCase()) {\n      \n        case WYMeditor.TD: case WYMeditor.TH:\n          break;\n        default:\n          var aTypes = new Array(WYMeditor.TD,WYMeditor.TH);\n          container = this.findUp(this.container(), aTypes);\n          break;\n      }\n      \n      //if it exists, switch\n      if(container!=null) {\n      \n        sType = (container.tagName.toLowerCase() == WYMeditor.TD)? WYMeditor.TH: WYMeditor.TD;\n        this.switchTo(container,sType);\n        this.update();\n      }\n    } else {\n  \n      //set the container type\n      var aTypes=new Array(WYMeditor.P,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,WYMeditor.H4,WYMeditor.H5,\n      WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE);\n      container = this.findUp(this.container(), aTypes);\n      \n      if(container) {\n  \n        var newNode = null;\n  \n        //blockquotes must contain a block level element\n        if(sType.toLowerCase() == WYMeditor.BLOCKQUOTE) {\n        \n          var blockquote = this.findUp(this.container(), WYMeditor.BLOCKQUOTE);\n          \n          if(blockquote == null) {\n          \n            newNode = this._doc.createElement(sType);\n            container.parentNode.insertBefore(newNode,container);\n            newNode.appendChild(container);\n            this.setFocusToNode(newNode.firstChild);\n            \n          } else {\n          \n            var nodes = blockquote.childNodes;\n            var lgt = nodes.length;\n            var firstNode = null;\n            \n            if(lgt > 0) firstNode = nodes.item(0);\n            for(var x=0; x<lgt; x++) {\n              blockquote.parentNode.insertBefore(nodes.item(0),blockquote);\n            }\n            blockquote.parentNode.removeChild(blockquote);\n            if(firstNode) this.setFocusToNode(firstNode);\n          }\n        }\n        \n        else this.switchTo(container,sType);\n      \n        this.update();\n      }\n    }\n  }\n  else return(this.selected());\n};\n\n/* @name toggleClass\n * @description Toggles class on selected element, or one of its parents\n */\nWYMeditor.editor.prototype.toggleClass = function(sClass, jqexpr) {\n\n  var container = (this._selected_image\n                    ? this._selected_image\n                    : jQuery(this.selected()));\n  container = jQuery(container).parentsOrSelf(jqexpr);\n  jQuery(container).toggleClass(sClass);\n\n  if(!jQuery(container).attr(WYMeditor.CLASS)) jQuery(container).removeAttr(this._class);\n\n};\n\n/* @name findUp\n * @description Returns the first parent or self container, based on its type\n */\nWYMeditor.editor.prototype.findUp = function(node, filter) {\n\n  //filter is a string or an array of strings\n\n  if(node) {\n\n      var tagname = node.tagName.toLowerCase();\n      \n      if(typeof(filter) == WYMeditor.STRING) {\n    \n        while(tagname != filter && tagname != WYMeditor.BODY) {\n        \n          node = node.parentNode;\n          tagname = node.tagName.toLowerCase();\n        }\n      \n      } else {\n      \n        var bFound = false;\n        \n        while(!bFound && tagname != WYMeditor.BODY) {\n          for(var i = 0; i < filter.length; i++) {\n            if(tagname == filter[i]) {\n              bFound = true;\n              break;\n            }\n          }\n          if(!bFound) {\n            node = node.parentNode;\n            tagname = node.tagName.toLowerCase();\n          }\n        }\n      }\n      \n      if(tagname != WYMeditor.BODY) return(node);\n      else return(null);\n      \n  } else return(null);\n};\n\n/* @name switchTo\n * @description Switch the node's type\n */\nWYMeditor.editor.prototype.switchTo = function(node,sType) {\n\n  var newNode = this._doc.createElement(sType);\n  var html = jQuery(node).html();\n  node.parentNode.replaceChild(newNode,node);\n  jQuery(newNode).html(html);\n  this.setFocusToNode(newNode);\n};\n\nWYMeditor.editor.prototype.replaceStrings = function(sVal) {\n  //check if the language file has already been loaded\n  //if not, get it via a synchronous ajax call\n  if(!WYMeditor.STRINGS[this._options.lang]) {\n    try {\n      eval(jQuery.ajax({url:this._options.langPath\n        + this._options.lang + '.js', async:false}).responseText);\n    } catch(e) {\n        WYMeditor.console.error(\"WYMeditor: error while parsing language file.\");\n        return sVal;\n    }\n  }\n\n  //replace all the strings in sVal and return it\n  for (var key in WYMeditor.STRINGS[this._options.lang]) {\n    sVal = WYMeditor.Helper.replaceAll(sVal, this._options.stringDelimiterLeft + key \n    + this._options.stringDelimiterRight,\n    WYMeditor.STRINGS[this._options.lang][key]);\n  };\n  return(sVal);\n};\n\nWYMeditor.editor.prototype.encloseString = function(sVal) {\n\n  return(this._options.stringDelimiterLeft\n    + sVal\n    + this._options.stringDelimiterRight);\n};\n\n/* @name status\n * @description Prints a status message\n */\nWYMeditor.editor.prototype.status = function(sMessage) {\n\n  //print status message\n  jQuery(this._box).find(this._options.statusSelector).html(sMessage);\n};\n\n/* @name update\n * @description Updates the element and textarea values\n */\nWYMeditor.editor.prototype.update = function() {\n\n  var html = this.xhtml();\n  jQuery(this._element).val(html);\n  jQuery(this._box).find(this._options.htmlValSelector).not('.hasfocus').val(html); //#147\n};\n\n/* @name dialog\n * @description Opens a dialog box\n */\nWYMeditor.editor.prototype.dialog = function( dialogType, dialogFeatures, bodyHtml ) {\n  var features = dialogFeatures || this._wym._options.dialogFeatures;\n  var wDialog = window.open('', 'dialog', features);\n\n  if(wDialog) {\n\n    var sBodyHtml = \"\";\n    \n    switch( dialogType ) {\n\n      case(WYMeditor.DIALOG_LINK):\n        sBodyHtml = this._options.dialogLinkHtml;\n      break;\n      case(WYMeditor.DIALOG_IMAGE):\n        sBodyHtml = this._options.dialogImageHtml;\n      break;\n      case(WYMeditor.DIALOG_TABLE):\n        sBodyHtml = this._options.dialogTableHtml;\n      break;\n      case(WYMeditor.DIALOG_PASTE):\n        sBodyHtml = this._options.dialogPasteHtml;\n      break;\n      case(WYMeditor.PREVIEW):\n        sBodyHtml = this._options.dialogPreviewHtml;\n      break;\n      default:\n        sBodyHtml = bodyHtml;\n    }\n    var h = WYMeditor.Helper;\n\n    //construct the dialog\n    var dialogHtml = this._options.dialogHtml;\n    dialogHtml = h.replaceAll(dialogHtml, WYMeditor.BASE_PATH, this._options.basePath);\n    dialogHtml = h.replaceAll(dialogHtml, WYMeditor.DIRECTION, this._options.direction);\n    dialogHtml = h.replaceAll(dialogHtml, WYMeditor.CSS_PATH, this._options.skinPath + WYMeditor.SKINS_DEFAULT_CSS);\n    dialogHtml = h.replaceAll(dialogHtml, WYMeditor.WYM_PATH, this._options.wymPath);\n    dialogHtml = h.replaceAll(dialogHtml, WYMeditor.JQUERY_PATH, this._options.jQueryPath);\n    dialogHtml = h.replaceAll(dialogHtml, WYMeditor.DIALOG_TITLE, this.encloseString( dialogType ));\n    dialogHtml = h.replaceAll(dialogHtml, WYMeditor.DIALOG_BODY, sBodyHtml);\n    dialogHtml = h.replaceAll(dialogHtml, WYMeditor.INDEX, this._index);\n      \n    dialogHtml = this.replaceStrings(dialogHtml);\n    var doc = wDialog.document;\n    doc.write(dialogHtml);\n    doc.close();\n  }\n};\n\n/* @name toggleHtml\n * @description Shows/Hides the HTML\n */\nWYMeditor.editor.prototype.toggleHtml = function() {\n  jQuery(this._box).find(this._options.htmlSelector).toggle();\n};\n\nWYMeditor.editor.prototype.uniqueStamp = function() {\n\tvar now = new Date();\n\treturn(\"wym-\" + now.getTime());\n};\n\nWYMeditor.editor.prototype.paste = function(sData) {\n\n  var sTmp;\n  var container = this.selected();\n\t\n  //split the data, using double newlines as the separator\n  var aP = sData.split(this._newLine + this._newLine);\n  var rExp = new RegExp(this._newLine, \"g\");\n\n  //add a P for each item\n  if(container && container.tagName.toLowerCase() != WYMeditor.BODY) {\n    for(x = aP.length - 1; x >= 0; x--) {\n        sTmp = aP[x];\n        //simple newlines are replaced by a break\n        sTmp = sTmp.replace(rExp, \"<br />\");\n        jQuery(container).after(\"<p>\" + sTmp + \"</p>\");\n    }\n  } else {\n    for(x = 0; x < aP.length; x++) {\n        sTmp = aP[x];\n        //simple newlines are replaced by a break\n        sTmp = sTmp.replace(rExp, \"<br />\");\n        jQuery(this._doc.body).append(\"<p>\" + sTmp + \"</p>\");\n    }\n  \n  }\n};\n\nWYMeditor.editor.prototype.insert = function(html) {\n    // Do we have a selection?\n    if (this._iframe.contentWindow.getSelection().focusNode != null) {\n        // Overwrite selection with provided html\n        this._exec( WYMeditor.INSERT_HTML, html);\n    } else {\n        // Fall back to the internal paste function if there's no selection\n        this.paste(html)\n    }\n};\n\nWYMeditor.editor.prototype.wrap = function(left, right) {\n    // Do we have a selection?\n    if (this._iframe.contentWindow.getSelection().focusNode != null) {\n        // Wrap selection with provided html\n        this._exec( WYMeditor.INSERT_HTML, left + this._iframe.contentWindow.getSelection().toString() + right);\n    }\n};\n\nWYMeditor.editor.prototype.unwrap = function() {\n    // Do we have a selection?\n    if (this._iframe.contentWindow.getSelection().focusNode != null) {\n        // Unwrap selection\n        this._exec( WYMeditor.INSERT_HTML, this._iframe.contentWindow.getSelection().toString() );\n    }\n};\n\nWYMeditor.editor.prototype.addCssRules = function(doc, aCss) {\n  var styles = doc.styleSheets[0];\n  if(styles) {\n    for(var i = 0; i < aCss.length; i++) {\n      var oCss = aCss[i];\n      if(oCss.name && oCss.css) this.addCssRule(styles, oCss);\n    }\n  }\n};\n\n/********** CONFIGURATION **********/\n\nWYMeditor.editor.prototype.computeBasePath = function() {\n  return jQuery(jQuery.grep(jQuery('script'), function(s){\n    return (s.src && s.src.match(/jquery\\.wymeditor(\\.pack|\\.min|\\.packed)?\\.js(\\?.*)?$/ ))\n  })).attr('src').replace(/jquery\\.wymeditor(\\.pack|\\.min|\\.packed)?\\.js(\\?.*)?$/, '');\n};\n\nWYMeditor.editor.prototype.computeWymPath = function() {\n  return jQuery(jQuery.grep(jQuery('script'), function(s){\n    return (s.src && s.src.match(/jquery\\.wymeditor(\\.pack|\\.min|\\.packed)?\\.js(\\?.*)?$/ ))\n  })).attr('src');\n};\n\nWYMeditor.editor.prototype.computeJqueryPath = function() {\n  return jQuery(jQuery.grep(jQuery('script'), function(s){\n    return (s.src && s.src.match(/jquery(-(.*)){0,1}(\\.pack|\\.min|\\.packed)?\\.js(\\?.*)?$/ ))\n  })).attr('src');\n};\n\nWYMeditor.editor.prototype.computeCssPath = function() {\n  return jQuery(jQuery.grep(jQuery('link'), function(s){\n   return (s.href && s.href.match(/wymeditor\\/skins\\/(.*)screen\\.css(\\?.*)?$/ ))\n  })).attr('href');\n};\n\nWYMeditor.editor.prototype.configureEditorUsingRawCss = function() {\n\n  var CssParser = new WYMeditor.WymCssParser();\n  if(this._options.stylesheet){\n    CssParser.parse(jQuery.ajax({url: this._options.stylesheet,async:false}).responseText);\n  }else{\n    CssParser.parse(this._options.styles, false);\n  }\n\n  if(this._options.classesItems.length == 0) {\n    this._options.classesItems = CssParser.css_settings.classesItems;\n  }\n  if(this._options.editorStyles.length == 0) {\n    this._options.editorStyles = CssParser.css_settings.editorStyles;\n  }\n  if(this._options.dialogStyles.length == 0) {\n    this._options.dialogStyles = CssParser.css_settings.dialogStyles;\n  }\n};\n\n/********** EVENTS **********/\n\nWYMeditor.editor.prototype.listen = function() {\n\n  //don't use jQuery.find() on the iframe body\n  //because of MSIE + jQuery + expando issue (#JQ1143)\n  //jQuery(this._doc.body).find(\"*\").bind(\"mouseup\", this.mouseup);\n  \n  jQuery(this._doc.body).bind(\"mousedown\", this.mousedown);\n  var images = this._doc.body.getElementsByTagName(\"img\");\n  for(var i=0; i < images.length; i++) {\n    jQuery(images[i]).bind(\"mousedown\", this.mousedown);\n  }\n};\n\nWYMeditor.editor.prototype.mousedown = function(evt) {\n  \n  var wym = WYMeditor.INSTANCES[this.ownerDocument.title];\n  wym._selected_image = (this.tagName.toLowerCase() == WYMeditor.IMG) ? this : null;\n  evt.stopPropagation();\n};\n\n/********** SKINS **********/\n\n/*\n * Function: WYMeditor.loadCss\n *      Loads a stylesheet in the document.\n *\n * Parameters:\n *      href - The CSS path.\n */\nWYMeditor.loadCss = function(href) {\n    \n    var link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = href;\n\n    var head = jQuery('head').get(0);\n    head.appendChild(link);\n};\n\n/*\n *  Function: WYMeditor.editor.loadSkin\n *      Loads the skin CSS and initialization script (if needed).\n */\nWYMeditor.editor.prototype.loadSkin = function() {\n\n    //does the user want to automatically load the CSS (default: yes)?\n    //we also test if it hasn't been already loaded by another instance\n    //see below for a better (second) test\n    if(this._options.loadSkin && !WYMeditor.SKINS[this._options.skin]) {\n\n        //check if it hasn't been already loaded\n        //so we don't load it more than once\n        //(we check the existing <link> elements)\n\n        var found = false;\n        var rExp = new RegExp(this._options.skin\n             + '\\/' + WYMeditor.SKINS_DEFAULT_CSS + '$');\n\n        jQuery('link').each( function() {\n            if(this.href.match(rExp)) found = true;\n        });\n\n        //load it, using the skin path\n        if(!found) WYMeditor.loadCss( this._options.skinPath\n            + WYMeditor.SKINS_DEFAULT_CSS );\n    }\n\n    //put the classname (ex. wym_skin_default) on wym_box\n    jQuery(this._box).addClass( \"wym_skin_\" + this._options.skin );\n\n    //does the user want to use some JS to initialize the skin (default: yes)?\n    //also check if it hasn't already been loaded by another instance\n    if(this._options.initSkin && !WYMeditor.SKINS[this._options.skin]) {\n\n        eval(jQuery.ajax({url:this._options.skinPath\n            + WYMeditor.SKINS_DEFAULT_JS, async:false}).responseText);\n    }\n\n    //init the skin, if needed\n    if(WYMeditor.SKINS[this._options.skin]\n    && WYMeditor.SKINS[this._options.skin].init)\n       WYMeditor.SKINS[this._options.skin].init(this);\n\n};\n\n\n/********** DIALOGS **********/\n\nWYMeditor.INIT_DIALOG = function(index) {\n\n  var wym = window.opener.WYMeditor.INSTANCES[index];\n  var doc = window.document;\n  var selected = wym.selected();\n  var dialogType = jQuery(wym._options.dialogTypeSelector).val();\n  var sStamp = wym.uniqueStamp();\n\n  switch(dialogType) {\n\n  case WYMeditor.DIALOG_LINK:\n    //ensure that we select the link to populate the fields\n    if(selected && selected.tagName && selected.tagName.toLowerCase != WYMeditor.A)\n      selected = jQuery(selected).parentsOrSelf(WYMeditor.A);\n\n    //fix MSIE selection if link image has been clicked\n    if(!selected && wym._selected_image)\n      selected = jQuery(wym._selected_image).parentsOrSelf(WYMeditor.A);\n  break;\n\n  }\n\n  //pre-init functions\n  if(jQuery.isFunction(wym._options.preInitDialog))\n    wym._options.preInitDialog(wym,window);\n\n  //add css rules from options\n  var styles = doc.styleSheets[0];\n  var aCss = eval(wym._options.dialogStyles);\n\n  wym.addCssRules(doc, aCss);\n\n  //auto populate fields if selected container (e.g. A)\n  if(selected) {\n    jQuery(wym._options.hrefSelector).val(jQuery(selected).attr(WYMeditor.HREF));\n    jQuery(wym._options.srcSelector).val(jQuery(selected).attr(WYMeditor.SRC));\n    jQuery(wym._options.titleSelector).val(jQuery(selected).attr(WYMeditor.TITLE));\n    jQuery(wym._options.altSelector).val(jQuery(selected).attr(WYMeditor.ALT));\n  }\n\n  //auto populate image fields if selected image\n  if(wym._selected_image) {\n    jQuery(wym._options.dialogImageSelector + \" \" + wym._options.srcSelector)\n      .val(jQuery(wym._selected_image).attr(WYMeditor.SRC));\n    jQuery(wym._options.dialogImageSelector + \" \" + wym._options.titleSelector)\n      .val(jQuery(wym._selected_image).attr(WYMeditor.TITLE));\n    jQuery(wym._options.dialogImageSelector + \" \" + wym._options.altSelector)\n      .val(jQuery(wym._selected_image).attr(WYMeditor.ALT));\n  }\n\n  jQuery(wym._options.dialogLinkSelector + \" \"\n    + wym._options.submitSelector).click(function() {\n\n      var sUrl = jQuery(wym._options.hrefSelector).val();\n      if(sUrl.length > 0) {\n\n        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n        jQuery(\"a[href=\" + sStamp + \"]\", wym._doc.body)\n            .attr(WYMeditor.HREF, sUrl)\n            .attr(WYMeditor.TITLE, jQuery(wym._options.titleSelector).val());\n\n      }\n      window.close();\n  });\n\n  jQuery(wym._options.dialogImageSelector + \" \"\n    + wym._options.submitSelector).click(function() {\n\n      var sUrl = jQuery(wym._options.srcSelector).val();\n      if(sUrl.length > 0) {\n\n        wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n\n        jQuery(\"img[src$=\" + sStamp + \"]\", wym._doc.body)\n            .attr(WYMeditor.SRC, sUrl)\n            .attr(WYMeditor.TITLE, jQuery(wym._options.titleSelector).val())\n            .attr(WYMeditor.ALT, jQuery(wym._options.altSelector).val());\n      }\n      window.close();\n  });\n\n  jQuery(wym._options.dialogTableSelector + \" \"\n    + wym._options.submitSelector).click(function() {\n\n      var iRows = jQuery(wym._options.rowsSelector).val();\n      var iCols = jQuery(wym._options.colsSelector).val();\n\n      if(iRows > 0 && iCols > 0) {\n\n        var table = wym._doc.createElement(WYMeditor.TABLE);\n        var newRow = null;\n\t\tvar newCol = null;\n\n\t\tvar sCaption = jQuery(wym._options.captionSelector).val();\n\n\t\t//we create the caption\n\t\tvar newCaption = table.createCaption();\n\t\tnewCaption.innerHTML = sCaption;\n\n\t\t//we create the rows and cells\n\t\tfor(x=0; x<iRows; x++) {\n\t\t\tnewRow = table.insertRow(x);\n\t\t\tfor(y=0; y<iCols; y++) {newRow.insertCell(y);}\n\t\t}\n\n        //set the summary attr\n        jQuery(table).attr('summary',\n            jQuery(wym._options.summarySelector).val());\n\n        //append the table after the selected container\n        var node = jQuery(wym.findUp(wym.container(),\n          WYMeditor.MAIN_CONTAINERS)).get(0);\n        if(!node || !node.parentNode) jQuery(wym._doc.body).append(table);\n        else jQuery(node).after(table);\n      }\n      window.close();\n  });\n\n  jQuery(wym._options.dialogPasteSelector + \" \"\n    + wym._options.submitSelector).click(function() {\n\n      var sText = jQuery(wym._options.textSelector).val();\n      wym.paste(sText);\n      window.close();\n  });\n\n  jQuery(wym._options.dialogPreviewSelector + \" \"\n    + wym._options.previewSelector)\n    .html(wym.xhtml());\n\n  //cancel button\n  jQuery(wym._options.cancelSelector).mousedown(function() {\n    window.close();\n  });\n\n  //pre-init functions\n  if(jQuery.isFunction(wym._options.postInitDialog))\n    wym._options.postInitDialog(wym,window);\n\n};\n\n/********** XHTML LEXER/PARSER **********/\n\n/*\n* @name xml\n* @description Use these methods to generate XML and XHTML compliant tags and\n* escape tag attributes correctly\n* @author Bermi Ferrer - http://bermi.org\n* @author David Heinemeier Hansson http://loudthinking.com\n*/\nWYMeditor.XmlHelper = function()\n{\n  this._entitiesDiv = document.createElement('div');\n  return this;\n};\n\n\n/*\n* @name tag\n* @description\n* Returns an empty HTML tag of type *name* which by default is XHTML\n* compliant. Setting *open* to true will create an open tag compatible\n* with HTML 4.0 and below. Add HTML attributes by passing an attributes\n* array to *options*. For attributes with no value like (disabled and\n* readonly), give it a value of true in the *options* array.\n*\n* Examples:\n*\n*   this.tag('br')\n*    # => <br />\n*   this.tag ('br', false, true)\n*    # => <br>\n*   this.tag ('input', jQuery({type:'text',disabled:true }) )\n*    # => <input type=\"text\" disabled=\"disabled\" />\n*/\nWYMeditor.XmlHelper.prototype.tag = function(name, options, open)\n{\n  options = options || false;\n  open = open || false;\n  return '<'+name+(options ? this.tagOptions(options) : '')+(open ? '>' : ' />');\n};\n\n/*\n* @name contentTag\n* @description\n* Returns a XML block tag of type *name* surrounding the *content*. Add\n* XML attributes by passing an attributes array to *options*. For attributes\n* with no value like (disabled and readonly), give it a value of true in\n* the *options* array. You can use symbols or strings for the attribute names.\n*\n*   this.contentTag ('p', 'Hello world!' )\n*    # => <p>Hello world!</p>\n*   this.contentTag('div', this.contentTag('p', \"Hello world!\"), jQuery({class : \"strong\"}))\n*    # => <div class=\"strong\"><p>Hello world!</p></div>\n*   this.contentTag(\"select\", options, jQuery({multiple : true}))\n*    # => <select multiple=\"multiple\">...options...</select>\n*/\nWYMeditor.XmlHelper.prototype.contentTag = function(name, content, options)\n{\n  options = options || false;\n  return '<'+name+(options ? this.tagOptions(options) : '')+'>'+content+'</'+name+'>';\n};\n\n/*\n* @name cdataSection\n* @description\n* Returns a CDATA section for the given +content+.  CDATA sections\n* are used to escape blocks of text containing characters which would\n* otherwise be recognized as markup. CDATA sections begin with the string\n* <tt>&lt;![CDATA[</tt> and } with (and may not contain) the string\n* <tt>]]></tt>.\n*/\nWYMeditor.XmlHelper.prototype.cdataSection = function(content)\n{\n  return '<![CDATA['+content+']]>';\n};\n\n\n/*\n* @name escapeOnce\n* @description\n* Returns the escaped +xml+ without affecting existing escaped entities.\n*\n*  this.escapeOnce( \"1 > 2 &amp; 3\")\n*    # => \"1 &gt; 2 &amp; 3\"\n*/\nWYMeditor.XmlHelper.prototype.escapeOnce = function(xml)\n{\n  return this._fixDoubleEscape(this.escapeEntities(xml));\n};\n\n/*\n* @name _fixDoubleEscape\n* @description\n* Fix double-escaped entities, such as &amp;amp;, &amp;#123;, etc.\n*/\nWYMeditor.XmlHelper.prototype._fixDoubleEscape = function(escaped)\n{\n  return escaped.replace(/&amp;([a-z]+|(#\\d+));/ig, \"&$1;\");\n};\n\n/*\n* @name tagOptions\n* @description\n* Takes an array like the one generated by Tag.parseAttributes\n*  [[\"src\", \"http://www.editam.com/?a=b&c=d&amp;f=g\"], [\"title\", \"Editam, <Simplified> CMS\"]]\n* or an object like {src:\"http://www.editam.com/?a=b&c=d&amp;f=g\", title:\"Editam, <Simplified> CMS\"}\n* and returns a string properly escaped like\n* ' src = \"http://www.editam.com/?a=b&amp;c=d&amp;f=g\" title = \"Editam, &lt;Simplified&gt; CMS\"'\n* which is valid for strict XHTML\n*/\nWYMeditor.XmlHelper.prototype.tagOptions = function(options)\n{\n  var xml = this;\n  xml._formated_options = '';\n\n  for (var key in options) {\n    var formated_options = '';\n    var value = options[key];\n    if(typeof value != 'function' && value.length > 0) {\n\n      if(parseInt(key) == key && typeof value == 'object'){\n        key = value.shift();\n        value = value.pop();\n      }\n      if(key != '' && value != ''){\n        xml._formated_options += ' '+key+'=\"'+xml.escapeOnce(value)+'\"';\n      }\n    }\n  }\n  return xml._formated_options;\n};\n\n/*\n* @name escapeEntities\n* @description\n* Escapes XML/HTML entities <, >, & and \". If seccond parameter is set to false it\n* will not escape \". If set to true it will also escape '\n*/\nWYMeditor.XmlHelper.prototype.escapeEntities = function(string, escape_quotes)\n{\n  this._entitiesDiv.innerHTML = string;\n  this._entitiesDiv.textContent = string;\n  var result = this._entitiesDiv.innerHTML;\n  if(typeof escape_quotes == 'undefined'){\n    if(escape_quotes != false) result = result.replace('\"', '&quot;');\n    if(escape_quotes == true)  result = result.replace('\"', '&#039;');\n  }\n  return result;\n};\n\n/*\n* Parses a string conatining tag attributes and values an returns an array formated like\n*  [[\"src\", \"http://www.editam.com\"], [\"title\", \"Editam, Simplified CMS\"]]\n*/\nWYMeditor.XmlHelper.prototype.parseAttributes = function(tag_attributes)\n{\n  // Use a compounded regex to match single quoted, double quoted and unquoted attribute pairs\n  var result = [];\n  var matches = tag_attributes.split(/((=\\s*\")(\")(\"))|((=\\s*\\')(\\')(\\'))|((=\\s*[^>\\s]*))/g);\n  if(matches.toString() != tag_attributes){\n    for (var k in matches) {\n      var v = matches[k];\n      if(typeof v != 'function' && v.length != 0){\n        var re = new RegExp('(\\\\w+)\\\\s*'+v);\n        if(match = tag_attributes.match(re) ){\n          var value = v.replace(/^[\\s=]+/, \"\");\n          var delimiter = value.charAt(0);\n          delimiter = delimiter == '\"' ? '\"' : (delimiter==\"'\"?\"'\":'');\n          if(delimiter != ''){\n            value = delimiter == '\"' ? value.replace(/^\"|\"+$/g, '') :  value.replace(/^'|'+$/g, '');\n          }\n          tag_attributes = tag_attributes.replace(match[0],'');\n          result.push([match[1] , value]);\n        }\n      }\n    }\n  }\n  return result;\n};\n\n/**\n* XhtmlValidator for validating tag attributes\n*\n* @author Bermi Ferrer - http://bermi.org\n*/\nWYMeditor.XhtmlValidator = {\n  \"_attributes\":\n  {\n    \"core\":\n    {\n      \"except\":[\n      \"base\",\n      \"head\",\n      \"html\",\n      \"meta\",\n      \"param\",\n      \"script\",\n      \"style\",\n      \"title\"\n      ],\n      \"attributes\":[\n      \"class\",\n      \"id\",\n      \"style\",\n      \"title\",\n      \"accesskey\",\n      \"tabindex\"\n      ]\n    },\n    \"language\":\n    {\n      \"except\":[\n      \"base\",\n      \"br\",\n      \"hr\",\n      \"iframe\",\n      \"param\",\n      \"script\"\n      ],\n      \"attributes\":\n      {\n        \"dir\":[\n        \"ltr\",\n        \"rtl\"\n        ],\n        \"0\":\"lang\",\n        \"1\":\"xml:lang\"\n      }\n    },\n    \"keyboard\":\n    {\n      \"attributes\":\n      {\n        \"accesskey\":/^(\\w){1}$/,\n        \"tabindex\":/^(\\d)+$/\n      }\n    }\n  },\n  \"_events\":\n  {\n    \"window\":\n    {\n      \"only\":[\n      \"body\"\n      ],\n      \"attributes\":[\n      \"onload\",\n      \"onunload\"\n      ]\n    },\n    \"form\":\n    {\n      \"only\":[\n      \"form\",\n      \"input\",\n      \"textarea\",\n      \"select\",\n      \"a\",\n      \"label\",\n      \"button\"\n      ],\n      \"attributes\":[\n      \"onchange\",\n      \"onsubmit\",\n      \"onreset\",\n      \"onselect\",\n      \"onblur\",\n      \"onfocus\"\n      ]\n    },\n    \"keyboard\":\n    {\n      \"except\":[\n      \"base\",\n      \"bdo\",\n      \"br\",\n      \"frame\",\n      \"frameset\",\n      \"head\",\n      \"html\",\n      \"iframe\",\n      \"meta\",\n      \"param\",\n      \"script\",\n      \"style\",\n      \"title\"\n      ],\n      \"attributes\":[\n      \"onkeydown\",\n      \"onkeypress\",\n      \"onkeyup\"\n      ]\n    },\n    \"mouse\":\n    {\n      \"except\":[\n      \"base\",\n      \"bdo\",\n      \"br\",\n      \"head\",\n      \"html\",\n      \"meta\",\n      \"param\",\n      \"script\",\n      \"style\",\n      \"title\"\n      ],\n      \"attributes\":[\n      \"onclick\",\n      \"ondblclick\",\n      \"onmousedown\",\n      \"onmousemove\",\n      \"onmouseover\",\n      \"onmouseout\",\n      \"onmouseup\"\n      ]\n    }\n  },\n  \"_tags\":\n  {\n    \"a\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"charset\",\n        \"1\":\"coords\",\n        \"2\":\"href\",\n        \"3\":\"hreflang\",\n        \"4\":\"name\",\n        \"rel\":/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon)+$/,\n        \"rev\":/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon)+$/,\n        \"shape\":/^(rect|rectangle|circ|circle|poly|polygon)$/,\n        \"5\":\"type\"\n      }\n    },\n    \"0\":\"abbr\",\n    \"1\":\"acronym\",\n    \"2\":\"address\",\n    \"area\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"alt\",\n        \"1\":\"coords\",\n        \"2\":\"href\",\n        \"nohref\":/^(true|false)$/,\n        \"shape\":/^(rect|rectangle|circ|circle|poly|polygon)$/\n      },\n      \"required\":[\n      \"alt\"\n      ]\n    },\n    \"3\":\"b\",\n    \"base\":\n    {\n      \"attributes\":[\n      \"href\"\n      ],\n      \"required\":[\n      \"href\"\n      ]\n    },\n    \"bdo\":\n    {\n      \"attributes\":\n      {\n        \"dir\":/^(ltr|rtl)$/\n      },\n      \"required\":[\n      \"dir\"\n      ]\n    },\n    \"4\":\"big\",\n    \"blockquote\":\n    {\n      \"attributes\":[\n      \"cite\"\n      ]\n    },\n    \"5\":\"body\",\n    \"6\":\"br\",\n    \"button\":\n    {\n      \"attributes\":\n      {\n        \"disabled\":/^(disabled)$/,\n        \"type\":/^(button|reset|submit)$/,\n        \"0\":\"value\"\n      },\n      \"inside\":\"form\"\n    },\n    \"7\":\"caption\",\n    \"8\":\"cite\",\n    \"9\":\"code\",\n    \"col\":\n    {\n      \"attributes\":\n      {\n        \"align\":/^(right|left|center|justify)$/,\n        \"0\":\"char\",\n        \"1\":\"charoff\",\n        \"span\":/^(\\d)+$/,\n        \"valign\":/^(top|middle|bottom|baseline)$/,\n        \"2\":\"width\"\n      },\n      \"inside\":\"colgroup\"\n    },\n    \"colgroup\":\n    {\n      \"attributes\":\n      {\n        \"align\":/^(right|left|center|justify)$/,\n        \"0\":\"char\",\n        \"1\":\"charoff\",\n        \"span\":/^(\\d)+$/,\n        \"valign\":/^(top|middle|bottom|baseline)$/,\n        \"2\":\"width\"\n      }\n    },\n    \"10\":\"dd\",\n    \"del\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"cite\",\n        \"datetime\":/^([0-9]){8}/\n      }\n    },\n    \"11\":\"div\",\n    \"12\":\"dfn\",\n    \"13\":\"dl\",\n    \"14\":\"dt\",\n    \"15\":\"em\",\n    \"fieldset\":\n    {\n      \"inside\":\"form\"\n    },\n    \"form\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"action\",\n        \"1\":\"accept\",\n        \"2\":\"accept-charset\",\n        \"3\":\"enctype\",\n        \"method\":/^(get|post)$/\n      },\n      \"required\":[\n      \"action\"\n      ]\n    },\n    \"head\":\n    {\n      \"attributes\":[\n      \"profile\"\n      ]\n    },\n    \"16\":\"h1\",\n    \"17\":\"h2\",\n    \"18\":\"h3\",\n    \"19\":\"h4\",\n    \"20\":\"h5\",\n    \"21\":\"h6\",\n    \"22\":\"hr\",\n    \"html\":\n    {\n      \"attributes\":[\n      \"xmlns\"\n      ]\n    },\n    \"23\":\"i\",\n    \"img\":\n    {\n      \"attributes\":[\n      \"alt\",\n      \"src\",\n      \"height\",\n      \"ismap\",\n      \"longdesc\",\n      \"usemap\",\n      \"width\"\n      ],\n      \"required\":[\n      \"alt\",\n      \"src\"\n      ]\n    },\n    \"input\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"accept\",\n        \"1\":\"alt\",\n        \"checked\":/^(checked)$/,\n        \"disabled\":/^(disabled)$/,\n        \"maxlength\":/^(\\d)+$/,\n        \"2\":\"name\",\n        \"readonly\":/^(readonly)$/,\n        \"size\":/^(\\d)+$/,\n        \"3\":\"src\",\n        \"type\":/^(button|checkbox|file|hidden|image|password|radio|reset|submit|text)$/,\n        \"4\":\"value\"\n      },\n      \"inside\":\"form\"\n    },\n    \"ins\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"cite\",\n        \"datetime\":/^([0-9]){8}/\n      }\n    },\n    \"24\":\"kbd\",\n    \"label\":\n    {\n      \"attributes\":[\n      \"for\"\n      ],\n      \"inside\":\"form\"\n    },\n    \"25\":\"legend\",\n    \"26\":\"li\",\n    \"link\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"charset\",\n        \"1\":\"href\",\n        \"2\":\"hreflang\",\n        \"media\":/^(all|braille|print|projection|screen|speech|,|;| )+$/i,\n        //next comment line required by Opera!\n        /*\"rel\":/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,*/\n        \"rel\":/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,\n        \"rev\":/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,\n        \"3\":\"type\"\n      },\n      \"inside\":\"head\"\n    },\n    \"map\":\n    {\n      \"attributes\":[\n      \"id\",\n      \"name\"\n      ],\n      \"required\":[\n      \"id\"\n      ]\n    },\n    \"meta\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"content\",\n        \"http-equiv\":/^(content\\-type|expires|refresh|set\\-cookie)$/i,\n        \"1\":\"name\",\n        \"2\":\"scheme\"\n      },\n      \"required\":[\n      \"content\"\n      ]\n    },\n    \"27\":\"noscript\",\n    \"object\":\n    {\n      \"attributes\":[\n      \"archive\",\n      \"classid\",\n      \"codebase\",\n      \"codetype\",\n      \"data\",\n      \"declare\",\n      \"height\",\n      \"name\",\n      \"standby\",\n      \"type\",\n      \"usemap\",\n      \"width\"\n      ]\n    },\n    \"28\":\"ol\",\n    \"optgroup\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"label\",\n        \"disabled\": /^(disabled)$/\n      },\n      \"required\":[\n      \"label\"\n      ]\n    },\n    \"option\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"label\",\n        \"disabled\":/^(disabled)$/,\n        \"selected\":/^(selected)$/,\n        \"1\":\"value\"\n      },\n      \"inside\":\"select\"\n    },\n    \"29\":\"p\",\n    \"param\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"type\",\n        \"valuetype\":/^(data|ref|object)$/,\n        \"1\":\"valuetype\",\n        \"2\":\"value\"\n      },\n      \"required\":[\n      \"name\"\n      ]\n    },\n    \"30\":\"pre\",\n    \"q\":\n    {\n      \"attributes\":[\n      \"cite\"\n      ]\n    },\n    \"31\":\"samp\",\n    \"script\":\n    {\n      \"attributes\":\n      {\n        \"type\":/^(text\\/ecmascript|text\\/javascript|text\\/jscript|text\\/vbscript|text\\/vbs|text\\/xml)$/,\n        \"0\":\"charset\",\n        \"defer\":/^(defer)$/,\n        \"1\":\"src\"\n      },\n      \"required\":[\n      \"type\"\n      ]\n    },\n    \"select\":\n    {\n      \"attributes\":\n      {\n        \"disabled\":/^(disabled)$/,\n        \"multiple\":/^(multiple)$/,\n        \"0\":\"name\",\n        \"1\":\"size\"\n      },\n      \"inside\":\"form\"\n    },\n    \"32\":\"small\",\n    \"33\":\"span\",\n    \"34\":\"strong\",\n    \"style\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"type\",\n        \"media\":/^(screen|tty|tv|projection|handheld|print|braille|aural|all)$/\n      },\n      \"required\":[\n      \"type\"\n      ]\n    },\n    \"35\":\"sub\",\n    \"36\":\"sup\",\n    \"table\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"border\",\n        \"1\":\"cellpadding\",\n        \"2\":\"cellspacing\",\n        \"frame\":/^(void|above|below|hsides|lhs|rhs|vsides|box|border)$/,\n        \"rules\":/^(none|groups|rows|cols|all)$/,\n        \"3\":\"summary\",\n        \"4\":\"width\"\n      }\n    },\n    \"tbody\":\n    {\n      \"attributes\":\n      {\n        \"align\":/^(right|left|center|justify)$/,\n        \"0\":\"char\",\n        \"1\":\"charoff\",\n        \"valign\":/^(top|middle|bottom|baseline)$/\n      }\n    },\n    \"td\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"abbr\",\n        \"align\":/^(left|right|center|justify|char)$/,\n        \"1\":\"axis\",\n        \"2\":\"char\",\n        \"3\":\"charoff\",\n        \"colspan\":/^(\\d)+$/,\n        \"4\":\"headers\",\n        \"rowspan\":/^(\\d)+$/,\n        \"scope\":/^(col|colgroup|row|rowgroup)$/,\n        \"valign\":/^(top|middle|bottom|baseline)$/\n      }\n    },\n    \"textarea\":\n    {\n      \"attributes\":[\n      \"cols\",\n      \"rows\",\n      \"disabled\",\n      \"name\",\n      \"readonly\"\n      ],\n      \"required\":[\n      \"cols\",\n      \"rows\"\n      ],\n      \"inside\":\"form\"\n    },\n    \"tfoot\":\n    {\n      \"attributes\":\n      {\n        \"align\":/^(right|left|center|justify)$/,\n        \"0\":\"char\",\n        \"1\":\"charoff\",\n        \"valign\":/^(top|middle|bottom)$/,\n        \"2\":\"baseline\"\n      }\n    },\n    \"th\":\n    {\n      \"attributes\":\n      {\n        \"0\":\"abbr\",\n        \"align\":/^(left|right|center|justify|char)$/,\n        \"1\":\"axis\",\n        \"2\":\"char\",\n        \"3\":\"charoff\",\n        \"colspan\":/^(\\d)+$/,\n        \"4\":\"headers\",\n        \"rowspan\":/^(\\d)+$/,\n        \"scope\":/^(col|colgroup|row|rowgroup)$/,\n        \"valign\":/^(top|middle|bottom|baseline)$/\n      }\n    },\n    \"thead\":\n    {\n      \"attributes\":\n      {\n        \"align\":/^(right|left|center|justify)$/,\n        \"0\":\"char\",\n        \"1\":\"charoff\",\n        \"valign\":/^(top|middle|bottom|baseline)$/\n      }\n    },\n    \"37\":\"title\",\n    \"tr\":\n    {\n      \"attributes\":\n      {\n        \"align\":/^(right|left|center|justify|char)$/,\n        \"0\":\"char\",\n        \"1\":\"charoff\",\n        \"valign\":/^(top|middle|bottom|baseline)$/\n      }\n    },\n    \"38\":\"tt\",\n    \"39\":\"ul\",\n    \"40\":\"var\"\n  },\n\n  // Temporary skiped attributes\n  skiped_attributes : [],\n  skiped_attribute_values : [],\n\n  getValidTagAttributes: function(tag, attributes)\n  {\n    var valid_attributes = {};\n    var possible_attributes = this.getPossibleTagAttributes(tag);\n    for(var attribute in attributes) {\n      var value = attributes[attribute];\n      var h = WYMeditor.Helper;\n      if(!h.contains(this.skiped_attributes, attribute) && !h.contains(this.skiped_attribute_values, value)){\n        if (typeof value != 'function' && h.contains(possible_attributes, attribute)) {\n          if (this.doesAttributeNeedsValidation(tag, attribute)) {\n            if(this.validateAttribute(tag, attribute, value)){\n              valid_attributes[attribute] = value;\n            }\n          }else{\n            valid_attributes[attribute] = value;\n          }\n        }\n      }\n    }\n    return valid_attributes;\n  },\n  getUniqueAttributesAndEventsForTag : function(tag)\n  {\n    var result = [];\n\n    if (this._tags[tag] && this._tags[tag]['attributes']) {\n      for (k in this._tags[tag]['attributes']) {\n        result.push(parseInt(k) == k ? this._tags[tag]['attributes'][k] : k);\n      }\n    }\n    return result;\n  },\n  getDefaultAttributesAndEventsForTags : function()\n  {\n    var result = [];\n    for (var key in this._events){\n      result.push(this._events[key]);\n    }\n    for (var key in this._attributes){\n      result.push(this._attributes[key]);\n    }\n    return result;\n  },\n  isValidTag : function(tag)\n  {\n    if(this._tags[tag]){\n      return true;\n    }\n    for(var key in this._tags){\n      if(this._tags[key] == tag){\n        return true;\n      }\n    }\n    return false;\n  },\n  getDefaultAttributesAndEventsForTag : function(tag)\n  {\n    var default_attributes = [];\n    if (this.isValidTag(tag)) {\n      var default_attributes_and_events = this.getDefaultAttributesAndEventsForTags();\n\n      for(var key in default_attributes_and_events) {\n        var defaults = default_attributes_and_events[key];\n        if(typeof defaults == 'object'){\n          var h = WYMeditor.Helper;\n          if ((defaults['except'] && h.contains(defaults['except'], tag)) || (defaults['only'] && !h.contains(defaults['only'], tag))) {\n            continue;\n          }\n\n          var tag_defaults = defaults['attributes'] ? defaults['attributes'] : defaults['events'];\n          for(var k in tag_defaults) {\n            default_attributes.push(typeof tag_defaults[k] != 'string' ? k : tag_defaults[k]);\n          }\n        }\n      }\n    }\n    return default_attributes;\n  },\n  doesAttributeNeedsValidation: function(tag, attribute)\n  {\n    return this._tags[tag] && ((this._tags[tag]['attributes'] && this._tags[tag]['attributes'][attribute]) || (this._tags[tag]['required'] &&\n     WYMeditor.Helper.contains(this._tags[tag]['required'], attribute)));\n  },\n  validateAttribute : function(tag, attribute, value)\n  {\n    if ( this._tags[tag] &&\n      (this._tags[tag]['attributes'] && this._tags[tag]['attributes'][attribute] && value.length > 0 && !value.match(this._tags[tag]['attributes'][attribute])) || // invalid format\n      (this._tags[tag] && this._tags[tag]['required'] && WYMeditor.Helper.contains(this._tags[tag]['required'], attribute) && value.length == 0) // required attribute\n    ) {\n      return false;\n    }\n    return typeof this._tags[tag] != 'undefined';\n  },\n  getPossibleTagAttributes : function(tag)\n  {\n    if (!this._possible_tag_attributes) {\n      this._possible_tag_attributes = {};\n    }\n    if (!this._possible_tag_attributes[tag]) {\n      this._possible_tag_attributes[tag] = this.getUniqueAttributesAndEventsForTag(tag).concat(this.getDefaultAttributesAndEventsForTag(tag));\n    }\n    return this._possible_tag_attributes[tag];\n  }\n};\n\n\n/**\n*    Compounded regular expression. Any of\n*    the contained patterns could match and\n*    when one does, its label is returned.\n*\n*    Constructor. Starts with no patterns.\n*    @param boolean case    True for case sensitive, false\n*                            for insensitive.\n*    @access public\n*    @author Marcus Baker (http://lastcraft.com)\n*    @author Bermi Ferrer (http://bermi.org)\n*/\nWYMeditor.ParallelRegex = function(case_sensitive)\n{\n  this._case = case_sensitive;\n  this._patterns = [];\n  this._labels = [];\n  this._regex = null;\n  return this;\n};\n\n\n/**\n*    Adds a pattern with an optional label.\n*    @param string pattern      Perl style regex, but ( and )\n*                                lose the usual meaning.\n*    @param string label        Label of regex to be returned\n*                                on a match.\n*    @access public\n*/\nWYMeditor.ParallelRegex.prototype.addPattern = function(pattern, label)\n{\n  label = label || true;\n  var count = this._patterns.length;\n  this._patterns[count] = pattern;\n  this._labels[count] = label;\n  this._regex = null;\n};\n\n/**\n*    Attempts to match all patterns at once against\n*    a string.\n*    @param string subject      String to match against.\n*\n*    @return boolean             True on success.\n*    @return string match         First matched portion of\n*                                subject.\n*    @access public\n*/\nWYMeditor.ParallelRegex.prototype.match = function(subject)\n{\n  if (this._patterns.length == 0) {\n    return [false, ''];\n  }\n  var matches = subject.match(this._getCompoundedRegex());\n\n  if(!matches){\n    return [false, ''];\n  }\n  var match = matches[0];\n  for (var i = 1; i < matches.length; i++) {\n    if (matches[i]) {\n      return [this._labels[i-1], match];\n    }\n  }\n  return [true, matches[0]];\n};\n\n/**\n*    Compounds the patterns into a single\n*    regular expression separated with the\n*    \"or\" operator. Caches the regex.\n*    Will automatically escape (, ) and / tokens.\n*    @param array patterns    List of patterns in order.\n*    @access private\n*/\nWYMeditor.ParallelRegex.prototype._getCompoundedRegex = function()\n{\n  if (this._regex == null) {\n    for (var i = 0, count = this._patterns.length; i < count; i++) {\n      this._patterns[i] = '(' + this._untokenizeRegex(this._tokenizeRegex(this._patterns[i]).replace(/([\\/\\(\\)])/g,'\\\\$1')) + ')';\n    }\n    this._regex = new RegExp(this._patterns.join(\"|\") ,this._getPerlMatchingFlags());\n  }\n  return this._regex;\n};\n\n/**\n* Escape lookahead/lookbehind blocks\n*/\nWYMeditor.ParallelRegex.prototype._tokenizeRegex = function(regex)\n{\n  return regex.\n  replace(/\\(\\?(i|m|s|x|U)\\)/,     '~~~~~~Tk1\\$1~~~~~~').\n  replace(/\\(\\?(\\-[i|m|s|x|U])\\)/, '~~~~~~Tk2\\$1~~~~~~').\n  replace(/\\(\\?\\=(.*)\\)/,          '~~~~~~Tk3\\$1~~~~~~').\n  replace(/\\(\\?\\!(.*)\\)/,          '~~~~~~Tk4\\$1~~~~~~').\n  replace(/\\(\\?\\<\\=(.*)\\)/,        '~~~~~~Tk5\\$1~~~~~~').\n  replace(/\\(\\?\\<\\!(.*)\\)/,        '~~~~~~Tk6\\$1~~~~~~').\n  replace(/\\(\\?\\:(.*)\\)/,          '~~~~~~Tk7\\$1~~~~~~');\n};\n\n/**\n* Unscape lookahead/lookbehind blocks\n*/\nWYMeditor.ParallelRegex.prototype._untokenizeRegex = function(regex)\n{\n  return regex.\n  replace(/~~~~~~Tk1(.{1})~~~~~~/,    \"(?\\$1)\").\n  replace(/~~~~~~Tk2(.{2})~~~~~~/,    \"(?\\$1)\").\n  replace(/~~~~~~Tk3(.*)~~~~~~/,      \"(?=\\$1)\").\n  replace(/~~~~~~Tk4(.*)~~~~~~/,      \"(?!\\$1)\").\n  replace(/~~~~~~Tk5(.*)~~~~~~/,      \"(?<=\\$1)\").\n  replace(/~~~~~~Tk6(.*)~~~~~~/,      \"(?<!\\$1)\").\n  replace(/~~~~~~Tk7(.*)~~~~~~/,      \"(?:\\$1)\");\n};\n\n\n/**\n*    Accessor for perl regex mode flags to use.\n*    @return string       Perl regex flags.\n*    @access private\n*/\nWYMeditor.ParallelRegex.prototype._getPerlMatchingFlags = function()\n{\n  return (this._case ? \"m\" : \"mi\");\n};\n\n\n\n/**\n*    States for a stack machine.\n*\n*    Constructor. Starts in named state.\n*    @param string start        Starting state name.\n*    @access public\n*    @author Marcus Baker (http://lastcraft.com)\n*    @author Bermi Ferrer (http://bermi.org)\n*/\nWYMeditor.StateStack = function(start)\n{\n  this._stack = [start];\n  return this;\n};\n\n/**\n*    Accessor for current state.\n*    @return string       State.\n*    @access public\n*/\nWYMeditor.StateStack.prototype.getCurrent = function()\n{\n  return this._stack[this._stack.length - 1];\n};\n\n/**\n*    Adds a state to the stack and sets it\n*    to be the current state.\n*    @param string state        New state.\n*    @access public\n*/\nWYMeditor.StateStack.prototype.enter = function(state)\n{\n  this._stack.push(state);\n};\n\n/**\n*    Leaves the current state and reverts\n*    to the previous one.\n*    @return boolean    False if we drop off\n*                       the bottom of the list.\n*    @access public\n*/\nWYMeditor.StateStack.prototype.leave = function()\n{\n  if (this._stack.length == 1) {\n    return false;\n  }\n  this._stack.pop();\n  return true;\n};\n\n\n// GLOBALS\nWYMeditor.LEXER_ENTER = 1;\nWYMeditor.LEXER_MATCHED = 2;\nWYMeditor.LEXER_UNMATCHED = 3;\nWYMeditor.LEXER_EXIT = 4;\nWYMeditor.LEXER_SPECIAL = 5;\n\n\n/**\n*    Accepts text and breaks it into tokens.\n*    Some optimisation to make the sure the\n*    content is only scanned by the PHP regex\n*    parser once. Lexer modes must not start\n*    with leading underscores.\n*\n*    Sets up the lexer in case insensitive matching\n*    by default.\n*    @param Parser parser  Handling strategy by reference.\n*    @param string start            Starting handler.\n*    @param boolean case            True for case sensitive.\n*    @access public\n*    @author Marcus Baker (http://lastcraft.com)\n*    @author Bermi Ferrer (http://bermi.org)\n*/\nWYMeditor.Lexer = function(parser, start, case_sensitive)\n{\n  start = start || 'accept';\n  this._case = case_sensitive || false;\n  this._regexes = {};\n  this._parser = parser;\n  this._mode = new WYMeditor.StateStack(start);\n  this._mode_handlers = {};\n  this._mode_handlers[start] = start;\n  return this;\n};\n\n/**\n*    Adds a token search pattern for a particular\n*    parsing mode. The pattern does not change the\n*    current mode.\n*    @param string pattern      Perl style regex, but ( and )\n*                                lose the usual meaning.\n*    @param string mode         Should only apply this\n*                                pattern when dealing with\n*                                this type of input.\n*    @access public\n*/\nWYMeditor.Lexer.prototype.addPattern = function(pattern, mode)\n{\n  var mode = mode || \"accept\";\n  if (typeof this._regexes[mode] == 'undefined') {\n    this._regexes[mode] = new WYMeditor.ParallelRegex(this._case);\n  }\n  this._regexes[mode].addPattern(pattern);\n  if (typeof this._mode_handlers[mode] == 'undefined') {\n    this._mode_handlers[mode] = mode;\n  }\n};\n\n/**\n*    Adds a pattern that will enter a new parsing\n*    mode. Useful for entering parenthesis, strings,\n*    tags, etc.\n*    @param string pattern      Perl style regex, but ( and )\n*                                lose the usual meaning.\n*    @param string mode         Should only apply this\n*                                pattern when dealing with\n*                                this type of input.\n*    @param string new_mode     Change parsing to this new\n*                                nested mode.\n*    @access public\n*/\nWYMeditor.Lexer.prototype.addEntryPattern = function(pattern, mode, new_mode)\n{\n  if (typeof this._regexes[mode] == 'undefined') {\n    this._regexes[mode] = new WYMeditor.ParallelRegex(this._case);\n  }\n  this._regexes[mode].addPattern(pattern, new_mode);\n  if (typeof this._mode_handlers[new_mode] == 'undefined') {\n    this._mode_handlers[new_mode] = new_mode;\n  }\n};\n\n/**\n*    Adds a pattern that will exit the current mode\n*    and re-enter the previous one.\n*    @param string pattern      Perl style regex, but ( and )\n*                                lose the usual meaning.\n*    @param string mode         Mode to leave.\n*    @access public\n*/\nWYMeditor.Lexer.prototype.addExitPattern = function(pattern, mode)\n{\n  if (typeof this._regexes[mode] == 'undefined') {\n    this._regexes[mode] = new WYMeditor.ParallelRegex(this._case);\n  }\n  this._regexes[mode].addPattern(pattern, \"__exit\");\n  if (typeof this._mode_handlers[mode] == 'undefined') {\n    this._mode_handlers[mode] = mode;\n  }\n};\n\n/**\n*    Adds a pattern that has a special mode. Acts as an entry\n*    and exit pattern in one go, effectively calling a special\n*    parser handler for this token only.\n*    @param string pattern      Perl style regex, but ( and )\n*                                lose the usual meaning.\n*    @param string mode         Should only apply this\n*                                pattern when dealing with\n*                                this type of input.\n*    @param string special      Use this mode for this one token.\n*    @access public\n*/\nWYMeditor.Lexer.prototype.addSpecialPattern =  function(pattern, mode, special)\n{\n  if (typeof this._regexes[mode] == 'undefined') {\n    this._regexes[mode] = new WYMeditor.ParallelRegex(this._case);\n  }\n  this._regexes[mode].addPattern(pattern, '_'+special);\n  if (typeof this._mode_handlers[special] == 'undefined') {\n    this._mode_handlers[special] = special;\n  }\n};\n\n/**\n*    Adds a mapping from a mode to another handler.\n*    @param string mode        Mode to be remapped.\n*    @param string handler     New target handler.\n*    @access public\n*/\nWYMeditor.Lexer.prototype.mapHandler = function(mode, handler)\n{\n  this._mode_handlers[mode] = handler;\n};\n\n/**\n*    Splits the page text into tokens. Will fail\n*    if the handlers report an error or if no\n*    content is consumed. If successful then each\n*    unparsed and parsed token invokes a call to the\n*    held listener.\n*    @param string raw        Raw HTML text.\n*    @return boolean           True on success, else false.\n*    @access public\n*/\nWYMeditor.Lexer.prototype.parse = function(raw)\n{\n  if (typeof this._parser == 'undefined') {\n    return false;\n  }\n\n  var length = raw.length;\n  var parsed;\n  while (typeof (parsed = this._reduce(raw)) == 'object') {\n    var raw = parsed[0];\n    var unmatched = parsed[1];\n    var matched = parsed[2];\n    var mode = parsed[3];\n\n    if (! this._dispatchTokens(unmatched, matched, mode)) {\n      return false;\n    }\n\n    if (raw == '') {\n      return true;\n    }\n    if (raw.length == length) {\n      return false;\n    }\n    length = raw.length;\n  }\n  if (! parsed ) {\n    return false;\n  }\n\n  return this._invokeParser(raw, WYMeditor.LEXER_UNMATCHED);\n};\n\n/**\n*    Sends the matched token and any leading unmatched\n*    text to the parser changing the lexer to a new\n*    mode if one is listed.\n*    @param string unmatched    Unmatched leading portion.\n*    @param string matched      Actual token match.\n*    @param string mode         Mode after match. A boolean\n*                                false mode causes no change.\n*    @return boolean             False if there was any error\n*                                from the parser.\n*    @access private\n*/\nWYMeditor.Lexer.prototype._dispatchTokens = function(unmatched, matched, mode)\n{\n  mode = mode || false;\n\n  if (! this._invokeParser(unmatched, WYMeditor.LEXER_UNMATCHED)) {\n    return false;\n  }\n\n  if (typeof mode == 'boolean') {\n    return this._invokeParser(matched, WYMeditor.LEXER_MATCHED);\n  }\n  if (this._isModeEnd(mode)) {\n    if (! this._invokeParser(matched, WYMeditor.LEXER_EXIT)) {\n      return false;\n    }\n    return this._mode.leave();\n  }\n  if (this._isSpecialMode(mode)) {\n    this._mode.enter(this._decodeSpecial(mode));\n    if (! this._invokeParser(matched, WYMeditor.LEXER_SPECIAL)) {\n      return false;\n    }\n    return this._mode.leave();\n  }\n  this._mode.enter(mode);\n\n  return this._invokeParser(matched, WYMeditor.LEXER_ENTER);\n};\n\n/**\n*    Tests to see if the new mode is actually to leave\n*    the current mode and pop an item from the matching\n*    mode stack.\n*    @param string mode    Mode to test.\n*    @return boolean        True if this is the exit mode.\n*    @access private\n*/\nWYMeditor.Lexer.prototype._isModeEnd = function(mode)\n{\n  return (mode === \"__exit\");\n};\n\n/**\n*    Test to see if the mode is one where this mode\n*    is entered for this token only and automatically\n*    leaves immediately afterwoods.\n*    @param string mode    Mode to test.\n*    @return boolean        True if this is the exit mode.\n*    @access private\n*/\nWYMeditor.Lexer.prototype._isSpecialMode = function(mode)\n{\n  return (mode.substring(0,1) == \"_\");\n};\n\n/**\n*    Strips the magic underscore marking single token\n*    modes.\n*    @param string mode    Mode to decode.\n*    @return string         Underlying mode name.\n*    @access private\n*/\nWYMeditor.Lexer.prototype._decodeSpecial = function(mode)\n{\n  return mode.substring(1);\n};\n\n/**\n*    Calls the parser method named after the current\n*    mode. Empty content will be ignored. The lexer\n*    has a parser handler for each mode in the lexer.\n*    @param string content        Text parsed.\n*    @param boolean is_match      Token is recognised rather\n*                                  than unparsed data.\n*    @access private\n*/\nWYMeditor.Lexer.prototype._invokeParser = function(content, is_match)\n{\n\n  if (!/ +/.test(content) && ((content === '') || (content == false))) {\n    return true;\n  }\n  var current = this._mode.getCurrent();\n  var handler = this._mode_handlers[current];\n  var result;\n  eval('result = this._parser.' + handler + '(content, is_match);');\n  return result;\n};\n\n/**\n*    Tries to match a chunk of text and if successful\n*    removes the recognised chunk and any leading\n*    unparsed data. Empty strings will not be matched.\n*    @param string raw         The subject to parse. This is the\n*                               content that will be eaten.\n*    @return array/boolean      Three item list of unparsed\n*                               content followed by the\n*                               recognised token and finally the\n*                               action the parser is to take.\n*                               True if no match, false if there\n*                               is a parsing error.\n*    @access private\n*/\nWYMeditor.Lexer.prototype._reduce = function(raw)\n{\n  var matched = this._regexes[this._mode.getCurrent()].match(raw);\n  var match = matched[1];\n  var action = matched[0];\n  if (action) {\n    var unparsed_character_count = raw.indexOf(match);\n    var unparsed = raw.substr(0, unparsed_character_count);\n    raw = raw.substring(unparsed_character_count + match.length);\n    return [raw, unparsed, match, action];\n  }\n  return true;\n};\n\n\n\n/**\n* This are the rules for breaking the XHTML code into events\n* handled by the provided parser.\n*\n*    @author Marcus Baker (http://lastcraft.com)\n*    @author Bermi Ferrer (http://bermi.org)\n*/\nWYMeditor.XhtmlLexer = function(parser)\n{\n  jQuery.extend(this, new WYMeditor.Lexer(parser, 'Text'));\n\n  this.mapHandler('Text', 'Text');\n\n  this.addTokens();\n\n  this.init();\n\n  return this;\n};\n\n\nWYMeditor.XhtmlLexer.prototype.init = function()\n{\n};\n\nWYMeditor.XhtmlLexer.prototype.addTokens = function()\n{\n  this.addCommentTokens('Text');\n  this.addScriptTokens('Text');\n  this.addCssTokens('Text');\n  this.addTagTokens('Text');\n};\n\nWYMeditor.XhtmlLexer.prototype.addCommentTokens = function(scope)\n{\n  this.addEntryPattern(\"<!--\", scope, 'Comment');\n  this.addExitPattern(\"-->\", 'Comment');\n};\n\nWYMeditor.XhtmlLexer.prototype.addScriptTokens = function(scope)\n{\n  this.addEntryPattern(\"<script\", scope, 'Script');\n  this.addExitPattern(\"</script>\", 'Script');\n};\n\nWYMeditor.XhtmlLexer.prototype.addCssTokens = function(scope)\n{\n  this.addEntryPattern(\"<style\", scope, 'Css');\n  this.addExitPattern(\"</style>\", 'Css');\n};\n\nWYMeditor.XhtmlLexer.prototype.addTagTokens = function(scope)\n{\n  this.addSpecialPattern(\"<\\\\s*[a-z0-9:\\-]+\\\\s*>\", scope, 'OpeningTag');\n  this.addEntryPattern(\"<[a-z0-9:\\-]+\"+'[\\\\\\/ \\\\\\>]+', scope, 'OpeningTag');\n  this.addInTagDeclarationTokens('OpeningTag');\n\n  this.addSpecialPattern(\"</\\\\s*[a-z0-9:\\-]+\\\\s*>\", scope, 'ClosingTag');\n\n};\n\nWYMeditor.XhtmlLexer.prototype.addInTagDeclarationTokens = function(scope)\n{\n  this.addSpecialPattern('\\\\s+', scope, 'Ignore');\n\n  this.addAttributeTokens(scope);\n\n  this.addExitPattern('/>', scope);\n  this.addExitPattern('>', scope);\n\n};\n\nWYMeditor.XhtmlLexer.prototype.addAttributeTokens = function(scope)\n{\n  this.addSpecialPattern(\"\\\\s*[a-z-_0-9]*:?[a-z-_0-9]+\\\\s*(?=\\=)\\\\s*\", scope, 'TagAttributes');\n\n  this.addEntryPattern('=\\\\s*\"', scope, 'DoubleQuotedAttribute');\n  this.addPattern(\"\\\\\\\\\\\"\", 'DoubleQuotedAttribute');\n  this.addExitPattern('\"', 'DoubleQuotedAttribute');\n\n  this.addEntryPattern(\"=\\\\s*'\", scope, 'SingleQuotedAttribute');\n  this.addPattern(\"\\\\\\\\'\", 'SingleQuotedAttribute');\n  this.addExitPattern(\"'\", 'SingleQuotedAttribute');\n\n  this.addSpecialPattern('=\\\\s*[^>\\\\s]*', scope, 'UnquotedAttribute');\n};\n\n\n\n/**\n* XHTML Parser.\n*\n* This XHTML parser will trigger the events available on on\n* current SaxListener\n*\n*    @author Bermi Ferrer (http://bermi.org)\n*/\nWYMeditor.XhtmlParser = function(Listener, mode)\n{\n  var mode = mode || 'Text';\n  this._Lexer = new WYMeditor.XhtmlLexer(this);\n  this._Listener = Listener;\n  this._mode = mode;\n  this._matches = [];\n  this._last_match = '';\n  this._current_match = '';\n\n  return this;\n};\n\nWYMeditor.XhtmlParser.prototype.parse = function(raw)\n{\n  this._Lexer.parse(this.beforeParsing(raw));\n  return this.afterParsing(this._Listener.getResult());\n};\n\nWYMeditor.XhtmlParser.prototype.beforeParsing = function(raw)\n{\n  if(raw.match(/class=\"MsoNormal\"/) || raw.match(/ns = \"urn:schemas-microsoft-com/)){\n    // Usefull for cleaning up content pasted from other sources (MSWord)\n    this._Listener.avoidStylingTagsAndAttributes();\n  }\n  return this._Listener.beforeParsing(raw);\n};\n\nWYMeditor.XhtmlParser.prototype.afterParsing = function(parsed)\n{\n  if(this._Listener._avoiding_tags_implicitly){\n    this._Listener.allowStylingTagsAndAttributes();\n  }\n  return this._Listener.afterParsing(parsed);\n};\n\n\nWYMeditor.XhtmlParser.prototype.Ignore = function(match, state)\n{\n  return true;\n};\n\nWYMeditor.XhtmlParser.prototype.Text = function(text)\n{\n  this._Listener.addContent(text);\n  return true;\n};\n\nWYMeditor.XhtmlParser.prototype.Comment = function(match, status)\n{\n  return this._addNonTagBlock(match, status, 'addComment');\n};\n\nWYMeditor.XhtmlParser.prototype.Script = function(match, status)\n{\n  return this._addNonTagBlock(match, status, 'addScript');\n};\n\nWYMeditor.XhtmlParser.prototype.Css = function(match, status)\n{\n  return this._addNonTagBlock(match, status, 'addCss');\n};\n\nWYMeditor.XhtmlParser.prototype._addNonTagBlock = function(match, state, type)\n{\n  switch (state){\n    case WYMeditor.LEXER_ENTER:\n    this._non_tag = match;\n    break;\n    case WYMeditor.LEXER_UNMATCHED:\n    this._non_tag += match;\n    break;\n    case WYMeditor.LEXER_EXIT:\n    switch(type) {\n      case 'addComment':\n      this._Listener.addComment(this._non_tag+match);\n      break;\n      case 'addScript':\n      this._Listener.addScript(this._non_tag+match);\n      break;\n      case 'addCss':\n      this._Listener.addCss(this._non_tag+match);\n      break;\n    }\n  }\n  return true;\n};\n\nWYMeditor.XhtmlParser.prototype.OpeningTag = function(match, state)\n{\n  switch (state){\n    case WYMeditor.LEXER_ENTER:\n    this._tag = this.normalizeTag(match);\n    this._tag_attributes = {};\n    break;\n    case WYMeditor.LEXER_SPECIAL:\n    this._callOpenTagListener(this.normalizeTag(match));\n    break;\n    case WYMeditor.LEXER_EXIT:\n    this._callOpenTagListener(this._tag, this._tag_attributes);\n  }\n  return true;\n};\n\nWYMeditor.XhtmlParser.prototype.ClosingTag = function(match, state)\n{\n  this._callCloseTagListener(this.normalizeTag(match));\n  return true;\n};\n\nWYMeditor.XhtmlParser.prototype._callOpenTagListener = function(tag, attributes)\n{\n  var  attributes = attributes || {};\n  this.autoCloseUnclosedBeforeNewOpening(tag);\n\n  if(this._Listener.isBlockTag(tag)){\n    this._Listener._tag_stack.push(tag);\n    this._Listener.fixNestingBeforeOpeningBlockTag(tag, attributes);\n    this._Listener.openBlockTag(tag, attributes);\n    this._increaseOpenTagCounter(tag);\n  }else if(this._Listener.isInlineTag(tag)){\n    this._Listener.inlineTag(tag, attributes);\n  }else{\n    this._Listener.openUnknownTag(tag, attributes);\n    this._increaseOpenTagCounter(tag);\n  }\n  this._Listener.last_tag = tag;\n  this._Listener.last_tag_opened = true;\n  this._Listener.last_tag_attributes = attributes;\n};\n\nWYMeditor.XhtmlParser.prototype._callCloseTagListener = function(tag)\n{\n  if(this._decreaseOpenTagCounter(tag)){\n    this.autoCloseUnclosedBeforeTagClosing(tag);\n\n    if(this._Listener.isBlockTag(tag)){\n      var expected_tag = this._Listener._tag_stack.pop();\n      if(expected_tag == false){\n        return;\n      }else if(expected_tag != tag){\n        tag = expected_tag;\n      }\n      this._Listener.closeBlockTag(tag);\n    }else{\n      this._Listener.closeUnknownTag(tag);\n    }\n  }else{\n    this._Listener.closeUnopenedTag(tag);\n  }\n  this._Listener.last_tag = tag;\n  this._Listener.last_tag_opened = false;\n};\n\nWYMeditor.XhtmlParser.prototype._increaseOpenTagCounter = function(tag)\n{\n  this._Listener._open_tags[tag] = this._Listener._open_tags[tag] || 0;\n  this._Listener._open_tags[tag]++;\n};\n\nWYMeditor.XhtmlParser.prototype._decreaseOpenTagCounter = function(tag)\n{\n  if(this._Listener._open_tags[tag]){\n    this._Listener._open_tags[tag]--;\n    if(this._Listener._open_tags[tag] == 0){\n      this._Listener._open_tags[tag] = undefined;\n    }\n    return true;\n  }\n  return false;\n};\n\nWYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeNewOpening = function(new_tag)\n{\n  this._autoCloseUnclosed(new_tag, false);\n};\n\nWYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeTagClosing = function(tag)\n{\n  this._autoCloseUnclosed(tag, true);\n};\n\nWYMeditor.XhtmlParser.prototype._autoCloseUnclosed = function(new_tag, closing)\n{\n  var closing = closing || false;\n  if(this._Listener._open_tags){\n    for (var tag in this._Listener._open_tags) {\n      var counter = this._Listener._open_tags[tag];\n      if(counter > 0 && this._Listener.shouldCloseTagAutomatically(tag, new_tag, closing)){\n        this._callCloseTagListener(tag, true);\n      }\n    }\n  }\n};\n\nWYMeditor.XhtmlParser.prototype.getTagReplacements = function()\n{\n  return this._Listener.getTagReplacements();\n};\n\nWYMeditor.XhtmlParser.prototype.normalizeTag = function(tag)\n{\n  tag = tag.replace(/^([\\s<\\/>]*)|([\\s<\\/>]*)$/gm,'').toLowerCase();\n  var tags = this._Listener.getTagReplacements();\n  if(tags[tag]){\n    return tags[tag];\n  }\n  return tag;\n};\n\nWYMeditor.XhtmlParser.prototype.TagAttributes = function(match, state)\n{\n  if(WYMeditor.LEXER_SPECIAL == state){\n    this._current_attribute = match;\n  }\n  return true;\n};\n\nWYMeditor.XhtmlParser.prototype.DoubleQuotedAttribute = function(match, state)\n{\n  if(WYMeditor.LEXER_UNMATCHED == state){\n    this._tag_attributes[this._current_attribute] = match;\n  }\n  return true;\n};\n\nWYMeditor.XhtmlParser.prototype.SingleQuotedAttribute = function(match, state)\n{\n  if(WYMeditor.LEXER_UNMATCHED == state){\n    this._tag_attributes[this._current_attribute] = match;\n  }\n  return true;\n};\n\nWYMeditor.XhtmlParser.prototype.UnquotedAttribute = function(match, state)\n{\n  this._tag_attributes[this._current_attribute] = match.replace(/^=/,'');\n  return true;\n};\n\n\n\n/**\n* XHTML Sax parser.\n*\n*    @author Bermi Ferrer (http://bermi.org)\n*/\nWYMeditor.XhtmlSaxListener = function()\n{\n  this.output = '';\n  this.helper = new WYMeditor.XmlHelper();\n  this._open_tags = {};\n  this.validator = WYMeditor.XhtmlValidator;\n  this._tag_stack = [];\n  this.avoided_tags = [];\n\n  this.entities = {\n    '&nbsp;':'&#160;','&iexcl;':'&#161;','&cent;':'&#162;',\n    '&pound;':'&#163;','&curren;':'&#164;','&yen;':'&#165;',\n    '&brvbar;':'&#166;','&sect;':'&#167;','&uml;':'&#168;',\n    '&copy;':'&#169;','&ordf;':'&#170;','&laquo;':'&#171;',\n    '&not;':'&#172;','&shy;':'&#173;','&reg;':'&#174;',\n    '&macr;':'&#175;','&deg;':'&#176;','&plusmn;':'&#177;',\n    '&sup2;':'&#178;','&sup3;':'&#179;','&acute;':'&#180;',\n    '&micro;':'&#181;','&para;':'&#182;','&middot;':'&#183;',\n    '&cedil;':'&#184;','&sup1;':'&#185;','&ordm;':'&#186;',\n    '&raquo;':'&#187;','&frac14;':'&#188;','&frac12;':'&#189;',\n    '&frac34;':'&#190;','&iquest;':'&#191;','&Agrave;':'&#192;',\n    '&Aacute;':'&#193;','&Acirc;':'&#194;','&Atilde;':'&#195;',\n    '&Auml;':'&#196;','&Aring;':'&#197;','&AElig;':'&#198;',\n    '&Ccedil;':'&#199;','&Egrave;':'&#200;','&Eacute;':'&#201;',\n    '&Ecirc;':'&#202;','&Euml;':'&#203;','&Igrave;':'&#204;',\n    '&Iacute;':'&#205;','&Icirc;':'&#206;','&Iuml;':'&#207;',\n    '&ETH;':'&#208;','&Ntilde;':'&#209;','&Ograve;':'&#210;',\n    '&Oacute;':'&#211;','&Ocirc;':'&#212;','&Otilde;':'&#213;',\n    '&Ouml;':'&#214;','&times;':'&#215;','&Oslash;':'&#216;',\n    '&Ugrave;':'&#217;','&Uacute;':'&#218;','&Ucirc;':'&#219;',\n    '&Uuml;':'&#220;','&Yacute;':'&#221;','&THORN;':'&#222;',\n    '&szlig;':'&#223;','&agrave;':'&#224;','&aacute;':'&#225;',\n    '&acirc;':'&#226;','&atilde;':'&#227;','&auml;':'&#228;',\n    '&aring;':'&#229;','&aelig;':'&#230;','&ccedil;':'&#231;',\n    '&egrave;':'&#232;','&eacute;':'&#233;','&ecirc;':'&#234;',\n    '&euml;':'&#235;','&igrave;':'&#236;','&iacute;':'&#237;',\n    '&icirc;':'&#238;','&iuml;':'&#239;','&eth;':'&#240;',\n    '&ntilde;':'&#241;','&ograve;':'&#242;','&oacute;':'&#243;',\n    '&ocirc;':'&#244;','&otilde;':'&#245;','&ouml;':'&#246;',\n    '&divide;':'&#247;','&oslash;':'&#248;','&ugrave;':'&#249;',\n    '&uacute;':'&#250;','&ucirc;':'&#251;','&uuml;':'&#252;',\n    '&yacute;':'&#253;','&thorn;':'&#254;','&yuml;':'&#255;',\n    '&OElig;':'&#338;','&oelig;':'&#339;','&Scaron;':'&#352;',\n    '&scaron;':'&#353;','&Yuml;':'&#376;','&fnof;':'&#402;',\n    '&circ;':'&#710;','&tilde;':'&#732;','&Alpha;':'&#913;',\n    '&Beta;':'&#914;','&Gamma;':'&#915;','&Delta;':'&#916;',\n    '&Epsilon;':'&#917;','&Zeta;':'&#918;','&Eta;':'&#919;',\n    '&Theta;':'&#920;','&Iota;':'&#921;','&Kappa;':'&#922;',\n    '&Lambda;':'&#923;','&Mu;':'&#924;','&Nu;':'&#925;',\n    '&Xi;':'&#926;','&Omicron;':'&#927;','&Pi;':'&#928;',\n    '&Rho;':'&#929;','&Sigma;':'&#931;','&Tau;':'&#932;',\n    '&Upsilon;':'&#933;','&Phi;':'&#934;','&Chi;':'&#935;',\n    '&Psi;':'&#936;','&Omega;':'&#937;','&alpha;':'&#945;',\n    '&beta;':'&#946;','&gamma;':'&#947;','&delta;':'&#948;',\n    '&epsilon;':'&#949;','&zeta;':'&#950;','&eta;':'&#951;',\n    '&theta;':'&#952;','&iota;':'&#953;','&kappa;':'&#954;',\n    '&lambda;':'&#955;','&mu;':'&#956;','&nu;':'&#957;',\n    '&xi;':'&#958;','&omicron;':'&#959;','&pi;':'&#960;',\n    '&rho;':'&#961;','&sigmaf;':'&#962;','&sigma;':'&#963;',\n    '&tau;':'&#964;','&upsilon;':'&#965;','&phi;':'&#966;',\n    '&chi;':'&#967;','&psi;':'&#968;','&omega;':'&#969;',\n    '&thetasym;':'&#977;','&upsih;':'&#978;','&piv;':'&#982;',\n    '&ensp;':'&#8194;','&emsp;':'&#8195;','&thinsp;':'&#8201;',\n    '&zwnj;':'&#8204;','&zwj;':'&#8205;','&lrm;':'&#8206;',\n    '&rlm;':'&#8207;','&ndash;':'&#8211;','&mdash;':'&#8212;',\n    '&lsquo;':'&#8216;','&rsquo;':'&#8217;','&sbquo;':'&#8218;',\n    '&ldquo;':'&#8220;','&rdquo;':'&#8221;','&bdquo;':'&#8222;',\n    '&dagger;':'&#8224;','&Dagger;':'&#8225;','&bull;':'&#8226;',\n    '&hellip;':'&#8230;','&permil;':'&#8240;','&prime;':'&#8242;',\n    '&Prime;':'&#8243;','&lsaquo;':'&#8249;','&rsaquo;':'&#8250;',\n    '&oline;':'&#8254;','&frasl;':'&#8260;','&euro;':'&#8364;',\n    '&image;':'&#8465;','&weierp;':'&#8472;','&real;':'&#8476;',\n    '&trade;':'&#8482;','&alefsym;':'&#8501;','&larr;':'&#8592;',\n    '&uarr;':'&#8593;','&rarr;':'&#8594;','&darr;':'&#8595;',\n    '&harr;':'&#8596;','&crarr;':'&#8629;','&lArr;':'&#8656;',\n    '&uArr;':'&#8657;','&rArr;':'&#8658;','&dArr;':'&#8659;',\n    '&hArr;':'&#8660;','&forall;':'&#8704;','&part;':'&#8706;',\n    '&exist;':'&#8707;','&empty;':'&#8709;','&nabla;':'&#8711;',\n    '&isin;':'&#8712;','&notin;':'&#8713;','&ni;':'&#8715;',\n    '&prod;':'&#8719;','&sum;':'&#8721;','&minus;':'&#8722;',\n    '&lowast;':'&#8727;','&radic;':'&#8730;','&prop;':'&#8733;',\n    '&infin;':'&#8734;','&ang;':'&#8736;','&and;':'&#8743;',\n    '&or;':'&#8744;','&cap;':'&#8745;','&cup;':'&#8746;',\n    '&int;':'&#8747;','&there4;':'&#8756;','&sim;':'&#8764;',\n    '&cong;':'&#8773;','&asymp;':'&#8776;','&ne;':'&#8800;',\n    '&equiv;':'&#8801;','&le;':'&#8804;','&ge;':'&#8805;',\n    '&sub;':'&#8834;','&sup;':'&#8835;','&nsub;':'&#8836;',\n    '&sube;':'&#8838;','&supe;':'&#8839;','&oplus;':'&#8853;',\n    '&otimes;':'&#8855;','&perp;':'&#8869;','&sdot;':'&#8901;',\n    '&lceil;':'&#8968;','&rceil;':'&#8969;','&lfloor;':'&#8970;',\n    '&rfloor;':'&#8971;','&lang;':'&#9001;','&rang;':'&#9002;',\n    '&loz;':'&#9674;','&spades;':'&#9824;','&clubs;':'&#9827;',\n    '&hearts;':'&#9829;','&diams;':'&#9830;'};\n\n    this.block_tags = [\"a\", \"abbr\", \"acronym\", \"address\", \"area\", \"b\",\n    \"base\", \"bdo\", \"big\", \"blockquote\", \"body\", \"button\",\n    \"caption\", \"cite\", \"code\", \"col\", \"colgroup\", \"dd\", \"del\", \"div\",\n    \"dfn\", \"dl\", \"dt\", \"em\", \"fieldset\", \"form\", \"head\", \"h1\", \"h2\",\n    \"h3\", \"h4\", \"h5\", \"h6\", \"html\", \"i\", \"ins\",\n    \"kbd\", \"label\", \"legend\", \"li\", \"map\", \"noscript\",\n    \"object\", \"ol\", \"optgroup\", \"option\", \"p\", \"param\", \"pre\", \"q\",\n    \"samp\", \"script\", \"select\", \"small\", \"span\", \"strong\", \"style\",\n    \"sub\", \"sup\", \"table\", \"tbody\", \"td\", \"textarea\", \"tfoot\", \"th\",\n    \"thead\", \"title\", \"tr\", \"tt\", \"ul\", \"var\", \"extends\"];\n\n\n    this.inline_tags = [\"br\", \"hr\", \"img\", \"input\"];\n\n    return this;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.shouldCloseTagAutomatically = function(tag, now_on_tag, closing)\n{\n  var closing = closing || false;\n  if(tag == 'td'){\n    if((closing && now_on_tag == 'tr') || (!closing && now_on_tag == 'td')){\n      return true;\n    }\n  }\n  if(tag == 'option'){\n    if((closing && now_on_tag == 'select') || (!closing && now_on_tag == 'option')){\n      return true;\n    }\n  }\n  return false;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.beforeParsing = function(raw)\n{\n  this.output = '';\n  return raw;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.afterParsing = function(xhtml)\n{\n  xhtml = this.replaceNamedEntities(xhtml);\n  xhtml = this.joinRepeatedEntities(xhtml);\n  xhtml = this.removeEmptyTags(xhtml);\n  xhtml = this.removeBrInPre(xhtml);\n  return xhtml;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.replaceNamedEntities = function(xhtml)\n{\n  for (var entity in this.entities) {\n    xhtml = xhtml.replace(new RegExp(entity, 'g'), this.entities[entity]);\n  }\n  return xhtml;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.joinRepeatedEntities = function(xhtml)\n{\n  var tags = 'em|strong|sub|sup|acronym|pre|del|address';\n  return xhtml.replace(new RegExp('<\\/('+tags+')><\\\\1>' ,''),'').\n  replace(new RegExp('(\\s*<('+tags+')>\\s*){2}(.*)(\\s*<\\/\\\\2>\\s*){2}' ,''),'<\\$2>\\$3<\\$2>');\n};\n\n// keep empty paragraphs\n// from: http://forum.wymeditor.org/forum/viewtopic.php?f=2&t=711#p2430\n//WYMeditor.XhtmlSaxListener.prototype.removeEmptyTags = function(xhtml)\n//{\n//  return xhtml.replace(new RegExp('<('+this.block_tags.join(\"|\").replace(/\\|td/,'')\n//\t.replace(/\\|th/, '')+')>(<br \\/>|&#160;|&nbsp;|\\\\s)*<\\/\\\\1>' ,'g'),'');\n//};\nWYMeditor.XhtmlSaxListener.prototype.removeEmptyTags = function(xhtml)\n{\n  return xhtml.replace(new RegExp('<('+this.block_tags.join(\"|\").replace(/\\|td/,'').replace(/\\|p/,'')\n\t.replace(/\\|th/, '')+')>(<br \\/>|&#160;|&nbsp;|\\\\s)*<\\/\\\\1>' ,'g'),'');\n};\n\nWYMeditor.XhtmlSaxListener.prototype.removeBrInPre = function(xhtml)\n{\n  var matches = xhtml.match(new RegExp('<pre[^>]*>(.*?)<\\/pre>','gmi'));\n  if(matches) {\n    for(var i=0; i<matches.length; i++) {\n      xhtml = xhtml.replace(matches[i], matches[i].replace(new RegExp('<br \\/>', 'g'), String.fromCharCode(13,10)));\n    }\n  }\n  return xhtml;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.getResult = function()\n{\n  return this.output;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.getTagReplacements = function()\n{\n  return {'b':'strong', 'i':'em'};\n};\n\nWYMeditor.XhtmlSaxListener.prototype.addContent = function(text)\n{\n  this.output += text;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.addComment = function(text)\n{\n  if(this.remove_comments){\n    this.output += text;\n  }\n};\n\nWYMeditor.XhtmlSaxListener.prototype.addScript = function(text)\n{\n  if(!this.remove_scripts){\n    this.output += text;\n  }\n};\n\nWYMeditor.XhtmlSaxListener.prototype.addCss = function(text)\n{\n  if(!this.remove_embeded_styles){\n    this.output += text;\n  }\n};\n\nWYMeditor.XhtmlSaxListener.prototype.openBlockTag = function(tag, attributes)\n{\n  this.output += this.helper.tag(tag, this.validator.getValidTagAttributes(tag, attributes), true);\n};\n\nWYMeditor.XhtmlSaxListener.prototype.inlineTag = function(tag, attributes)\n{\n  this.output += this.helper.tag(tag, this.validator.getValidTagAttributes(tag, attributes));\n};\n\nWYMeditor.XhtmlSaxListener.prototype.openUnknownTag = function(tag, attributes)\n{\n  //this.output += this.helper.tag(tag, attributes, true);\n};\n\nWYMeditor.XhtmlSaxListener.prototype.closeBlockTag = function(tag)\n{\n  this.output = this.output.replace(/<br \\/>$/, '')+this._getClosingTagContent('before', tag)+\"</\"+tag+\">\"+this._getClosingTagContent('after', tag);\n};\n\nWYMeditor.XhtmlSaxListener.prototype.closeUnknownTag = function(tag)\n{\n  //this.output += \"</\"+tag+\">\";\n};\n\nWYMeditor.XhtmlSaxListener.prototype.closeUnopenedTag = function(tag)\n{\n  this.output += \"</\"+tag+\">\";\n};\n\nWYMeditor.XhtmlSaxListener.prototype.avoidStylingTagsAndAttributes = function()\n{\n  this.avoided_tags = ['div','span'];\n  this.validator.skiped_attributes = ['style'];\n  this.validator.skiped_attribute_values = ['MsoNormal','main1']; // MS Word attributes for class\n  this._avoiding_tags_implicitly = true;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.allowStylingTagsAndAttributes = function()\n{\n  this.avoided_tags = [];\n  this.validator.skiped_attributes = [];\n  this.validator.skiped_attribute_values = [];\n  this._avoiding_tags_implicitly = false;\n};\n\nWYMeditor.XhtmlSaxListener.prototype.isBlockTag = function(tag)\n{\n  return !WYMeditor.Helper.contains(this.avoided_tags, tag) && WYMeditor.Helper.contains(this.block_tags, tag);\n};\n\nWYMeditor.XhtmlSaxListener.prototype.isInlineTag = function(tag)\n{\n  return !WYMeditor.Helper.contains(this.avoided_tags, tag) && WYMeditor.Helper.contains(this.inline_tags, tag);\n};\n\nWYMeditor.XhtmlSaxListener.prototype.insertContentAfterClosingTag = function(tag, content)\n{\n  this._insertContentWhenClosingTag('after', tag, content);\n};\n\nWYMeditor.XhtmlSaxListener.prototype.insertContentBeforeClosingTag = function(tag, content)\n{\n  this._insertContentWhenClosingTag('before', tag, content);\n};\n\nWYMeditor.XhtmlSaxListener.prototype.fixNestingBeforeOpeningBlockTag = function(tag, attributes)\n{\n    if(tag != 'li' && (tag == 'ul' || tag == 'ol') && this.last_tag && !this.last_tag_opened && this.last_tag == 'li'){\n      this.output = this.output.replace(/<\\/li>$/, '');\n      this.insertContentAfterClosingTag(tag, '</li>');\n    }\n};\n\nWYMeditor.XhtmlSaxListener.prototype._insertContentWhenClosingTag = function(position, tag, content)\n{\n  if(!this['_insert_'+position+'_closing']){\n    this['_insert_'+position+'_closing'] = [];\n  }\n  if(!this['_insert_'+position+'_closing'][tag]){\n    this['_insert_'+position+'_closing'][tag] = [];\n  }\n  this['_insert_'+position+'_closing'][tag].push(content);\n};\n\nWYMeditor.XhtmlSaxListener.prototype._getClosingTagContent = function(position, tag)\n{\n  if( this['_insert_'+position+'_closing'] &&\n      this['_insert_'+position+'_closing'][tag] &&\n      this['_insert_'+position+'_closing'][tag].length > 0){\n        return this['_insert_'+position+'_closing'][tag].pop();\n  }\n  return '';\n};\n\n\n/********** CSS PARSER **********/\n\n\nWYMeditor.WymCssLexer = function(parser, only_wym_blocks)\n{\n  var only_wym_blocks = (typeof only_wym_blocks == 'undefined' ? true : only_wym_blocks);\n\n  jQuery.extend(this, new WYMeditor.Lexer(parser, (only_wym_blocks?'Ignore':'WymCss')));\n\n  this.mapHandler('WymCss', 'Ignore');\n\n  if(only_wym_blocks == true){\n    this.addEntryPattern(\"/\\\\\\x2a[<\\\\s]*WYMeditor[>\\\\s]*\\\\\\x2a/\", 'Ignore', 'WymCss');\n    this.addExitPattern(\"/\\\\\\x2a[<\\/\\\\s]*WYMeditor[>\\\\s]*\\\\\\x2a/\", 'WymCss');\n  }\n\n  this.addSpecialPattern(\"[\\\\sa-z1-6]*\\\\\\x2e[a-z-_0-9]+\", 'WymCss', 'WymCssStyleDeclaration');\n\n  this.addEntryPattern(\"/\\\\\\x2a\", 'WymCss', 'WymCssComment');\n  this.addExitPattern(\"\\\\\\x2a/\", 'WymCssComment');\n\n  this.addEntryPattern(\"\\x7b\", 'WymCss', 'WymCssStyle');\n  this.addExitPattern(\"\\x7d\", 'WymCssStyle');\n\n  this.addEntryPattern(\"/\\\\\\x2a\", 'WymCssStyle', 'WymCssFeedbackStyle');\n  this.addExitPattern(\"\\\\\\x2a/\", 'WymCssFeedbackStyle');\n\n  return this;\n};\n\nWYMeditor.WymCssParser = function()\n{\n  this._in_style = false;\n  this._has_title = false;\n  this.only_wym_blocks = true;\n  this.css_settings = {'classesItems':[], 'editorStyles':[], 'dialogStyles':[]};\n  return this;\n};\n\nWYMeditor.WymCssParser.prototype.parse = function(raw, only_wym_blocks)\n{\n  var only_wym_blocks = (typeof only_wym_blocks == 'undefined' ? this.only_wym_blocks : only_wym_blocks);\n  this._Lexer = new WYMeditor.WymCssLexer(this, only_wym_blocks);\n  this._Lexer.parse(raw);\n};\n\nWYMeditor.WymCssParser.prototype.Ignore = function(match, state)\n{\n  return true;\n};\n\nWYMeditor.WymCssParser.prototype.WymCssComment = function(text, status)\n{\n  if(text.match(/end[a-z0-9\\s]*wym[a-z0-9\\s]*/mi)){\n    return false;\n  }\n  if(status == WYMeditor.LEXER_UNMATCHED){\n    if(!this._in_style){\n      this._has_title = true;\n      this._current_item = {'title':WYMeditor.Helper.trim(text)};\n    }else{\n      if(this._current_item[this._current_element]){\n        if(!this._current_item[this._current_element].expressions){\n          this._current_item[this._current_element].expressions = [text];\n        }else{\n          this._current_item[this._current_element].expressions.push(text);\n        }\n      }\n    }\n    this._in_style = true;\n  }\n  return true;\n};\n\nWYMeditor.WymCssParser.prototype.WymCssStyle = function(match, status)\n{\n  if(status == WYMeditor.LEXER_UNMATCHED){\n    match = WYMeditor.Helper.trim(match);\n    if(match != ''){\n      this._current_item[this._current_element].style = match;\n    }\n  }else if (status == WYMeditor.LEXER_EXIT){\n    this._in_style = false;\n    this._has_title = false;\n    this.addStyleSetting(this._current_item);\n  }\n  return true;\n};\n\nWYMeditor.WymCssParser.prototype.WymCssFeedbackStyle = function(match, status)\n{\n  if(status == WYMeditor.LEXER_UNMATCHED){\n    this._current_item[this._current_element].feedback_style = match.replace(/^([\\s\\/\\*]*)|([\\s\\/\\*]*)$/gm,'');\n  }\n  return true;\n};\n\nWYMeditor.WymCssParser.prototype.WymCssStyleDeclaration = function(match)\n{\n  match = match.replace(/^([\\s\\.]*)|([\\s\\.*]*)$/gm, '');\n\n  var tag = '';\n  if(match.indexOf('.') > 0){\n    var parts = match.split('.');\n    this._current_element = parts[1];\n    var tag = parts[0];\n  }else{\n    this._current_element = match;\n  }\n\n  if(!this._has_title){\n    this._current_item = {'title':(!tag?'':tag.toUpperCase()+': ')+this._current_element};\n    this._has_title = true;\n  }\n\n  if(!this._current_item[this._current_element]){\n    this._current_item[this._current_element] = {'name':this._current_element};\n  }\n  if(tag){\n    if(!this._current_item[this._current_element].tags){\n      this._current_item[this._current_element].tags = [tag];\n    }else{\n      this._current_item[this._current_element].tags.push(tag);\n    }\n  }\n  return true;\n};\n\nWYMeditor.WymCssParser.prototype.addStyleSetting = function(style_details)\n{\n  for (var name in style_details){\n    var details = style_details[name];\n    if(typeof details == 'object' && name != 'title'){\n\n      this.css_settings.classesItems.push({\n        'name': WYMeditor.Helper.trim(details.name),\n        'title': style_details.title,\n        'expr' : WYMeditor.Helper.trim((details.expressions||details.tags).join(', '))\n      });\n      if(details.feedback_style){\n        this.css_settings.editorStyles.push({\n          'name': '.'+ WYMeditor.Helper.trim(details.name),\n          'css': details.feedback_style\n        });\n      }\n      if(details.style){\n        this.css_settings.dialogStyles.push({\n          'name': '.'+ WYMeditor.Helper.trim(details.name),\n          'css': details.style\n        });\n      }\n    }\n  }\n};\n\n/********** HELPERS **********/\n\n// Returns true if it is a text node with whitespaces only\njQuery.fn.isPhantomNode = function() {\n  if (this[0].nodeType == 3)\n    return !(/[^\\t\\n\\r ]/.test(this[0].data));\n\n  return false;\n};\n\nWYMeditor.isPhantomNode = function(n) {\n  if (n.nodeType == 3)\n    return !(/[^\\t\\n\\r ]/.test(n.data));\n\n  return false;\n};\n\nWYMeditor.isPhantomString = function(str) {\n    return !(/[^\\t\\n\\r ]/.test(str));\n};\n\n// Returns the Parents or the node itself\n// jqexpr = a jQuery expression\njQuery.fn.parentsOrSelf = function(jqexpr) {\n  var n = this;\n\n  if (n[0].nodeType == 3)\n    n = n.parents().slice(0,1);\n\n//  if (n.is(jqexpr)) // XXX should work, but doesn't (probably a jQuery bug)\n  if (n.filter(jqexpr).size() == 1)\n    return n;\n  else\n    return n.parents(jqexpr).slice(0,1);\n};\n\n// String & array helpers\n\nWYMeditor.Helper = {\n\n    //replace all instances of 'old' by 'rep' in 'str' string\n    replaceAll: function(str, old, rep) {\n        var rExp = new RegExp(old, \"g\");\n        return(str.replace(rExp, rep));\n    },\n\n    //insert 'inserted' at position 'pos' in 'str' string\n    insertAt: function(str, inserted, pos) {\n        return(str.substr(0,pos) + inserted + str.substring(pos));\n    },\n\n    //trim 'str' string\n    trim: function(str) {\n        return str.replace(/^(\\s*)|(\\s*)$/gm,'');\n    },\n\n    //return true if 'arr' array contains 'elem', or false\n    contains: function(arr, elem) {\n        for (var i = 0; i < arr.length; i++) {\n            if (arr[i] === elem) return true;\n        }\n        return false;\n    },\n\n    //return 'item' position in 'arr' array, or -1\n    indexOf: function(arr, item) {\n        var ret=-1;\n        for(var i = 0; i < arr.length; i++) {\n            if (arr[i] == item) {\n                ret = i;\n                break;\n            }\n        }\n\t    return(ret);\n    },\n\n    //return 'item' object in 'arr' array, checking its 'name' property, or null\n    findByName: function(arr, name) {\n        for(var i = 0; i < arr.length; i++) {\n            var item = arr[i];\n            if(item.name == name) return(item);\n        }\n        return(null);\n    }\n};\n\n\n/*\n * WYMeditor : what you see is What You Mean web-based editor\n * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/\n * Dual licensed under the MIT (MIT-license.txt)\n * and GPL (GPL-license.txt) licenses.\n *\n * For further information visit:\n *        http://www.wymeditor.org/\n *\n * File Name:\n *        jquery.wymeditor.explorer.js\n *        MSIE specific class and functions.\n *        See the documentation for more info.\n *\n * File Authors:\n *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)\n *        Bermi Ferrer (wymeditor a-t bermi dotorg)\n *        Frédéric Palluel-Lafleur (fpalluel a-t gmail dotcom)\n *        Jonatan Lundin (jonatan.lundin _at_ gmail.com)\n */\n\nWYMeditor.WymClassExplorer = function(wym) {\n\n    this._wym = wym;\n    this._class = \"className\";\n    this._newLine = \"\\r\\n\";\n\n};\n\nWYMeditor.WymClassExplorer.prototype.initIframe = function(iframe) {\n\n    //This function is executed twice, though it is called once!\n    //But MSIE needs that, otherwise designMode won't work.\n    //Weird.\n    \n    this._iframe = iframe;\n    this._doc = iframe.contentWindow.document;\n    \n    //add css rules from options\n    var styles = this._doc.styleSheets[0];\n    var aCss = eval(this._options.editorStyles);\n\n    this.addCssRules(this._doc, aCss);\n\n    this._doc.title = this._wym._index;\n\n    //set the text direction\n    jQuery('html', this._doc).attr('dir', this._options.direction);\n    \n    //init html value\n    jQuery(this._doc.body).html(this._wym._html);\n    \n    //handle events\n    var wym = this;\n    \n    this._doc.body.onfocus = function()\n      {wym._doc.designMode = \"on\"; wym._doc = iframe.contentWindow.document;};\n    this._doc.onbeforedeactivate = function() {wym.saveCaret();};\n    this._doc.onkeyup = function() {\n      wym.saveCaret();\n      wym.keyup();\n    };\n    this._doc.onclick = function() {wym.saveCaret();};\n    \n    this._doc.body.onbeforepaste = function() {\n      wym._iframe.contentWindow.event.returnValue = false;\n    };\n    \n    this._doc.body.onpaste = function() {\n      wym._iframe.contentWindow.event.returnValue = false;\n      wym.paste(window.clipboardData.getData(\"Text\"));\n    };\n    \n    //callback can't be executed twice, so we check\n    if(this._initialized) {\n      \n      //pre-bind functions\n      if(jQuery.isFunction(this._options.preBind)) this._options.preBind(this);\n      \n      //bind external events\n      this._wym.bindEvents();\n      \n      //post-init functions\n      if(jQuery.isFunction(this._options.postInit)) this._options.postInit(this);\n      \n      //add event listeners to doc elements, e.g. images\n      this.listen();\n    }\n    \n    this._initialized = true;\n    \n    //init designMode\n    this._doc.designMode=\"on\";\n    try{\n        // (bermi's note) noticed when running unit tests on IE6\n        // Is this really needed, it trigger an unexisting property on IE6\n        this._doc = iframe.contentWindow.document; \n    }catch(e){}\n};\n\nWYMeditor.WymClassExplorer.prototype._exec = function(cmd,param) {\n\n    switch(cmd) {\n    \n    case WYMeditor.INDENT: case WYMeditor.OUTDENT:\n    \n        var container = this.findUp(this.container(), WYMeditor.LI);\n        if(container) {\n            var ancestor = container.parentNode.parentNode;\n            if(container.parentNode.childNodes.length>1\n              || ancestor.tagName.toLowerCase() == WYMeditor.OL\n              || ancestor.tagName.toLowerCase() == WYMeditor.UL)\n              this._doc.execCommand(cmd);\n        }\n    break;\n    default:\n        if(param) this._doc.execCommand(cmd,false,param);\n        else this._doc.execCommand(cmd);\n    break;\n\t}\n    \n    this.listen();\n};\n\nWYMeditor.WymClassExplorer.prototype.selected = function() {\n\n    var caretPos = this._iframe.contentWindow.document.caretPos;\n        if(caretPos!=null) {\n            if(caretPos.parentElement!=undefined)\n              return(caretPos.parentElement());\n        }\n};\n\nWYMeditor.WymClassExplorer.prototype.saveCaret = function() {\n\n    this._doc.caretPos = this._doc.selection.createRange();\n};\n\nWYMeditor.WymClassExplorer.prototype.addCssRule = function(styles, oCss) {\n\n    styles.addRule(oCss.name, oCss.css);\n};\n\nWYMeditor.WymClassExplorer.prototype.insert = function(html) {\n\n    // Get the current selection\n    var range = this._doc.selection.createRange();\n\n    // Check if the current selection is inside the editor\n    if ( jQuery(range.parentElement()).parents( this._options.iframeBodySelector ).is('*') ) {\n        try {\n            // Overwrite selection with provided html\n            range.pasteHTML(html);\n        } catch (e) { }\n    } else {\n        // Fall back to the internal paste function if there's no selection\n        this.paste(html);\n    }\n};\n\nWYMeditor.WymClassExplorer.prototype.wrap = function(left, right) {\n\n    // Get the current selection\n    var range = this._doc.selection.createRange();\n\n    // Check if the current selection is inside the editor\n    if ( jQuery(range.parentElement()).parents( this._options.iframeBodySelector ).is('*') ) {\n        try {\n            // Overwrite selection with provided html\n            range.pasteHTML(left + range.text + right);\n        } catch (e) { }\n    }\n};\n\nWYMeditor.WymClassExplorer.prototype.unwrap = function() {\n\n    // Get the current selection\n    var range = this._doc.selection.createRange();\n\n    // Check if the current selection is inside the editor\n    if ( jQuery(range.parentElement()).parents( this._options.iframeBodySelector ).is('*') ) {\n        try {\n            // Unwrap selection\n            var text = range.text;\n            this._exec( 'Cut' );\n            range.pasteHTML( text );\n        } catch (e) { }\n    }\n};\n\n//keyup handler\nWYMeditor.WymClassExplorer.prototype.keyup = function() {\n  this._selected_image = null;\n};\n\nWYMeditor.WymClassExplorer.prototype.setFocusToNode = function(node) {\n    var range = this._doc.selection.createRange();\n    range.moveToElementText(node);\n    range.collapse(false);\n    range.move('character',-1);\n    range.select();\n    node.focus();\n};\n\n/*\n * WYMeditor : what you see is What You Mean web-based editor\n * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/\n * Dual licensed under the MIT (MIT-license.txt)\n * and GPL (GPL-license.txt) licenses.\n *\n * For further information visit:\n *        http://www.wymeditor.org/\n *\n * File Name:\n *        jquery.wymeditor.mozilla.js\n *        Gecko specific class and functions.\n *        See the documentation for more info.\n *\n * File Authors:\n *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)\n *        Volker Mische (vmx a-t gmx dotde)\n *        Bermi Ferrer (wymeditor a-t bermi dotorg)\n *        Frédéric Palluel-Lafleur (fpalluel a-t gmail dotcom)\n */\n\nWYMeditor.WymClassMozilla = function(wym) {\n\n    this._wym = wym;\n    this._class = \"class\";\n    this._newLine = \"\\n\";\n};\n\nWYMeditor.WymClassMozilla.prototype.initIframe = function(iframe) {\n\n    this._iframe = iframe;\n    this._doc = iframe.contentDocument;\n    \n    //add css rules from options\n    \n    var styles = this._doc.styleSheets[0];    \n    var aCss = eval(this._options.editorStyles);\n    \n    this.addCssRules(this._doc, aCss);\n\n    this._doc.title = this._wym._index;\n\n    //set the text direction\n    jQuery('html', this._doc).attr('dir', this._options.direction);\n    \n    //init html value\n    this.html(this._wym._html);\n    \n    //init designMode\n    this.enableDesignMode();\n    \n    //pre-bind functions\n    if(jQuery.isFunction(this._options.preBind)) this._options.preBind(this);\n    \n    //bind external events\n    this._wym.bindEvents();\n    \n    //bind editor keydown events\n    jQuery(this._doc).bind(\"keydown\", this.keydown);\n    \n    //bind editor keyup events\n    jQuery(this._doc).bind(\"keyup\", this.keyup);\n    \n    //bind editor focus events (used to reset designmode - Gecko bug)\n    jQuery(this._doc).bind(\"focus\", this.enableDesignMode);\n    \n    //post-init functions\n    if(jQuery.isFunction(this._options.postInit)) this._options.postInit(this);\n    \n    //add event listeners to doc elements, e.g. images\n    this.listen();\n};\n\n/* @name html\n * @description Get/Set the html value\n */\nWYMeditor.WymClassMozilla.prototype.html = function(html) {\n\n  if(typeof html === 'string') {\n  \n    //disable designMode\n    try { this._doc.designMode = \"off\"; } catch(e) { };\n    \n    //replace em by i and strong by bold\n    //(designMode issue)\n    html = html.replace(/<em(\\b[^>]*)>/gi, \"<i$1>\")\n      .replace(/<\\/em>/gi, \"</i>\")\n      .replace(/<strong(\\b[^>]*)>/gi, \"<b$1>\")\n      .replace(/<\\/strong>/gi, \"</b>\");\n\n    //update the html body\n    jQuery(this._doc.body).html(html);\n    \n    //re-init designMode\n    this.enableDesignMode();\n  }\n  else return(jQuery(this._doc.body).html());\n};\n\nWYMeditor.WymClassMozilla.prototype._exec = function(cmd,param) {\n\n    if(!this.selected()) return(false);\n\n    switch(cmd) {\n    \n    case WYMeditor.INDENT: case WYMeditor.OUTDENT:\n    \n        var focusNode = this.selected();    \n        var sel = this._iframe.contentWindow.getSelection();\n        var anchorNode = sel.anchorNode;\n        if(anchorNode.nodeName == \"#text\") anchorNode = anchorNode.parentNode;\n        \n        focusNode = this.findUp(focusNode, WYMeditor.BLOCKS);\n        anchorNode = this.findUp(anchorNode, WYMeditor.BLOCKS);\n        \n        if(focusNode && focusNode == anchorNode\n          && focusNode.tagName.toLowerCase() == WYMeditor.LI) {\n\n            var ancestor = focusNode.parentNode.parentNode;\n\n            if(focusNode.parentNode.childNodes.length>1\n              || ancestor.tagName.toLowerCase() == WYMeditor.OL\n              || ancestor.tagName.toLowerCase() == WYMeditor.UL)\n                this._doc.execCommand(cmd,'',null);\n        }\n\n    break;\n    \n    default:\n\n        if(param) this._doc.execCommand(cmd,'',param);\n        else this._doc.execCommand(cmd,'',null);\n    }\n    \n    //set to P if parent = BODY\n    var container = this.selected();\n    if(container.tagName.toLowerCase() == WYMeditor.BODY)\n        this._exec(WYMeditor.FORMAT_BLOCK, WYMeditor.P);\n    \n    //add event handlers on doc elements\n\n    this.listen();\n};\n\n/* @name selected\n * @description Returns the selected container\n */\nWYMeditor.WymClassMozilla.prototype.selected = function() {\n\n    var sel = this._iframe.contentWindow.getSelection();\n    var node = sel.focusNode;\n    if(node) {\n        if(node.nodeName == \"#text\") return(node.parentNode);\n        else return(node);\n    } else return(null);\n};\n\nWYMeditor.WymClassMozilla.prototype.addCssRule = function(styles, oCss) {\n\n    styles.insertRule(oCss.name + \" {\" + oCss.css + \"}\",\n        styles.cssRules.length);\n};\n\n\n//keydown handler, mainly used for keyboard shortcuts\nWYMeditor.WymClassMozilla.prototype.keydown = function(evt) {\n  \n  //'this' is the doc\n  var wym = WYMeditor.INSTANCES[this.title];\n  var container = null;  \n\n  if( evt.keyCode === WYMeditor.KEY.ENTER ){\n\tcontainer = wym.selected();\n\tif( container ){\n\t\tvar $container = $( container ),\n\t\t\t$parent = $container.parent(),\n\t\t\t$embedded = $container.parents( '.embedded-item' );\n\t\tif( $embedded.size() ){\n\t\t\t// if the cursor is in the title, add a para before\n\t\t\tvar $newNode = $( '<p/>' );\n\t\t\tif( $container.hasClass( 'title' ) ){\n\t\t\t\t$embedded.before( $newNode );\n\t\t\t// if the cursor is in the content, add after\n\t\t\t} else if( $container.hasClass( 'content' ) ){\n\t\t\t\t$embedded.after( $newNode );\n\t\t\t}\n\t\t\twym.setFocusToNode( $newNode.get(0) );\n\t\t\t// prevent the default - wym's chop the text and split it up into paras\n\t\t\treturn false;\n\t\t}\n\t}\n  }\n\n  if(evt.ctrlKey){\n    if(evt.keyCode == 66){\n      //CTRL+b => STRONG\n      wym._exec(WYMeditor.BOLD);\n      return false;\n    }\n    if(evt.keyCode == 73){\n      //CTRL+i => EMPHASIS\n      wym._exec(WYMeditor.ITALIC);\n      return false;\n    }\n  }\n\n  else if(evt.keyCode == 13) {\n    if(!evt.shiftKey){\n      //fix PRE bug #73\n      container = wym.selected();\n      if(container && container.tagName.toLowerCase() == WYMeditor.PRE) {\n        evt.preventDefault();\n        wym.insert('<p></p>');\n      }\n    }\n  }\n};\n\n//keyup handler, mainly used for cleanups\nWYMeditor.WymClassMozilla.prototype.keyup = function(evt) {\n\n  //'this' is the doc\n  var wym = WYMeditor.INSTANCES[this.title];\n\n  wym._selected_image = null;\n  var container = null;\n\n  if(evt.keyCode == 13 && !evt.shiftKey) {\n\n    //RETURN key\n    //cleanup <br><br> between paragraphs\n    jQuery(wym._doc.body).children(WYMeditor.BR).remove();\n  }\n\n  else if(evt.keyCode != 8\n       && evt.keyCode != 17\n       && evt.keyCode != 46\n       && evt.keyCode != 224\n       && !evt.metaKey\n       && !evt.ctrlKey) {\n\n    //NOT BACKSPACE, NOT DELETE, NOT CTRL, NOT COMMAND\n    //text nodes replaced by P\n\n    container = wym.selected();\n    var name = container.tagName.toLowerCase();\n\n    //fix forbidden main containers\n    if(\n      name == \"strong\" ||\n      name == \"b\" ||\n      name == \"em\" ||\n      name == \"i\" ||\n      name == \"sub\" ||\n      name == \"sup\" ||\n      name == \"a\"\n\n    ) name = container.parentNode.tagName.toLowerCase();\n\n    if(name == WYMeditor.BODY) wym._exec(WYMeditor.FORMAT_BLOCK, WYMeditor.P);\n  }\n};\n\nWYMeditor.WymClassMozilla.prototype.enableDesignMode = function() {\n    if(this.designMode == \"off\") {\n      try {\n        this.designMode = \"on\";\n        this.execCommand(\"styleWithCSS\", '', false);\n      } catch(e) { }\n    }\n};\n\nWYMeditor.WymClassMozilla.prototype.setFocusToNode = function(node) {\n    var range = document.createRange();\n    range.selectNode(node);\n    var selected = this._iframe.contentWindow.getSelection();\n    selected.addRange(range);\n    selected.collapse(node, node.childNodes.length);\n    this._iframe.contentWindow.focus();\n};\n\nWYMeditor.WymClassMozilla.prototype.openBlockTag = function(tag, attributes)\n{\n  var attributes = this.validator.getValidTagAttributes(tag, attributes);\n\n  // Handle Mozilla styled spans\n  if(tag == 'span' && attributes.style){\n    var new_tag = this.getTagForStyle(attributes.style);\n    if(new_tag){\n      this._tag_stack.pop();\n      var tag = new_tag;\n      this._tag_stack.push(new_tag);\n      attributes.style = '';\n    }else{\n      return;\n    }\n  }\n\n  this.output += this.helper.tag(tag, attributes, true);\n};\n\nWYMeditor.WymClassMozilla.prototype.getTagForStyle = function(style) {\n\n  if(/bold/.test(style)) return 'strong';\n  if(/italic/.test(style)) return 'em';\n  if(/sub/.test(style)) return 'sub';\n  if(/sub/.test(style)) return 'super';\n  return false;\n};\n\n/*\n * WYMeditor : what you see is What You Mean web-based editor\n * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/\n * Dual licensed under the MIT (MIT-license.txt)\n * and GPL (GPL-license.txt) licenses.\n *\n * For further information visit:\n *        http://www.wymeditor.org/\n *\n * File Name:\n *        jquery.wymeditor.opera.js\n *        Opera specific class and functions.\n *        See the documentation for more info.\n *\n * File Authors:\n *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)\n */\n\nWYMeditor.WymClassOpera = function(wym) {\n\n    this._wym = wym;\n    this._class = \"class\";\n    this._newLine = \"\\r\\n\";\n};\n\nWYMeditor.WymClassOpera.prototype.initIframe = function(iframe) {\n\n    this._iframe = iframe;\n    this._doc = iframe.contentWindow.document;\n\n    //add css rules from options\n    var styles = this._doc.styleSheets[0];\n    var aCss = eval(this._options.editorStyles);\n\n    this.addCssRules(this._doc, aCss);\n\n    this._doc.title = this._wym._index;\n\n    //set the text direction\n    jQuery('html', this._doc).attr('dir', this._options.direction);\n\n    //init designMode\n    this._doc.designMode = \"on\";\n\n    //init html value\n    this.html(this._wym._html);\n\n    //pre-bind functions\n    if(jQuery.isFunction(this._options.preBind)) this._options.preBind(this);\n\n    //bind external events\n    this._wym.bindEvents();\n\n    //bind editor keydown events\n    jQuery(this._doc).bind(\"keydown\", this.keydown);\n\n    //bind editor events\n    jQuery(this._doc).bind(\"keyup\", this.keyup);\n\n    //post-init functions\n    if(jQuery.isFunction(this._options.postInit)) this._options.postInit(this);\n\n    //add event listeners to doc elements, e.g. images\n    this.listen();\n};\n\nWYMeditor.WymClassOpera.prototype._exec = function(cmd,param) {\n\n    if(param) this._doc.execCommand(cmd,false,param);\n    else this._doc.execCommand(cmd);\n\n    this.listen();\n};\n\nWYMeditor.WymClassOpera.prototype.selected = function() {\n\n    var sel=this._iframe.contentWindow.getSelection();\n    var node=sel.focusNode;\n    if(node) {\n        if(node.nodeName==\"#text\")return(node.parentNode);\n        else return(node);\n    } else return(null);\n};\n\nWYMeditor.WymClassOpera.prototype.addCssRule = function(styles, oCss) {\n\n    styles.insertRule(oCss.name + \" {\" + oCss.css + \"}\",\n        styles.cssRules.length);\n};\n\n//keydown handler\nWYMeditor.WymClassOpera.prototype.keydown = function(evt) {\n\n  //'this' is the doc\n  var wym = WYMeditor.INSTANCES[this.title];\n  var sel = wym._iframe.contentWindow.getSelection();\n  startNode = sel.getRangeAt(0).startContainer;\n\n  //Get a P instead of no container\n  if(!jQuery(startNode).parentsOrSelf(\n                WYMeditor.MAIN_CONTAINERS.join(\",\"))[0]\n      && !jQuery(startNode).parentsOrSelf('li')\n      && evt.keyCode != WYMeditor.KEY.ENTER\n      && evt.keyCode != WYMeditor.KEY.LEFT\n      && evt.keyCode != WYMeditor.KEY.UP\n      && evt.keyCode != WYMeditor.KEY.RIGHT\n      && evt.keyCode != WYMeditor.KEY.DOWN\n      && evt.keyCode != WYMeditor.KEY.BACKSPACE\n      && evt.keyCode != WYMeditor.KEY.DELETE)\n      wym._exec(WYMeditor.FORMAT_BLOCK, WYMeditor.P);\n\n};\n\n//keyup handler\nWYMeditor.WymClassOpera.prototype.keyup = function(evt) {\n\n  //'this' is the doc\n  var wym = WYMeditor.INSTANCES[this.title];\n  wym._selected_image = null;\n};\n\n// TODO: implement me\nWYMeditor.WymClassOpera.prototype.setFocusToNode = function(node) {\n\n};\n\n/*\n * WYMeditor : what you see is What You Mean web-based editor\n * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/\n * Dual licensed under the MIT (MIT-license.txt)\n * and GPL (GPL-license.txt) licenses.\n *\n * For further information visit:\n *        http://www.wymeditor.org/\n *\n * File Name:\n *        jquery.wymeditor.safari.js\n *        Safari specific class and functions.\n *        See the documentation for more info.\n *\n * File Authors:\n *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)\n *        Scott Lewis (lewiscot a-t gmail dotcom)\n */\n\nWYMeditor.WymClassSafari = function(wym) {\n\n    this._wym = wym;\n    this._class = \"class\";\n    this._newLine = \"\\n\";\n};\n\nWYMeditor.WymClassSafari.prototype.initIframe = function(iframe) {\n\n    this._iframe = iframe;\n    this._doc = iframe.contentDocument;\n\n    //add css rules from options\n\n    var styles = this._doc.styleSheets[0];\n    var aCss = eval(this._options.editorStyles);\n\n    this.addCssRules(this._doc, aCss);\n\n    this._doc.title = this._wym._index;\n\n    //set the text direction\n    jQuery('html', this._doc).attr('dir', this._options.direction);\n\n    //init designMode\n    this._doc.designMode = \"on\";\n\n    //init html value\n    this.html(this._wym._html);\n\n    //pre-bind functions\n    if(jQuery.isFunction(this._options.preBind)) this._options.preBind(this);\n\n    //bind external events\n    this._wym.bindEvents();\n\n    //bind editor keydown events\n    jQuery(this._doc).bind(\"keydown\", this.keydown);\n\n    //bind editor keyup events\n    jQuery(this._doc).bind(\"keyup\", this.keyup);\n\n    //post-init functions\n    if(jQuery.isFunction(this._options.postInit)) this._options.postInit(this);\n\n    //add event listeners to doc elements, e.g. images\n    this.listen();\n};\n\nWYMeditor.WymClassSafari.prototype._exec = function(cmd,param) {\n\n    if(!this.selected()) return(false);\n\n    switch(cmd) {\n\n    case WYMeditor.INDENT: case WYMeditor.OUTDENT:\n\n        var focusNode = this.selected();\n        var sel = this._iframe.contentWindow.getSelection();\n        var anchorNode = sel.anchorNode;\n        if(anchorNode.nodeName == \"#text\") anchorNode = anchorNode.parentNode;\n\n        focusNode = this.findUp(focusNode, WYMeditor.BLOCKS);\n        anchorNode = this.findUp(anchorNode, WYMeditor.BLOCKS);\n\n        if(focusNode && focusNode == anchorNode\n          && focusNode.tagName.toLowerCase() == WYMeditor.LI) {\n\n            var ancestor = focusNode.parentNode.parentNode;\n\n            if(focusNode.parentNode.childNodes.length>1\n              || ancestor.tagName.toLowerCase() == WYMeditor.OL\n              || ancestor.tagName.toLowerCase() == WYMeditor.UL)\n                this._doc.execCommand(cmd,'',null);\n        }\n\n    break;\n\n    case WYMeditor.INSERT_ORDEREDLIST: case WYMeditor.INSERT_UNORDEREDLIST:\n\n        this._doc.execCommand(cmd,'',null);\n\n        //Safari creates lists in e.g. paragraphs.\n        //Find the container, and remove it.\n        var focusNode = this.selected();\n        var container = this.findUp(focusNode, WYMeditor.MAIN_CONTAINERS);\n        if(container) jQuery(container).replaceWith(jQuery(container).html());\n\n    break;\n\n    default:\n\n        if(param) this._doc.execCommand(cmd,'',param);\n        else this._doc.execCommand(cmd,'',null);\n    }\n\n    //set to P if parent = BODY\n    var container = this.selected();\n    if(container && container.tagName.toLowerCase() == WYMeditor.BODY)\n        this._exec(WYMeditor.FORMAT_BLOCK, WYMeditor.P);\n\n    //add event handlers on doc elements\n    this.listen();\n};\n\n/* @name selected\n * @description Returns the selected container\n */\nWYMeditor.WymClassSafari.prototype.selected = function() {\n\n    var sel = this._iframe.contentWindow.getSelection();\n    var node = sel.focusNode;\n    if(node) {\n        if(node.nodeName == \"#text\") return(node.parentNode);\n        else return(node);\n    } else return(null);\n};\n\nWYMeditor.WymClassSafari.prototype.addCssRule = function(styles, oCss) {\n\n    styles.insertRule(oCss.name + \" {\" + oCss.css + \"}\",\n        styles.cssRules.length);\n};\n\n\n//keydown handler, mainly used for keyboard shortcuts\nWYMeditor.WymClassSafari.prototype.keydown = function(evt) {\n\n  //'this' is the doc\n  var wym = WYMeditor.INSTANCES[this.title];\n\n  if( evt.keyCode === WYMeditor.KEY.ENTER ){\n\tvar container = wym.selected();\n\tif( container ){\n\t\tvar $container = $( container ),\n\t\t\t$parent = $container.parent(),\n\t\t\t$embedded = $container.parents( '.embedded-item' );\n\t\tif( $embedded.size() ){\n\t\t\t// if the cursor is in the title, add a para before\n\t\t\tvar $newNode = $( '<p/>' );\n\t\t\tif( $container.hasClass( 'title' ) ){\n\t\t\t\t$embedded.before( $newNode );\n\t\t\t// if the cursor is in the content, add after\n\t\t\t} else if( $container.hasClass( 'content' ) ){\n\t\t\t\t$embedded.after( $newNode );\n\t\t\t}\n\t\t\twym.setFocusToNode( $newNode.get(0) );\n\t\t\t// prevent the default - wym's chop the text and split it up into paras\n\t\t\treturn false;\n\t\t}\n\t}\n  }\n  \n  if(evt.ctrlKey){\n    if(evt.keyCode == 66){\n      //CTRL+b => STRONG\n      wym._exec(WYMeditor.BOLD);\n      return false;\n    }\n    if(evt.keyCode == 73){\n      //CTRL+i => EMPHASIS\n      wym._exec(WYMeditor.ITALIC);\n      return false;\n    }\n  }\n};\n\n//keyup handler, mainly used for cleanups\nWYMeditor.WymClassSafari.prototype.keyup = function(evt) {\n\n  //'this' is the doc\n  var wym = WYMeditor.INSTANCES[this.title];\n  \n  wym._selected_image = null;\n  var container = null;\n\n  if(evt.keyCode == 13 && !evt.shiftKey) {\n  \n    //RETURN key\n    //cleanup <br><br> between paragraphs\n    jQuery(wym._doc.body).children(WYMeditor.BR).remove();\n    \n    //fix PRE bug #73\n    container = wym.selected();\n    if(container && container.tagName.toLowerCase() == WYMeditor.PRE)\n        wym._exec(WYMeditor.FORMAT_BLOCK, WYMeditor.P); //create P after PRE\n  }\n\n  //fix #112\n  if(evt.keyCode == 13 && evt.shiftKey) {\n    wym._exec('InsertLineBreak');\n  }\n  \n  if(evt.keyCode != 8\n       && evt.keyCode != 17\n       && evt.keyCode != 46\n       && evt.keyCode != 224\n       && !evt.metaKey\n       && !evt.ctrlKey) {\n      \n    //NOT BACKSPACE, NOT DELETE, NOT CTRL, NOT COMMAND\n    //text nodes replaced by P\n    \n    container = wym.selected();\n    var name = container.tagName.toLowerCase();\n\n    //fix forbidden main containers\n    if(\n      name == \"strong\" ||\n      name == \"b\" ||\n      name == \"em\" ||\n      name == \"i\" ||\n      name == \"sub\" ||\n      name == \"sup\" ||\n      name == \"a\" ||\n      name == \"span\" //fix #110\n\n    ) name = container.parentNode.tagName.toLowerCase();\n\n    if(name == WYMeditor.BODY || name == WYMeditor.DIV) wym._exec(WYMeditor.FORMAT_BLOCK, WYMeditor.P); //fix #110 for DIV\n  }\n};\n\nWYMeditor.WymClassSafari.prototype.setFocusToNode = function(node) {\n    var range = this._iframe.contentDocument.createRange();\n    range.selectNode(node);\n    var selected = this._iframe.contentWindow.getSelection();\n    selected.addRange(range);\n    selected.collapse(node, node.childNodes.length);\n    this._iframe.contentWindow.focus();\n};\n\nWYMeditor.WymClassSafari.prototype.openBlockTag = function(tag, attributes)\n{\n  var attributes = this.validator.getValidTagAttributes(tag, attributes);\n\n  // Handle Safari styled spans\n  if(tag == 'span' && attributes.style) {\n    var new_tag = this.getTagForStyle(attributes.style);\n    if(new_tag){\n      this._tag_stack.pop();\n      var tag = new_tag;\n      this._tag_stack.push(new_tag);\n      attributes.style = '';\n      \n      //should fix #125 - also removed the xhtml() override\n      if(typeof attributes['class'] == 'string')\n        attributes['class'] = attributes['class'].replace(/apple-style-span/gi, '');\n    \n    } else {\n      return;\n    }\n  }\n  \n  this.output += this.helper.tag(tag, attributes, true);\n};\n\nWYMeditor.WymClassSafari.prototype.getTagForStyle = function(style) {\n\n  if(/bold/.test(style)) return 'strong';\n  if(/italic/.test(style)) return 'em';\n  if(/sub/.test(style)) return 'sub';\n  if(/super/.test(style)) return 'sup';\n  return false;\n};\n"]}