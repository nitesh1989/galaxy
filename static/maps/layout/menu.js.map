{"version":3,"sources":["layout/menu.js"],"names":["Collection","Backbone","extend","model","Model","defaults","visible","target","fetch","options","this","reset","extendedNavItem","_genericNavView2","default","GenericNavView","add","render","id","title","_localization2","tooltip","self","disabled","Galaxy","user","url","menu","callback","webhooks","$","document","ready","each","models","index","webhook","toJSON","activate","name","icon","config","function","Function","obj","onclick","_utils2","appendScriptStyle","get","cls","helpTab","support_url","mailing_lists","screencasts_url","wiki_url","citation_url","push","biostar_url","unshift","biostar_url_redirect","userTab","session_csrf_token","activeView","setElement","noscratchbook","listenTo","active_view","events","set","jQuery","Deferred","resolve","promise","Tab","attr","visibility","_template","$dropdown","$toggle","$menu","$note","html","display","click .dropdown-toggle","remove","$el","css","hide","_formatUrl","_","menuItem","divider","addClass","removeClass","_buildMenuItem","placement","e","preventDefault","off","on","empty","trigger","m","append","popover","content","setTimeout","frame","buildLink","label","root","attributes","indexOf","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\nimport GenericNav from \"layout/generic-nav-view\";\nimport Webhooks from \"mvc/webhooks\";\nimport _l from \"utils/localization\";\nimport Utils from \"utils/utils\";\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible: true,\n            target: \"_parent\"\n        }\n    }),\n    fetch: function(options) {\n        var self = this;\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new GenericNav.GenericNavView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id: \"analysis\",\n            title: _l(\"Analyze Data\"),\n            url: \"\",\n            tooltip: _l(\"Analysis home view\")\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id: \"workflow\",\n            title: _l(\"Workflow\"),\n            tooltip: _l(\"Chain tools into workflows\"),\n            disabled: !Galaxy.user.id,\n            url: \"workflow\"\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id: \"shared\",\n            title: _l(\"Shared Data\"),\n            url: \"library/index\",\n            tooltip: _l(\"Access published resources\"),\n            menu: [\n                {\n                    title: _l(\"Data Libraries\"),\n                    url: \"library/list\"\n                },\n                {\n                    title: _l(\"Histories\"),\n                    url: \"histories/list_published\"\n                },\n                {\n                    title: _l(\"Workflows\"),\n                    url: \"workflows/list_published\"\n                },\n                {\n                    title: _l(\"Visualizations\"),\n                    url: \"visualizations/list_published\"\n                },\n                {\n                    title: _l(\"Pages\"),\n                    url: \"pages/list_published\"\n                }\n            ]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id: \"visualization\",\n            title: _l(\"Visualization\"),\n            url: \"visualizations/list\",\n            tooltip: _l(\"Visualize datasets\"),\n            disabled: !Galaxy.user.id,\n            menu: [\n                {\n                    title: _l(\"New Track Browser\"),\n                    url: \"visualization/trackster\",\n                    target: \"_frame\"\n                },\n                {\n                    title: _l(\"Saved Visualizations\"),\n                    url: \"visualizations/list\",\n                    target: \"_frame\"\n                },\n                {\n                    title: _l(\"Interactive Environments\"),\n                    url: \"visualization/gie_list\",\n                    target: \"galaxy_main\"\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.add({\n            url: \"api/webhooks/masthead/all\",\n            callback: function(webhooks) {\n                $(document).ready(() => {\n                    $.each(webhooks.models, (index, model) => {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            var obj = {\n                                id: webhook.name,\n                                icon: webhook.config.icon,\n                                url: webhook.config.url,\n                                tooltip: webhook.config.tooltip,\n                                onclick: webhook.config.function && new Function(webhook.config.function)\n                            };\n\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if (Galaxy.page) {\n                                Galaxy.page.masthead.collection.add(obj);\n                            } else if (Galaxy.masthead) {\n                                Galaxy.masthead.collection.add(obj);\n                            }\n\n                            // Append masthead script and styles to Galaxy main\n                            Utils.appendScriptStyle(webhook);\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get(\"is_admin\") &&\n            this.add({\n                id: \"admin\",\n                title: _l(\"Admin\"),\n                url: \"admin\",\n                tooltip: _l(\"Administer this Galaxy\"),\n                cls: \"admin-only\"\n            });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id: \"help\",\n            title: _l(\"Help\"),\n            tooltip: _l(\"Support, contact, and community\"),\n            menu: [\n                {\n                    title: _l(\"Support\"),\n                    url: options.support_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Search\"),\n                    url: options.search_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Mailing Lists\"),\n                    url: options.mailing_lists,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Videos\"),\n                    url: options.screencasts_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Wiki\"),\n                    url: options.wiki_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"How to Cite Galaxy\"),\n                    url: options.citation_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Interactive Tours\"),\n                    url: \"tours\"\n                }\n            ]\n        };\n        options.terms_url &&\n            helpTab.menu.push({\n                title: _l(\"Terms and Conditions\"),\n                url: options.terms_url,\n                target: \"_blank\"\n            });\n        options.biostar_url &&\n            helpTab.menu.unshift({\n                title: _l(\"Ask a question\"),\n                url: \"biostar/biostar_question_redirect\",\n                target: \"_blank\"\n            });\n        options.biostar_url &&\n            helpTab.menu.unshift({\n                title: _l(\"Galaxy Biostar\"),\n                url: options.biostar_url_redirect,\n                target: \"_blank\"\n            });\n        this.add(helpTab);\n\n        //\n        // User tab.\n        //\n        var userTab = {};\n        if (!Galaxy.user.id) {\n            if (options.allow_user_creation) {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login or Register\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Account registration or login\"),\n                    menu: [\n                        {\n                            title: _l(\"Login\"),\n                            url: \"user/login\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        },\n                        {\n                            title: _l(\"Register\"),\n                            url: \"user/create\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        }\n                    ]\n                };\n            } else {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Login\"),\n                    url: \"user/login\",\n                    target: \"galaxy_main\",\n                    noscratchbook: true\n                };\n            }\n        } else {\n            userTab = {\n                id: \"user\",\n                title: _l(\"User\"),\n                cls: \"loggedin-only\",\n                tooltip: _l(\"Account and saved data\"),\n                menu: [\n                    {\n                        title: `${_l(\"Logged in as\")} ${Galaxy.user.get(\"email\")}`\n                    },\n                    {\n                        title: _l(\"Preferences\"),\n                        url: \"user\"\n                    },\n                    {\n                        title: _l(\"Custom Builds\"),\n                        url: \"custom_builds\"\n                    },\n                    {\n                        title: _l(\"Logout\"),\n                        url: `user/logout?session_csrf_token=${Galaxy.session_csrf_token}`,\n                        target: \"_top\",\n                        divider: true\n                    },\n                    {\n                        title: _l(\"Saved Histories\"),\n                        url: \"histories/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Datasets\"),\n                        url: \"datasets/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Pages\"),\n                        url: \"pages/list\",\n                        target: \"_top\"\n                    }\n                ]\n            };\n        }\n        this.add(userTab);\n        var activeView = this.get(options.active_view);\n        activeView && activeView.set(\"active\", true);\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$dropdown = this.$(\".dropdown\");\n        this.$toggle = this.$(\".dropdown-toggle\");\n        this.$menu = this.$(\".dropdown-menu\");\n        this.$note = this.$(\".dropdown-note\");\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    events: {\n        \"click .dropdown-toggle\": \"_toggleClick\"\n    },\n\n    render: function() {\n        var self = this;\n        $(\".tooltip\").remove();\n        this.$el.attr(\"id\", this.model.id).css({\n            visibility: (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n        });\n        this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n        this.$note\n            .html(this.model.get(\"note\") || \"\")\n            .removeClass()\n            .addClass(\"dropdown-note\")\n            .addClass(this.model.get(\"note_cls\"))\n            .css({\n                display: (this.model.get(\"show_note\") && \"block\") || \"none\"\n            });\n        this.$toggle\n            .html(this.model.get(\"title\") || \"\")\n            .removeClass()\n            .addClass(\"dropdown-toggle\")\n            .addClass(this.model.get(\"cls\"))\n            .addClass(this.model.get(\"icon\") && `dropdown-icon fa ${this.model.get(\"icon\")}`)\n            .addClass(this.model.get(\"toggle\") && \"toggle\")\n            .attr(\"target\", this.model.get(\"target\"))\n            .attr(\"href\", this.model.get(\"url\"))\n            .attr(\"title\", this.model.get(\"tooltip\"))\n            .tooltip(\"destroy\");\n        this.model.get(\"tooltip\") && this.$toggle.tooltip({ placement: \"bottom\" });\n        this.$dropdown\n            .removeClass()\n            .addClass(\"dropdown\")\n            .addClass(this.model.get(\"disabled\") && \"disabled\")\n            .addClass(this.model.get(\"active\") && \"active\");\n        if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n            this.$menu.show();\n            $(\"#dd-helper\")\n                .show()\n                .off()\n                .on(\"click\", () => {\n                    $(\"#dd-helper\").hide();\n                    self.model.set(\"show_menu\", false);\n                });\n        } else {\n            self.$menu.hide();\n            $(\"#dd-helper\").hide();\n        }\n        this.$menu.empty().removeClass(\"dropdown-menu\");\n        if (this.model.get(\"menu\")) {\n            _.each(this.model.get(\"menu\"), menuItem => {\n                self.$menu.append(self._buildMenuItem(menuItem));\n                menuItem.divider && self.$menu.append($(\"<li/>\").addClass(\"divider\"));\n            });\n            self.$menu.addClass(\"dropdown-menu\");\n            self.$toggle.append($(\"<b/>\").addClass(\"caret\"));\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function(options) {\n        var self = this;\n        options = _.defaults(options || {}, {\n            title: \"\",\n            url: \"\",\n            target: \"_parent\",\n            noscratchbook: false\n        });\n        options.url = self._formatUrl(options.url);\n        return $(\"<li/>\").append(\n            $(\"<a/>\")\n                .attr(\"href\", options.url)\n                .attr(\"target\", options.target)\n                .html(options.title)\n                .on(\"click\", e => {\n                    e.preventDefault();\n                    self.model.set(\"show_menu\", false);\n                    if (options.onclick) {\n                        options.onclick();\n                    } else {\n                        Galaxy.frame.add(options);\n                    }\n                })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function(e) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $(\".tooltip\").hide();\n        model.trigger(\"dispatch\", m => {\n            model.id !== m.id && m.get(\"menu\") && m.set(\"show_menu\", false);\n        });\n        if (!model.get(\"disabled\")) {\n            if (!model.get(\"menu\")) {\n                model.get(\"onclick\") ? model.get(\"onclick\")() : Galaxy.frame.add(model.attributes);\n            } else {\n                model.set(\"show_menu\", true);\n            }\n        } else {\n            function buildLink(label, url) {\n                return $(\"<div/>\")\n                    .append(\n                        $(\"<a/>\")\n                            .attr(\"href\", Galaxy.root + url)\n                            .html(label)\n                    )\n                    .html();\n            }\n            this.$toggle.popover && this.$toggle.popover(\"destroy\");\n            this.$toggle\n                .popover({\n                    html: true,\n                    placement: \"bottom\",\n                    content: `Please ${buildLink(\"login\", \"user/login?use_panels=True\")} or ${buildLink(\n                        \"register\",\n                        \"user/create?use_panels=True\"\n                    )} to use this feature.`\n                })\n                .popover(\"show\");\n            setTimeout(() => {\n                self.$toggle.popover(\"destroy\");\n            }, 5000);\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function(url) {\n        return typeof url == \"string\" && url.indexOf(\"//\") === -1 && url.charAt(0) != \"/\" ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function() {\n        return (\n            '<ul class=\"nav navbar-nav\">' +\n            '<li class=\"dropdown\">' +\n            '<a class=\"dropdown-toggle\"/>' +\n            '<ul class=\"dropdown-menu\"/>' +\n            '<div class=\"dropdown-note\"/>' +\n            \"</li>\" +\n            \"</ul>\"\n        );\n    }\n});\n\nexport default {\n    Collection: Collection,\n    Tab: Tab\n};\n"]}