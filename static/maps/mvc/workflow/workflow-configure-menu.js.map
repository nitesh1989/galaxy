{"version":3,"sources":["mvc/workflow/workflow-configure-menu.js"],"names":["define","View","Backbone","extend","this","setElement","initialize","render","self","Galaxy","root","response","workflows","getJSON","ids_in_menu","$el","empty","append","_templateConfigWorkflowHeader","$el_config_worflow","find","_templateActionButtons","save_workflow_menu","_templateNoWorkflow","register_check_uncheck_all","$el_check_all","click","e","$el_uncheck_all","check_uncheck_all","checked","$","wf_checkbox","make_checked","each","_","id","parseInt","value","$el_save_workflow_menu","ids","ajax","type","url","workflow_ids","data","stringify","contentType","done","location","tableHtml","trHtml","wf","_templateInputCheckbox","escape","name","owner","user","attributes","username","number_of_steps"],"mappings":"YACAA,WAAY,WAoJR,OACIC,KAtJRC,SAAAD,KAAAE,QAEQF,WAAOC,SAAcC,GAGjBC,KAAKC,WAAY,UADrBC,KAAAA,UAGCC,OAL2B,WAQxB,GAAIC,GAAOJ,IADfG,GAAAA,QAAQE,OAAAC,KAAW,sBAAA,SAAAC,GACXH,GAAAA,GAAJG,EAAAC,UACEC,EAASF,EAAcG,YACjBF,EAAqBA,IAKzBJ,GAAKO,IAAIC,QAAQC,OAAQT,EAAKU,iCAD9BC,EAAAX,EAAAO,IAAAK,KAAA,wBACAZ,EAAiBS,OAAQT,EAAKU,0BAC9BC,EAAAA,OAAqBX,GACrBW,EAAmBF,OAAaI,EAAAA,2BAAhCb,EAAAI,EAAAE,IACIF,EAAAA,mBAAuBJ,GACvBW,EAAAA,aAAmBF,EAAnBH,GACAN,EAAKc,2BAALd,IAFJW,EAMKF,OAAAT,EAAAe,0BAMbC,2BAAA,SAAAhB,GACAgB,GAAAA,GAAAA,EAA4BT,IAAAK,KAAA,iBACpBK,EAAgBjB,EAAKO,IAAIK,KAAM,kBAGnCK,GAAcC,MAAM,SAAUC,GAA9BF,EAAAA,kBAAoBjB,GAAc,KAEjCoB,EAFDF,MAAA,SAAAC,GAGAC,EAAAA,kBAAsBpB,GAAA,MAK1BqB,kBAAA,SAAArB,EAAAsB,GACAD,EAAAA,KAAAA,EAAAA,IAAmBT,KAAA,mBAAUZ,WACHuB,EAAA3B,MAAA,GACd4B,QAAiBF,KAK7BG,aAAA,SAAAzB,EAAAM,GACAmB,EAAAA,KAAAA,EAAclB,IAAAK,KAAA,mBAAgBN,WACxBoB,GAAK1B,GAAeuB,EAAA3B,MAAA,EAClB+B,GAAAD,KAAIF,EAAiB,SAArBI,GACQtB,SAARkB,EAA+BI,SAAKA,IAC3BC,EAAUL,SAAYM,QAOvChB,mBAAA,SAAAd,GACoBA,EAAAO,IAAAK,KAAUZ,iBACtB+B,MAAyB/B,SAASY,GACtCmB,GAAAA,KACIR,GAAAG,KAAIM,EAAJzB,IAAAK,KAAA,mBAAA,WACEc,GAAK1B,GAAeuB,EAAA3B,MAAA,IACd4B,EAAAA,SAAJ,SAAkBA,EAAlBF,UACIE,EAAAA,KAAAA,SAAAA,EAAuBA,UAG9BD,EALDU,MAMEA,KAAK,MACHC,IAAAA,OADGhC,KAAA,sBAEHiC,KAAKlC,KAAAA,WAAcmC,aAFhBJ,IAGHK,YAAWC,qBACXC,KAAAA,SAAcpC,GACfqC,OAAMC,SAAUtC,OAAWD,KAAA,YAMtCW,uBAAA,WACAA,MAAAA,4PAgCI6B,2BAAwB,SAAA1C,EAAAI,EAAAE,GAMxB,GAAAoC,GAAA,GAAAC,EAAA,EAAA,OA5HwBD,IAAA,kMAoI5Bf,EAAAD,KAAAtB,EAAA,SAAAwC,GACAC,EAAAA,EAAwB,yBACblB,EAAAmB,OAAAF,EAAAG,MAAA,aAtIiBH,EAAAI,QAAA/C,OAAAgD,KAAAC,WAAAC,SAAA,MAAAP,EAAAI,OAAA,0BAiHOJ,EAAGQ,gBAAkB,0BAwBxDpD,EAAA6C,uBAAA7C,EAAA4C,EAAAtC,GAAA,eAOCoC,EAAAA,EAAA,uCAAAC,EAAA,mBAhJLD,EAAAA,EAAA,+KAoJWjD,OAAAA,KAAAA,oFApBPsB,oBAAqB,WACjB,MAAO,4EAIX8B,uBAAwB,SAAU7C,EAAM4C,GACpC,MAAO,4EAA6EA,EAAGhB,GAAI,QAI/FlB,8BAA+B,WAC3B,MAAO","file":"../../../scripts/mvc/workflow/workflow-configure-menu.js","sourcesContent":["/** Configure Workflow Menu View */\ndefine( [], function() {\n    var View = Backbone.View.extend({\n\n        initialize: function( options ) {\n            this.setElement( '<div/>' );\n            this.render();\n        },\n\n        render: function() {\n            var self = this;\n            $.getJSON( Galaxy.root + 'api/workflows/menu/', function( response ) {\n                var workflows = response.workflows,\n                    ids_in_menu = response.ids_in_menu,\n                    $el_config_worflow = null;\n\n                // Add configure workflow header\n                self.$el.empty().append( self._templateConfigWorkflowHeader() );\n                $el_config_worflow = self.$el.find( '.configure-workflows' );\n                $el_config_worflow.append( self._templateActionButtons() );\n                if( workflows.length > 0 ) {\n                    $el_config_worflow.append( self._templateConfigureWorkflow( self, workflows, ids_in_menu ) );\n                    self.save_workflow_menu( self );\n                    self.make_checked( self, ids_in_menu );\n                    self.register_check_uncheck_all( self );\n                }\n                else {\n                    $el_config_worflow.append( self._templateNoWorkflow() );\n                }\n            });\n        },\n\n        /** Register check and uncheck all callbacks*/\n        register_check_uncheck_all: function( self ) {\n            var $el_check_all = self.$el.find( '.check-all-wf' ),\n                $el_uncheck_all = self.$el.find( '.uncheck-all-wf' );\n            \n            $el_check_all.click(function( e ) {\n                self.check_uncheck_all( self, true );\n            });\n            $el_uncheck_all.click(function( e ) {\n                self.check_uncheck_all( self, false );\n            });\n        },\n\n        /** Check or uncheck all workflows */\n        check_uncheck_all: function( self, checked ) {\n            $.each(self.$el.find( '.wf-config-item' ), function() {\n                var wf_checkbox = $( this )[0];\n                wf_checkbox.checked = checked;\n            });\n        },\n\n        /** Make the worflows as checked if present in the menu */\n        make_checked: function( self, ids_in_menu ) {\n            $.each(self.$el.find( '.wf-config-item' ), function() {\n                var wf_checkbox = $( this )[0];\n                _.each( ids_in_menu, function( id ) {\n                    if ( parseInt( wf_checkbox.value ) === id ) {\n                        wf_checkbox.checked = true;\n                    }\n                });\n            });\n        },\n\n        /** Save the changes for workflow menu */\n        save_workflow_menu: function( self ) {\n            var $el_save_workflow_menu = self.$el.find( '.wf-save-menu' );\n            $el_save_workflow_menu.click( function( e ) {\n                var ids = [];\n                $.each(self.$el.find( '.wf-config-item' ), function() {\n                    var wf_checkbox = $( this )[0];\n                    if( wf_checkbox.checked || wf_checkbox.checked === 'true' ) {\n                        ids.push( parseInt( wf_checkbox.value ) );\n                    }\n                });\n                $.ajax({\n                    type: 'PUT',\n                    url: Galaxy.root + 'api/workflows/menu/',\n                    data: JSON.stringify( { 'workflow_ids': ids } ),\n                    contentType : 'application/json'\n                }).done( function( response ) {\n                    window.location = Galaxy.root + 'user';\n                });\n            });\n        },\n\n        /** Template for actions buttons */\n        _templateActionButtons: function() {\n           return '<ul class=\"manage-table-actions\">' +\n                '<li>' +\n                    '<a class=\"fa fa-check-square-o wf-action check-all-wf\" title=\"Select all workflows\" href=\"#\">' +\n                    '</a>' +\n                '</li>' +\n                '<li>' +\n                    '<a class=\"fa fa-square-o wf-action uncheck-all-wf\" title=\"Unselect all workflows\" href=\"#\">' +\n                    '</a>' +\n                '</li>' +\n            '</ul>';\n        },\n\n        /** Template for configure workflow table */\n        _templateConfigureWorkflow: function( self, workflows, ids_in_menu ) {\n            var tableHtml = \"\", trHtml = \"\";\n            tableHtml = tableHtml + '<table class=\"table colored\"><thead>' +\n                    '<tr class=\"header\">' +\n                        '<th class=\"wf-td\">Name</th>' +\n                        '<th class=\"wf-td\">Owner</th>' +\n                        '<th class=\"wf-td\"># of Steps</th>' +\n                        '<th class=\"wf-td\">Show in menu</th>' +\n                    '</tr></thead>';\n            _.each( workflows, function( wf ) {\n                trHtml = trHtml + '<tr>' +\n                    '<td class=\"wf-td\">' + _.escape( wf.name ) +'</td>' +\n                    '<td>' + ( wf.owner === Galaxy.user.attributes.username ? \"You\" : wf.owner ) +'</td>' +\n                    '<td class=\"wf-td\">' + wf.number_of_steps + '</td>' +\n                    '<td class=\"wf-td\">' + self._templateInputCheckbox( self, wf, ids_in_menu ) + '</td>' +\n                '</tr>';\n            });\n            tableHtml = tableHtml + '<tbody class=\"workflow-config-menu\">' + trHtml + '</tbody></table>';\n            tableHtml = tableHtml + '<a class=\"action-button wf-save-menu wf-action fa fa-floppy-o\" href=\"#\" title=\"Save\">' +\n                                        '<span>Save</span>' +\n                                    '</a>' +\n                                    '<a class=\"action-button wf-back wf-action fa fa-arrow-left\" href=\"'+ Galaxy.root +'user\" title=\"Back to User Preferences\">' +\n                                        '<span>Back to User Preferences</span>' +\n                                    '</a>';\n            return tableHtml;\n        },\n\n       /** Template for no workflow */\n        _templateNoWorkflow: function() {\n            return '<div class=\"wf-nodata\"> You do not have any accessible workflows. </div>';\n        },\n\n        /** Template for checkboxes */\n        _templateInputCheckbox: function( self, wf ) {\n            return '<input type=\"checkbox\" class=\"wf-config-item\" name=\"workflow_ids\" value=\"'+ wf.id +'\" />';\n        },\n\n        /** Template for main config workflow menu */\n        _templateConfigWorkflowHeader: function() {\n            return '<div class=\"page-container\">' +\n                       '<div class=\"configure-workflows wf\">' +\n                           '<h2>Configure workflow menu</h2>' +\n                       '</div>'+\n                   '</div>';\n        }\n    });\n    \n    return {\n        View : View\n    };\n});\n"]}