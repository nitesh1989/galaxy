{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["View","Backbone","extend","events","click .ui-thumbnails-item","dblclick .ui-thumbnails-item","initialize","options","this","model","Model","collection","Collection","get","tabs","_uiTabs2","default","setElement","$el","addClass","render","listenTo","first","delAll","_renderDefault","_renderList","self","indexOf","title","append","_templateThumbnailItem","id","length","substr","title_icon","image_src","title_length","add","_utils2","uid","undefined","new_value","$","attr","removeClass","after","change_handler","before","_onclick","value","e","target","closest","_ondblclick","_templateRegularItem","description"],"mappings":"sPAIIA,EAAOC,SAASD,KAAKE,QACrBC,QACIC,4BAA6B,WAC7BC,+BAAgC,eAGpCC,WAAY,SAASC,GACjBC,KAAKC,MAAQF,EAAQE,OAAS,IAAIR,SAASS,MAAMH,GACjDC,KAAKG,WAAa,IAAIV,SAASW,WAAWJ,KAAKC,MAAMI,IAAI,eACzDL,KAAKM,KAAO,IAAIC,EAAAC,QAAKhB,SACrBQ,KAAKS,WAAWT,KAAKM,KAAKI,IAAIC,SAAS,kBACvCX,KAAKY,SACLZ,KAAKa,SAASb,KAAKC,MAAO,SAAUD,KAAKY,OAAQZ,MACjDA,KAAKa,SAASb,KAAKG,WAAY,0BAA2BH,KAAKY,OAAQZ,OAZ3EL,OAAAA,WACIK,KAAAc,MAAA,KACAd,KAAAM,KAAAS,SAFIf,KADoBgB,iBAoBxBhB,KAAKiB,eAZLD,eAAKb,WACL,IAAAe,EAAKZ,KAGLI,EAAKG,EAAAA,UAASF,SAAY,sBAC1BX,KAAAG,WAAKU,KAAS,SAAAZ,GAbU,IAAA,IAAAA,EAAAI,IAAA,YAAAc,QAAA,WAAA,CA8BhB,IAAIC,EAAQnB,EAAMI,IAAI,SAd1BK,EAAAW,OACCP,EACKC,EAAVO,wBACKN,GAALf,EAAAsB,GACAH,MAAAA,EAAAI,OATA,GASAJ,EAAAA,EAAAK,OAAA,EATA,IASA,MApBwBC,WAAAzB,EAAAI,IAAA,cAqCJsB,UAAW1B,EAAMI,IAAI,gBAbrCa,SACQE,MAAZnB,EAAAI,IAAA,eACIuB,UAAJ,eAKQlB,EAAAA,WAAIW,OAEIH,GACIK,KAAAA,KAAAA,KACAH,GAAAA,EAAAA,QAAAA,MACAM,MAAAA,EAAAA,MAAAA,IAAYzB,iBACZ0B,IAAAA,KAOfV,YAAA,WACJ,IAAAC,EAjBDlB,KAkBA,GAAAA,KAAIU,WAAAc,OAAA,EAAwB,CACxBxB,KAAAc,MAAAd,KAAcc,OAAAd,KAAAG,WAAAW,QAAAS,GACVA,IAAAA,EAAAA,EAAI,UAAAZ,SAAA,sBACJS,KAAAA,WAAOF,KAAKjB,SAAAA,GACZS,EAAAA,OAAKA,EAAAA,qBAAAA,EAAAA,eAEZV,KAAAM,KAAAuB,KApDuBN,GAAAO,EAAAtB,QAAAuB,MAiEhBX,MAAOF,EAAKjB,MAAMI,IAAI,cAVlCY,IAAaP,MAMDA,MAAAA,SAAAA,GACH,QAFDsB,IAECC,EAFD,CAGAA,EAAc,WAAT3B,EAASN,KAAAc,MAAAmB,EACVV,IAAAA,EAAIvB,KAAAkC,EAAA,yBADMC,KAAA,SAEVf,KAAAA,EAAAA,yBAAsBgB,YAFZ,wBAGV1B,KAAAA,EAAAA,WAAKA,EAALA,MAAKA,SAAAA,wBAHK,IAAA2B,EAAdrC,KAAAkC,EAAA,yBAAAC,KAAA,SAKHG,EAAAtC,KAAAC,MAAAI,IAAA,YApEuBgC,GAAAE,GAAAD,GAAAA,EAAAD,GAuE5B,OAAArC,KAAAkC,EAAA,yBAAAC,KAAA,UAIQK,SAAA,SAAID,GACJvC,KAAAyC,MACAP,EAAAQ,EAAAC,QACAC,QAAIP,uBACJF,KAAIG,WAgBZO,YAAa,SAASH,GAVtB1C,KAAAC,MAAAI,IAAA,eAAAL,KAAAC,MAAAI,IAAA,aAAAL,CAAAA,KAAAyC,UAeAnB,uBAAwB,SAASvB,GANjC,MAAA,mEAAAA,EAAAwB,GAAA,2CAAAxB,EAAA4B,UAAA,mEAAA5B,EAAA2B,WAAA,MAAA3B,EAAAqB,MAAA,eAWA0B,qBAAsB,SAAS/C,GAN/B,MAAA,0CAAAA,EAAAwB,GAAA,0DAAAxB,EAAA4B,UAAA,wEAAA5B,EAAAqB,MAAA,kEAAArB,EAAAgD,YAAA,sCAWavD,KAAMA","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nvar View = Backbone.View.extend({\n    events: {\n        \"click .ui-thumbnails-item\": \"_onclick\",\n        \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n    },\n\n    initialize: function(options) {\n        this.model = options.model || new Backbone.Model(options);\n        this.collection = new Backbone.Collection(this.model.get(\"collection\"));\n        this.tabs = new Tabs.View({});\n        this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(this.collection, \"reset change add remove\", this.render, this);\n    },\n\n    render: function() {\n        this.first = null;\n        this.tabs.delAll();\n        this._renderDefault();\n        this._renderList();\n    },\n\n    _renderDefault: function() {\n        var self = this;\n        var index = [];\n        var title_length = 20;\n        var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n        this.collection.each(model => {\n            if (model.get(\"keywords\").indexOf(\"default\") !== -1) {\n                var title = model.get(\"title\");\n                $el.append(\n                    $(\n                        self._templateThumbnailItem({\n                            id: model.id,\n                            title: title.length < title_length ? title : `${title.substr(0, title_length)}...`,\n                            title_icon: model.get(\"title_icon\"),\n                            image_src: model.get(\"image_src\")\n                        })\n                    ).tooltip({\n                        title: model.get(\"description\"),\n                        placement: \"bottom\"\n                    })\n                );\n            }\n        });\n        if ($el.children().length > 0) {\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_default\"),\n                $el: $el\n            });\n        }\n    },\n\n    _renderList: function() {\n        var self = this;\n        if (this.collection.length > 0) {\n            this.first = this.first || this.collection.first().id;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(model => {\n                $el.append(self._templateRegularItem(model.attributes));\n            });\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_list\"),\n                $el: $el\n            });\n        }\n    },\n\n    /** Set/Get value */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            new_value = new_value == \"__first\" ? this.first : new_value;\n            var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            this.$(\".ui-thumbnail-current\").removeClass(\"ui-thumbnail-current\");\n            this.$(`[value=\"${new_value}\"]`).addClass(\"ui-thumbnail-current\");\n            var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            var change_handler = this.model.get(\"onchange\");\n            after != before && change_handler && change_handler(after);\n        }\n        return this.$(\".ui-thumbnail-current\").attr(\"value\");\n    },\n\n    /** Add click handler */\n    _onclick: function(e) {\n        this.value(\n            $(e.target)\n                .closest(\".ui-thumbnails-item\")\n                .attr(\"value\")\n        );\n    },\n\n    /** Add double click handler */\n    _ondblclick: function(e) {\n        this.model.get(\"ondblclick\") && this.model.get(\"ondblclick\")(this.value());\n    },\n\n    /* Thumbnail template with image */\n    _templateThumbnailItem: function(options) {\n        return `<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"${options.id}\"><img class=\"ui-thumbnails-image\" src=\"${options.image_src}\"><div class=\"ui-thumbnails-title ui-form-info\"><span class=\"fa ${options.title_icon}\"/>${options.title}</div><div>`;\n    },\n\n    /* Thumbnail template with image and description */\n    _templateRegularItem: function(options) {\n        return `<div class=\"ui-thumbnails-item\" value=\"${options.id}\"><table><tr><td><img class=\"ui-thumbnails-image\" src=\"${options.image_src}\"></td><td><div class=\"ui-thumbnails-description-title ui-form-info\">${options.title}</div><div class=\"ui-thumbnails-description-text ui-form-info\">${options.description}</div></td></tr><div>`;\n    }\n});\n\nexport default { View: View };\n"]}