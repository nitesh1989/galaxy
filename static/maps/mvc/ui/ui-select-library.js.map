{"version":3,"sources":["mvc/ui/ui-select-library.js"],"names":["Libraries","Backbone","Collection","extend","url","Galaxy","root","LibraryDatasets","initialize","self","this","config","Model","library_id","on","fetch","reset","get","View","options","libraries","library_select","_uiMisc2","default","Select","onchange","value","set","dataset_list","_uiList2","name","optional","multiple","datasets","trigger","data","push","model","id","label","update","text","each","setElement","$el","success","undefined","append","_template"],"mappings":"mRAMIA,EAAYC,SAASC,WAAWC,QAChCC,IAAQC,OAAOC,KAAf,gCAIAC,EAAkBN,SAASC,WAAWC,QACtCK,WAAY,WACR,IAAIC,EAAOC,KACXA,KAAKC,OAAS,IAAIV,SAASW,OAAQC,WAAY,OAC/CH,KAAKC,OAAOG,GAAG,SAAU,WACrBL,EAAKM,OAAQC,OAAO,OAG5BZ,IAAK,WACD,OAAUC,OAAOC,KAAjB,iBAAsCI,KAAKC,OAAOM,IAAI,cAAtD,eAdmCC,EAA3CjB,SAAAiB,KAAAf,QAIAK,WAAA,SAAAW,GAEIX,IAAAA,EAAAA,KAGIE,KAAAU,UAAYN,IAAGd,EACXS,KAAAA,SAAKM,IAAMR,EAGnBH,KAAKe,QAAAA,EAqBDT,KAAKW,eAAiB,IAAIC,EAAAC,QAAGC,OAAON,MAhB5CO,SAAA,SAAAC,GACWzB,EAAAA,SAAcE,OAAOwB,IAAA,aAAAD,MAsBxBhB,KAAKkB,aAAe,IAAIC,EAAAN,QAAKL,MAhB7BY,KAAA,UACAC,SAAKX,EAAYW,SACjBC,SAAKC,EAAWD,SAkBZP,SAAU,WAhBdhB,EAAAyB,QAAA,aAKAxB,KAAAU,UAAKC,GAAAA,QAAiB,WAClBI,IAAAA,KACIhB,EAAAA,UAAKwB,KAAAA,SAAAA,GACRE,EAAAC,MAHLV,MAAAW,EAAAC,GAsBYC,MAAOF,EAAMpB,IAAI,YAdzBa,EAAAA,eAD8BU,OAAAL,KAK1B1B,KAAAA,SAAAA,GAAKyB,QAAQ,WAChB,IAAAC,KAmBuB,OAzB5B1B,EAAAY,eAAAoB,QASAhC,EAAAwB,SAAAS,KAAA,SAAAL,GAC2B,SAAtBjB,EAAaH,IAAA,SACVkB,EAAJC,MACKhB,MAALiB,EAAoBC,GACXF,MAAKC,EAAApB,IAAA,YAKdR,EAAAA,aAAKY,OAAemB,KAIxB9B,KAAAI,GAAA,SAAcA,WACVK,EAAIgB,UAAJhB,EAAAM,SAAAhB,EAAAiB,WAIQhB,KAAAiC,WAAAjC,KAAI2B,aACAF,KAAAA,EAAAA,mBAAKC,OAAK1B,KAAAW,eAAAuB,KACNlB,KAAAA,IAAAA,OAAAA,KAAAA,aAAOW,KAGd3B,KAAAU,UAAAL,OACJC,OAAA,EACJ6B,QAAA,WACDpC,EAAKmB,eAAaY,QAAOL,eAb7BW,IAAArC,EAAAU,QAAAO,OAgCYjB,EAAKiB,MAAMjB,EAAKU,QAAQO,WAVpCA,MAAA,SAAKiB,GACL,OAAAjC,KAAOkB,aAAAF,MAAmBqB,IAI1BC,UAAA,WACIhC,MACA6B,iLAWJ3B,KAAAA","file":"../../../scripts/mvc/ui/ui-select-library.js","sourcesContent":["// dependencies\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Table from \"mvc/ui/ui-table\";\nimport List from \"mvc/ui/ui-list\";\n// collection of libraries\nvar Libraries = Backbone.Collection.extend({\n    url: `${Galaxy.root}api/libraries?deleted=false`\n});\n\n// collection of dataset\nvar LibraryDatasets = Backbone.Collection.extend({\n    initialize: function() {\n        var self = this;\n        this.config = new Backbone.Model({ library_id: null });\n        this.config.on(\"change\", () => {\n            self.fetch({ reset: true });\n        });\n    },\n    url: function() {\n        return `${Galaxy.root}api/libraries/${this.config.get(\"library_id\")}/contents`;\n    }\n});\n\n// hda/hdca content selector ui element\nvar View = Backbone.View.extend({\n    // initialize\n    initialize: function(options) {\n        // link this\n        var self = this;\n\n        // collections\n        this.libraries = new Libraries();\n        this.datasets = new LibraryDatasets();\n\n        // link app and options\n        this.options = options;\n\n        // select field for the library\n        // TODO: Remove this once the library API supports searching for library datasets\n        this.library_select = new Ui.Select.View({\n            onchange: function(value) {\n                self.datasets.config.set(\"library_id\", value);\n            }\n        });\n\n        // create ui-list view to keep track of selected data libraries\n        this.dataset_list = new List.View({\n            name: \"dataset\",\n            optional: options.optional,\n            multiple: options.multiple,\n            onchange: function() {\n                self.trigger(\"change\");\n            }\n        });\n\n        // add reset handler for fetched libraries\n        this.libraries.on(\"reset\", () => {\n            var data = [];\n            self.libraries.each(model => {\n                data.push({\n                    value: model.id,\n                    label: model.get(\"name\")\n                });\n            });\n            self.library_select.update(data);\n        });\n\n        // add reset handler for fetched library datasets\n        this.datasets.on(\"reset\", () => {\n            var data = [];\n            var library_current = self.library_select.text();\n            if (library_current !== null) {\n                self.datasets.each(model => {\n                    if (model.get(\"type\") === \"file\") {\n                        data.push({\n                            value: model.id,\n                            label: model.get(\"name\")\n                        });\n                    }\n                });\n            }\n            self.dataset_list.update(data);\n        });\n\n        // add change event. fires on trigger\n        this.on(\"change\", () => {\n            options.onchange && options.onchange(self.value());\n        });\n\n        // create elements\n        this.setElement(this._template());\n        this.$(\".library-select\").append(this.library_select.$el);\n        this.$el.append(this.dataset_list.$el);\n\n        // initial fetch of libraries\n        this.libraries.fetch({\n            reset: true,\n            success: function() {\n                self.library_select.trigger(\"change\");\n                if (self.options.value !== undefined) {\n                    self.value(self.options.value);\n                }\n            }\n        });\n    },\n\n    /** Return/Set currently selected library datasets */\n    value: function(val) {\n        return this.dataset_list.value(val);\n    },\n\n    /** Template */\n    _template: function() {\n        return (\n            '<div class=\"ui-select-library\">' +\n            '<div class=\"library ui-margin-bottom\">' +\n            '<span class=\"library-title\">Select Library</span>' +\n            '<span class=\"library-select\"/>' +\n            \"</div>\" +\n            \"</div>\"\n        );\n    }\n});\n\nexport default {\n    View: View\n};\n"]}