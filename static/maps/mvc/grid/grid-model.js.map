{"version":3,"sources":["mvc/grid/grid-model.js"],"names":["Backbone","Model","extend","defaults","url_base","async","async_ops","categorical_filters","filters","sort_key","show_item_checkboxes","advanced_search","cur_page","can_async_op","op","_","indexOf","this","attributes","add_filter","key","value","append","new_val","cur_val","values","push","remove_filter","condition","undefined","condition_index","get_url_data","url_data","page","sort","operation","self","each","pairs","k","get_url","args","get","$","param"],"mappings":"6HAGeA,SAASC,MAAMC,QAC1BC,UACIC,SAAU,GACVC,OAAO,EAFXF,aACIC,uBACAC,WACAC,SAAAA,KACAC,sBAAAA,EACAC,iBALM,EAMNC,SAAAA,EACAC,UAAAA,EACAC,eAAAA,EACAC,cAAAA,GAMJC,aAAA,SAAAC,GAII,OAAqD,IAA9CC,EAAEC,QAAQC,KAAKC,WAAWZ,UAAWQ,IAGhDK,WAAA,SAAAC,EAAAC,EAAAC,GAKI,GAAIA,EAAQ,CADZ,IAEIC,EAFJC,EAAAP,KAAAC,WAAAV,QAAAY,GAGI,GAAII,OAAJA,QAA8BhB,IAAXU,EAIfK,EAAUF,OAFd,GAAA,iBAAAG,EACA,GAAIA,OAAAA,GAAoBA,GAAAA,EACpBD,EAAUF,MACP,CAECE,IAAAA,KACHE,EAAM,GAAAD,EACHC,EAAA,GAAAJ,EACAE,EAAIE,OAKL,KADFF,EAAAC,GACER,QAAAK,IACHE,EAAAG,KAAAL,GAGIE,KAAAA,WAAAA,QAAAH,GAAAG,OAGRN,KAAAC,WAAKA,QAAWV,GAAhBa,GAORM,cAAA,SAAAP,EAAAQ,GAII,IAAIJ,EAAUP,KAAKC,WAAWV,QAAQY,GACtC,GAAgB,OAAZI,QAAgCK,IAAZL,EAF5BG,OAAAA,EAGQ,GAAA,iBAAAH,EAKAP,KAAKC,WAAWV,QAAQY,GAAO,OAFnC,CAEI,IAAAU,EAAgBtB,EAAAA,QAAhBgB,EAAAI,IACG,IAHPE,IAIIN,EAAAM,GAAA,MAQRC,aAAA,WAII,IAAIC,GACA3B,MAAOY,KAAKC,WAAWb,MAF/B0B,KAAAA,KAAcb,WAAAT,SACVwB,KAAID,KAAAA,WAAWpB,SACXP,qBAAYa,KAAWb,WADZK,qBAEXwB,gBAAWhB,KAAAA,WAAWT,iBAFXQ,KAAfC,WAAAiB,YAUIH,EAASG,UAAYlB,KAAKC,WAAWiB,WADzClB,KAAIC,WAAKA,WACLc,EAAAA,GAASG,KAAAA,WAAiBjB,UAI7B,IAAAkB,EAAAnB,KAIDF,OAAAA,EAAEsB,KAAKtB,EAAEuB,MAAMF,EAAKlB,WAAWV,SAAU,SAAA+B,GAFzCP,EAAAA,KAAAO,EAAA,IAAAA,EAAA,KAEEF,GAILG,QA1GgC,SAAAC,GA8G7B,OAAUxB,KAAKyB,IAAI,YAAnB,IAAkCC,EAAEC,MAAM3B,KAAKc,gBAA/C,IAAkEY,EAAEC,MAAMH","file":"../../../scripts/mvc/grid/grid-model.js","sourcesContent":["// dependencies\n\n// grid model\nexport default Backbone.Model.extend({\n    defaults: {\n        url_base: \"\",\n        async: false,\n        async_ops: [],\n        categorical_filters: [],\n        filters: {},\n        sort_key: null,\n        show_item_checkboxes: false,\n        advanced_search: false,\n        cur_page: 1,\n        num_pages: 1,\n        operation: undefined,\n        item_ids: undefined\n    },\n\n    /**\n     * Return true if operation can be done asynchronously.\n     */\n    can_async_op: function(op) {\n        return _.indexOf(this.attributes.async_ops, op) !== -1;\n    },\n\n    /**\n     * Add filtering criterion.\n     */\n    add_filter: function(key, value, append) {\n        // Update URL arg with new condition.\n        if (append) {\n            // Update or append value.\n            var cur_val = this.attributes.filters[key];\n\n            var new_val;\n            if (cur_val === null || cur_val === undefined) {\n                new_val = value;\n            } else if (typeof cur_val == \"string\") {\n                if (cur_val == \"All\" || cur_val == value) {\n                    new_val = value;\n                } else {\n                    // Replace string with array.\n                    var values = [];\n                    values[0] = cur_val;\n                    values[1] = value;\n                    new_val = values;\n                }\n            } else {\n                // Current value is an array.\n                new_val = cur_val;\n                if (new_val.indexOf(value) === -1) {\n                    new_val.push(value);\n                }\n            }\n            this.attributes.filters[key] = new_val;\n        } else {\n            // Replace value.\n            this.attributes.filters[key] = value;\n        }\n    },\n\n    /**\n     * Remove filtering criterion.\n     */\n    remove_filter: function(key, condition) {\n        var cur_val = this.attributes.filters[key];\n        if (cur_val === null || cur_val === undefined) {\n            return false;\n        }\n\n        if (typeof cur_val === \"string\") {\n            // overwrite/remove condition.\n            this.attributes.filters[key] = \"\";\n        } else {\n            // filter contains an array of conditions.\n            var condition_index = _.indexOf(cur_val, condition);\n            if (condition_index !== -1) {\n                cur_val[condition_index] = \"\";\n            }\n        }\n    },\n\n    /**\n     * Returns URL data for obtaining a new grid.\n     */\n    get_url_data: function() {\n        var url_data = {\n            async: this.attributes.async,\n            sort: this.attributes.sort_key,\n            page: this.attributes.cur_page,\n            show_item_checkboxes: this.attributes.show_item_checkboxes,\n            advanced_search: this.attributes.advanced_search\n        };\n\n        // Add operation, item_ids only if they have values.\n        if (this.attributes.operation) {\n            url_data.operation = this.attributes.operation;\n        }\n        if (this.attributes.item_ids) {\n            url_data.id = this.attributes.item_ids;\n        }\n\n        // Add filter arguments to data, placing \"f-\" in front of all arguments.\n        var self = this;\n        _.each(_.pairs(self.attributes.filters), k => {\n            url_data[`f-${k[0]}`] = k[1];\n        });\n        return url_data;\n    },\n\n    // Return URL for obtaining a new grid\n    get_url: function(args) {\n        return `${this.get(\"url_base\")}?${$.param(this.get_url_data())}&${$.param(args)}`;\n    }\n});\n"]}