{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["Backbone","View","extend","status_classes","init","queued","running","success","error","initialize","app","options","self","this","model","setElement","_template","$mode","$","$title","$text","$size","$percentage","settings","_uiPopover2","default","title","container","placement","default_genome","select_genome","value","default_extension","select_extension","_uiSelect2","css","$symbol","data","$progress_bar","onchange","genome","set","extension","showExtensionInfo","$el","e","target","text","preventDefault","on","_showSettings","$text_content","val","file_size","length","listenTo","_refreshStatus","url_paste","_refreshGenome","_refreshType","_refreshPercentage","_refreshInfo","_refreshFileSize","remove","render","apply","_refreshExtension","file_name","html","_utils2","bytesToString","removeClass","addClass","width","top","height","escape","file_mode","get","info","show","$info_text","hide","percentage","status","enabled","attr","enable","disable","$info_progress","indexOf","collection","visible","empty","append","_uploadSettings2","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["/** Renders the default uploader rows */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: \"Upload configuration\",\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // create select genomes\n        this.select_genome = new Select.View({\n            css: \"upload-genome\",\n            data: self.app.list_genomes,\n            container: this.$(\".upload-genome\"),\n            value: default_genome,\n            onchange: function(genome) {\n                self.model.set(\"genome\", genome);\n            }\n        });\n\n        // create select extension\n        this.select_extension = new Select.View({\n            css: \"upload-extension\",\n            data: self.app.list_extensions,\n            container: this.$(\".upload-extension\"),\n            value: default_extension,\n            onchange: function(extension) {\n                self.model.set(\"extension\", extension);\n            }\n        });\n\n        // initialize genome and extension values\n        this.model.set({\n            genome: default_genome,\n            extension: default_extension\n        });\n\n        // handle click event\n        this.$symbol.on(\"click\", () => {\n            self._removeRow();\n        });\n\n        // handle extension info popover\n        this.$(\".upload-extension-info\")\n            .on(\"click\", e => {\n                self.app.showExtensionInfo({\n                    $el: $(e.target),\n                    title: self.select_extension.text(),\n                    extension: self.select_extension.value()\n                });\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // handle settings popover\n        this.$settings\n            .on(\"click\", e => {\n                self._showSettings();\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", e => {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", () => {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", () => {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", () => {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:genome\", () => {\n            self._refreshGenome();\n        });\n        this.listenTo(this.model, \"change:extension\", () => {\n            self._refreshExtension();\n        });\n        this.listenTo(this.model, \"change:file_size\", () => {\n            self._refreshFileSize();\n        });\n    },\n\n    render: function() {\n        this._refreshType();\n        this._refreshPercentage();\n        this._refreshStatus();\n        this._refreshInfo();\n        this._refreshGenome();\n        this._refreshExtension();\n        this._refreshFileSize();\n    },\n\n    /** Remove view */\n    remove: function() {\n        this.select_genome.remove();\n        this.select_extension.remove();\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    /** Render type */\n    _refreshType: function() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(Utils.bytesToString(options.file_size));\n        this.$mode\n            .removeClass()\n            .addClass(\"upload-mode\")\n            .addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text\n                .css({\n                    width: `${this.$el.width() - 16}px`,\n                    top: `${this.$el.height() - 8}px`\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Update extension */\n    _refreshExtension: function() {\n        this.select_extension.value(this.model.get(\"extension\"));\n    },\n\n    /** Update genome */\n    _refreshGenome: function() {\n        this.select_genome.value(this.model.get(\"genome\"));\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(`<strong>Failed: </strong>${info}`).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: `${percentage}%` });\n        this.$percentage.html(percentage != 100 ? `${percentage}%` : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$symbol\n            .removeClass()\n            .addClass(\"upload-symbol\")\n            .addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (enabled) {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        } else {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        }\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function() {\n        this.$size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function() {\n        if ([\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !== -1) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function(options) {\n        return `<tr id=\"upload-row-${options.id}\" class=\"upload-row\"><td><div class=\"upload-text-column\"><div class=\"upload-mode\"/><div class=\"upload-title\"/><div class=\"upload-text\"><div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class=\"upload-text-content form-control\"/></div></div></td><td><div class=\"upload-size\"/></td><td><div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp<div class=\"upload-extension-info upload-icon-button fa fa-search\"/></td><td><div class=\"upload-genome\"/></td><td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td><td><div class=\"upload-info\"><div class=\"upload-info-text\"/><div class=\"upload-info-progress progress\"><div class=\"upload-progress-bar progress-bar progress-bar-success\"/><div class=\"upload-percentage\">0%</div></div></div></td><td><div class=\"upload-symbol ${this\n            .status_classes.init}\"/></td></tr>`;\n    }\n});\n"]}