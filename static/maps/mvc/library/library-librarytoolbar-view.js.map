{"version":3,"sources":["mvc/library/library-librarytoolbar-view.js"],"names":["LibraryToolbarView","Backbone","View","extend","el","defaults","search_term","events","click #create_new_library_btn","click #include_deleted_chk","click #exclude_restricted_chk","click .page_size_prompt","keyup .library-search-input","initialize","options","_","this","render","toolbar_template","templateToolBar","is_anonym","Galaxy","user","is_admin","isAdmin","isAnonymous","$el","html","admin_user","anon_user","find","checked","libraries","preferences","get","paginator_template","templatePaginator","show_page","page_count","total_libraries_count","libraries_shown","library_page_size","parseInt","event","modal","show","closing_events","title","body","templateNewLibraryInModal","buttons","Create","createLibraryFromModal","stopPropagation","self","hide","createNewLibrary","Close","serializeNewLibrary","_libraryModel2","default","Library","save","libraryDetails","success","library","libraryListView","collection","add","clearLibraryModal","error","validateNewLibrary","response","responseJSON","err_msg","_toastr2","showPageSizePrompt","e","preventDefault","prompt","set","val","$","description","synopsis","name","includeDeletedChecked","with_deleted","fetchDeleted","without_restricted","searchLibraries","template","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-librarytoolbar-view.js","sourcesContent":["import mod_toastr from \"libs/toastr\";\nimport mod_library_model from \"mvc/library/library-model\";\n/**\n * This view represents the top part of the library page.\n * It contains the tool bar with controls.\n */\nvar LibraryToolbarView = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: {\n        search_term: \"\"\n    },\n\n    events: {\n        \"click #create_new_library_btn\": \"createLibraryFromModal\",\n        \"click #include_deleted_chk\": \"includeDeletedChecked\",\n        \"click #exclude_restricted_chk\": \"excludeRestrictedChecked\",\n        \"click .page_size_prompt\": \"showPageSizePrompt\",\n        \"keyup .library-search-input\": \"searchLibraries\"\n    },\n\n    initialize: function(options) {\n        this.options = _.defaults(this.options || {}, options, this.defaults);\n        this.render();\n    },\n\n    render: function() {\n        var toolbar_template = this.templateToolBar();\n        var is_admin = false;\n        var is_anonym = true;\n        if (Galaxy.user) {\n            is_admin = Galaxy.user.isAdmin();\n            is_anonym = Galaxy.user.isAnonymous();\n        }\n        this.$el.html(toolbar_template({ admin_user: is_admin, anon_user: is_anonym }));\n        if (is_admin) {\n            this.$el.find(\"#include_deleted_chk\")[0].checked = Galaxy.libraries.preferences.get(\"with_deleted\");\n            this.$el.find(\"#exclude_restricted_chk\")[0].checked = Galaxy.libraries.preferences.get(\n                \"without_restricted\"\n            );\n        }\n    },\n\n    /**\n   * Renders the element that shows pages into its div within the toolbar.\n   */\n    renderPaginator: function(options) {\n        this.options = _.extend(this.options, options);\n        var paginator_template = this.templatePaginator();\n        this.$el.find(\"#library_paginator\").html(\n            paginator_template({\n                show_page: parseInt(this.options.show_page),\n                page_count: parseInt(this.options.page_count),\n                total_libraries_count: this.options.total_libraries_count,\n                libraries_shown: this.options.libraries_shown,\n                library_page_size: Galaxy.libraries.preferences.get(\"library_page_size\")\n            })\n        );\n    },\n\n    /**\n   * User clicked on 'New library' button. Show modal to\n   * satisfy the wish.\n   */\n    createLibraryFromModal: function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        var self = this;\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: \"Create New Library\",\n            body: this.templateNewLibraryInModal(),\n            buttons: {\n                Create: function() {\n                    self.createNewLibrary();\n                },\n                Close: function() {\n                    self.modal.hide();\n                }\n            }\n        });\n    },\n\n    /**\n   * Create the new library using the API asynchronously.\n   */\n    createNewLibrary: function() {\n        var libraryDetails = this.serializeNewLibrary();\n        if (this.validateNewLibrary(libraryDetails)) {\n            var library = new mod_library_model.Library();\n            var self = this;\n            library.save(libraryDetails, {\n                success: function(library) {\n                    Galaxy.libraries.libraryListView.collection.add(library);\n                    self.modal.hide();\n                    self.clearLibraryModal();\n                    Galaxy.libraries.libraryListView.render();\n                    mod_toastr.success(\"Library created.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occured.\");\n                    }\n                }\n            });\n        } else {\n            mod_toastr.error(\"Library's name is missing.\");\n        }\n        return false;\n    },\n\n    /**\n   * Show user the propmpt to change the number of libs shown on page.\n   */\n    showPageSizePrompt: function(e) {\n        e.preventDefault();\n        var library_page_size = prompt(\n            \"How many libraries per page do you want to see?\",\n            Galaxy.libraries.preferences.get(\"library_page_size\")\n        );\n        if (library_page_size != null && library_page_size == parseInt(library_page_size)) {\n            Galaxy.libraries.preferences.set({\n                library_page_size: parseInt(library_page_size)\n            });\n            Galaxy.libraries.libraryListView.render({ show_page: 1 });\n        }\n    },\n\n    /**\n   * Clear the library modal once it is saved.\n   */\n    clearLibraryModal: function() {\n        $(\"input[name='Name']\").val(\"\");\n        $(\"input[name='Description']\").val(\"\");\n        $(\"input[name='Synopsis']\").val(\"\");\n    },\n\n    /**\n   * Prepare new library variables to be submitted to API.\n   */\n    serializeNewLibrary: function() {\n        return {\n            name: $(\"input[name='Name']\").val(),\n            description: $(\"input[name='Description']\").val(),\n            synopsis: $(\"input[name='Synopsis']\").val()\n        };\n    },\n\n    /**\n   * Check whether entered values are valid.\n   */\n    validateNewLibrary: function(libraryDetails) {\n        return libraryDetails.name !== \"\";\n    },\n\n    /**\n   * Include or exclude deleted libraries in the view.\n   */\n    includeDeletedChecked: function(event) {\n        if (event.target.checked) {\n            Galaxy.libraries.preferences.set({ with_deleted: true });\n            Galaxy.libraries.libraryListView.fetchDeleted();\n        } else {\n            Galaxy.libraries.preferences.set({ with_deleted: false });\n            Galaxy.libraries.libraryListView.render();\n        }\n    },\n\n    /**\n   * Include or exclude restricted libraries in the view.\n   */\n    excludeRestrictedChecked: function(event) {\n        if (event.target.checked) {\n            Galaxy.libraries.preferences.set({ without_restricted: true });\n        } else {\n            Galaxy.libraries.preferences.set({ without_restricted: false });\n        }\n        Galaxy.libraries.libraryListView.render();\n    },\n\n    /**\n   * Take the contents of the search field and send it to the list view\n   * to query the collection of libraries.\n   */\n    searchLibraries: function(event) {\n        var search_term = $(\".library-search-input\").val();\n        this.options.search_term = search_term;\n        Galaxy.libraries.libraryListView.searchLibraries(search_term);\n    },\n\n    templateToolBar: function() {\n        return _.template(\n            [\n                '<div class=\"library_style_container\">',\n                '<div id=\"toolbar_form\">',\n                '<div id=\"library_toolbar\">',\n                '<form class=\"form-inline\" role=\"form\">',\n                '<span><strong><a href=\"#\" title=\"Go to first page\">DATA LIBRARIES</a></strong></span>',\n                '<span id=\"library_paginator\" class=\"library-paginator\">',\n                // paginator will append here\n                \"</span>\",\n                '<div class=\"form-group toolbar-item\">',\n                '<input type=\"text\" class=\"form-control library-search-input\" placeholder=\"Search\" size=\"30\">',\n                \"</div>\",\n                // only admins see the following\n                \"<% if(admin_user === true) { %>\",\n                '<div class=\"checkbox toolbar-item\" style=\"height: 20px;\">',\n                \"<label>\",\n                '<input id=\"include_deleted_chk\" type=\"checkbox\">',\n                \"include deleted \",\n                \"</input>\",\n                \"</label>\",\n                \"<label>\",\n                '<input id=\"exclude_restricted_chk\" type=\"checkbox\">',\n                \"exclude restricted\",\n                \"</input>\",\n                \"</label>\",\n                \"</div>\",\n                '<span class=\"toolbar-item\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create New Library\">',\n                '<button id=\"create_new_library_btn\" class=\"primary-button btn-xs\" type=\"button\"><span class=\"fa fa-plus\"></span> New Library</button>',\n                \"</span>\",\n                \"<% } %>\",\n                '<span class=\"help-button\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"See this screen annotated\">',\n                '<a href=\"https://galaxyproject.org/data-libraries/screen/list-of-libraries/\" target=\"_blank\">',\n                '<button class=\"primary-button\" type=\"button\"><span class=\"fa fa-question-circle\"></span> Help</button>',\n                \"</a>\",\n                \"</span>\",\n                \"</form>\",\n                \"</div>\",\n                \"</div>\",\n                '<div id=\"libraries_element\">',\n                // table with libraries will append here\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templatePaginator: function() {\n        return _.template(\n            [\n                '<ul class=\"pagination pagination-sm\">',\n                \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } else { %>\",\n                '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li><a href=\"#page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                \"<% } else { %>\", // we are on the first page\n                '<li class=\"disabled\"><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                '<li class=\"active\">',\n                '<a href=\"#page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                \"</li>\",\n                \"<% if ( ( show_page ) < page_count ) { %>\",\n                '<li><a href=\"#page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"disabled\"><a href=\"#page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"disabled\"><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } %>\",\n                \"</ul>\",\n                \"<span>\",\n                ' <%- libraries_shown %> libraries shown <a href=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"currently <%- library_page_size %> per page\" class=\"page_size_prompt\">(change)</a>',\n                \"</span>\",\n                \"<span>\",\n                \" <%- total_libraries_count %> total\",\n                \"</span>\"\n            ].join(\"\")\n        );\n    },\n\n    templateNewLibraryInModal: function() {\n        return _.template(\n            [\n                '<div id=\"new_library_modal\">',\n                \"<form>\",\n                '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                '<input type=\"text\" name=\"Synopsis\" value=\"\" placeholder=\"Synopsis\">',\n                \"</form>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryToolbarView: LibraryToolbarView\n};\n"]}