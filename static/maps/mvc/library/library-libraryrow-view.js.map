{"version":3,"sources":["mvc/library/library-libraryrow-view.js"],"names":["LibraryRowView","Backbone","View","extend","events","click .edit_library_btn","click .cancel_library_btn","click .save_library_btn","click .delete_library_btn","click .undelete_library_btn","edit_mode","element_visibility_config","upload_library_btn","edit_library_btn","permission_library_btn","delete_library_btn","undelete_library_btn","initialize","library","this","render","libraryListView","collection","get","$el","data","save_library_btn","cancel_library_btn","button_config","show","$","tmpl","old_element","replaceWith","find","tooltip","prepareButtons","vis_config","cancel_library_modification","repaint","save_library_modification","edit_button_clicked","libraries","is_changed","new_name","val","length","_toastr2","default","warning","new_description","new_synopsis","set","save","row_view","success","model","response","responseJSON","error","err_msg","info","delete_library","Galaxy","destroy","add","preferences","hide","remove","undelete_library","url","urlRoot","_","template","templateRow","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-libraryrow-view.js","sourcesContent":["// dependencies\nimport mod_masthead from \"layout/masthead\";\nimport mod_utils from \"utils/utils\";\nimport mod_toastr from \"libs/toastr\";\n// galaxy library row view\nvar LibraryRowView = Backbone.View.extend({\n    events: {\n        \"click .edit_library_btn\": \"edit_button_clicked\",\n        \"click .cancel_library_btn\": \"cancel_library_modification\",\n        \"click .save_library_btn\": \"save_library_modification\",\n        \"click .delete_library_btn\": \"delete_library\",\n        \"click .undelete_library_btn\": \"undelete_library\"\n    },\n\n    edit_mode: false,\n\n    element_visibility_config: {\n        upload_library_btn: false,\n        edit_library_btn: false,\n        permission_library_btn: false,\n        save_library_btn: false,\n        cancel_library_btn: false,\n        delete_library_btn: false,\n        undelete_library_btn: false\n    },\n\n    initialize: function(library) {\n        this.render(library);\n    },\n\n    render: function(library) {\n        if (typeof library === \"undefined\") {\n            library = Galaxy.libraries.libraryListView.collection.get(this.$el.data(\"id\"));\n        }\n        this.prepareButtons(library);\n        var tmpl = this.templateRow();\n        this.setElement(\n            tmpl({\n                library: library,\n                button_config: this.element_visibility_config,\n                edit_mode: this.edit_mode\n            })\n        );\n        this.$el.show();\n        return this;\n    },\n\n    repaint: function(library) {\n        /* need to hide manually because of the element removal in setElement\n    invoked in render() */\n        $(\".tooltip\").hide();\n        /* we need to store the old element to be able to replace it with\n    new one */\n        var old_element = this.$el;\n        /* if user canceled the library param is undefined,\n      if user saved and succeeded the updated library is rendered */\n        this.render();\n        old_element.replaceWith(this.$el);\n        /* now we attach new tooltips to the newly created row element */\n        this.$el.find(\"[data-toggle]\").tooltip();\n    },\n\n    /**\n   * Function modifies the visibility of buttons for\n   * the filling of the row template of given library.\n   */\n    prepareButtons: function(library) {\n        var vis_config = this.element_visibility_config;\n\n        if (this.edit_mode === false) {\n            vis_config.save_library_btn = false;\n            vis_config.cancel_library_btn = false;\n            vis_config.delete_library_btn = false;\n            if (library.get(\"deleted\") === true) {\n                vis_config.undelete_library_btn = true;\n                vis_config.upload_library_btn = false;\n                vis_config.edit_library_btn = false;\n                vis_config.permission_library_btn = false;\n            } else if (library.get(\"deleted\") === false) {\n                vis_config.save_library_btn = false;\n                vis_config.cancel_library_btn = false;\n                vis_config.undelete_library_btn = false;\n                if (library.get(\"can_user_add\") === true) {\n                    vis_config.upload_library_btn = true;\n                }\n                if (library.get(\"can_user_modify\") === true) {\n                    vis_config.edit_library_btn = true;\n                }\n                if (library.get(\"can_user_manage\") === true) {\n                    vis_config.permission_library_btn = true;\n                }\n            }\n        } else if (this.edit_mode === true) {\n            vis_config.upload_library_btn = false;\n            vis_config.edit_library_btn = false;\n            vis_config.permission_library_btn = false;\n            vis_config.save_library_btn = true;\n            vis_config.cancel_library_btn = true;\n            vis_config.delete_library_btn = true;\n            vis_config.undelete_library_btn = false;\n        }\n\n        this.element_visibility_config = vis_config;\n    },\n\n    /* User clicked the 'edit' button on row so we render a new row\n    that allows editing */\n    edit_button_clicked: function() {\n        this.edit_mode = true;\n        this.repaint();\n    },\n\n    /* User clicked the 'cancel' button so we render normal rowView */\n    cancel_library_modification: function() {\n        // mod_toastr.info('Modifications canceled');\n        this.edit_mode = false;\n        this.repaint();\n    },\n\n    save_library_modification: function() {\n        var library = Galaxy.libraries.libraryListView.collection.get(this.$el.data(\"id\"));\n        var is_changed = false;\n\n        var new_name = this.$el.find(\".input_library_name\").val();\n        if (typeof new_name !== \"undefined\" && new_name !== library.get(\"name\")) {\n            if (new_name.length > 2) {\n                library.set(\"name\", new_name);\n                is_changed = true;\n            } else {\n                mod_toastr.warning(\"Library name has to be at least 3 characters long.\");\n                return;\n            }\n        }\n\n        var new_description = this.$el.find(\".input_library_description\").val();\n        if (typeof new_description !== \"undefined\" && new_description !== library.get(\"description\")) {\n            library.set(\"description\", new_description);\n            is_changed = true;\n        }\n\n        var new_synopsis = this.$el.find(\".input_library_synopsis\").val();\n        if (typeof new_synopsis !== \"undefined\" && new_synopsis !== library.get(\"synopsis\")) {\n            library.set(\"synopsis\", new_synopsis);\n            is_changed = true;\n        }\n\n        if (is_changed) {\n            var row_view = this;\n            library.save(null, {\n                patch: true,\n                success: function(library) {\n                    row_view.edit_mode = false;\n                    row_view.repaint(library);\n                    mod_toastr.success(\"Changes to library saved.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occured while attempting to update the library.\");\n                    }\n                }\n            });\n        } else {\n            this.edit_mode = false;\n            this.repaint(library);\n            mod_toastr.info(\"Nothing has changed.\");\n        }\n    },\n\n    delete_library: function() {\n        var library = Galaxy.libraries.libraryListView.collection.get(this.$el.data(\"id\"));\n        var row_view = this;\n        // mark the library deleted\n        library.destroy({\n            success: function(library) {\n                library.set(\"deleted\", true);\n                // add the new deleted library back to the collection (Galaxy specialty)\n                Galaxy.libraries.libraryListView.collection.add(library);\n                row_view.edit_mode = false;\n                if (Galaxy.libraries.preferences.get(\"with_deleted\") === false) {\n                    $(\".tooltip\").hide();\n                    row_view.repaint(library);\n                    row_view.$el.remove();\n                } else if (Galaxy.libraries.preferences.get(\"with_deleted\") === true) {\n                    row_view.repaint(library);\n                }\n                mod_toastr.success(\"Library has been marked deleted.\");\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\"An error occured during deleting the library.\");\n                }\n            }\n        });\n    },\n\n    undelete_library: function() {\n        var library = Galaxy.libraries.libraryListView.collection.get(this.$el.data(\"id\"));\n        var row_view = this;\n\n        // mark the library undeleted\n        library.url = `${library.urlRoot + library.id}?undelete=true`;\n        library.destroy({\n            success: function(library) {\n                // add the newly undeleted library back to the collection\n                // backbone does not accept changes through destroy, so update it too\n                library.set(\"deleted\", false);\n                Galaxy.libraries.libraryListView.collection.add(library);\n                row_view.edit_mode = false;\n                row_view.repaint(library);\n                mod_toastr.success(\"Library has been undeleted.\");\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\"An error occured while undeleting the library.\");\n                }\n            }\n        });\n    },\n\n    templateRow: function() {\n        return _.template(\n            [\n                '<tr class=\"<% if(library.get(\"deleted\") === true) { print(\"active\") } %>\" style=\"display:none;\" data-id=\"<%- library.get(\"id\") %>\">',\n                \"<% if(!edit_mode) { %>\",\n                '<% if(library.get(\"deleted\")) { %>',\n                '<td style=\"color:grey;\"><%- library.get(\"name\") %></td>',\n                \"<% } else { %>\",\n                '<td><a href=\"#folders/<%- library.get(\"root_folder_id\") %>\"><%- library.get(\"name\") %></a></td>',\n                \"<% } %>\",\n                '<% if(library.get(\"description\")) { %>',\n                '<% if( (library.get(\"description\")).length> 80 ) { %>',\n                '<td data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"<%= _.escape(library.get(\"description\")) %>\"><%= _.escape(library.get(\"description\")).substring(0, 80) + \"...\" %></td>',\n                \"<% } else { %>\",\n                '<td><%= _.escape(library.get(\"description\"))%></td>',\n                \"<% } %>\",\n                \"<% } else { %>\",\n                \"<td></td>\",\n                \"<% } %>\",\n                '<% if(library.get(\"synopsis\")) { %>',\n                '<% if( (library.get(\"synopsis\")).length> 120 ) { %>',\n                '<td data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"<%= _.escape(library.get(\"synopsis\")) %>\"><%= _.escape(library.get(\"synopsis\")).substring(0, 120) + \"...\" %></td>',\n                \"<% } else { %>\",\n                '<td><%= _.escape(library.get(\"synopsis\"))%></td>',\n                \"<% } %>\",\n                \"<% } else { %>\",\n                \"<td></td>\",\n                \"<% } %>\",\n                \"<% } else if(edit_mode){ %>\",\n                '<td><textarea rows=\"4\" class=\"form-control input_library_name\" placeholder=\"name\" ><%- library.get(\"name\") %></textarea></td>',\n                '<td><textarea rows=\"4\" class=\"form-control input_library_description\" placeholder=\"description\" ><%- library.get(\"description\") %></textarea></td>',\n                '<td><textarea rows=\"4\" class=\"form-control input_library_synopsis\" placeholder=\"synopsis\" ><%- library.get(\"synopsis\") %></textarea></td>',\n                \"<% } %>\",\n                '<td class=\"right-center\">',\n                '<% if( (library.get(\"public\")) && (library.get(\"deleted\") === false) ) { %>',\n                '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Unrestricted library\" style=\"color:grey;\" class=\"fa fa-globe fa-lg\"> </span>',\n                \"<% }%>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Modify \\'<%- library.get(\"name\") %>\\'\" class=\"primary-button btn-xs edit_library_btn\" type=\"button\" style=\"<% if(button_config.edit_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-pencil\"></span> Edit</button>',\n                '<a href=\"#library/<%- library.get(\"id\") %>/permissions\"><button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Permissions of \\'<%- library.get(\"name\") %>\\'\" class=\"primary-button btn-xs permission_library_btn\" type=\"button\" style=\"<% if(button_config.permission_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-group\"></span> Manage</button></a>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save changes\" class=\"primary-button btn-xs save_library_btn\" type=\"button\" style=\"<% if(button_config.save_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-floppy-o\"></span> Save</button>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Discard changes\" class=\"primary-button btn-xs cancel_library_btn\" type=\"button\" style=\"<% if(button_config.cancel_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-times\"></span> Cancel</button>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Delete \\'<%- library.get(\"name\") %>\\'\" class=\"primary-button btn-xs delete_library_btn\" type=\"button\" style=\"<% if(button_config.delete_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-trash-o\"></span> Delete</button>',\n                // For deleted libraries\n                '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Marked deleted\" style=\"color:grey; <% if(button_config.undelete_library_btn === false) { print(\"display:none;\") } %>\" class=\"fa fa-ban fa-lg\"></span>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Undelete \\'<%- library.get(\"name\") %>\\' \" class=\"primary-button btn-xs undelete_library_btn\" type=\"button\" style=\"<% if(button_config.undelete_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-unlock\"></span> Undelete</button>',\n                \"</td>\",\n                \"</tr>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryRowView: LibraryRowView\n};\n"]}