{"version":3,"sources":["mvc/toolshed/repositories-view.js"],"names":["ToolShedCategoryContentsView","Backbone","View","extend","el","initialize","params","this","model","_toolshedModel2","default","CategoryCollection","listenTo","render","shed","tool_shed","replace","url","category_id","category","fetch","options","_","category_contents_template","templateCategoryContents","models","$","bindEvents","that","source","queue","term","request","tool_shed_url","shed_url","post","base_url","data","result_list","_util2","shedParser","response","select","tsr_id","Galaxy","new_route","minLength","trigger","reDraw","Category","join"],"mappings":"iRAGIA,EAA+BC,SAASC,KAAKC,QAC7CC,GAAI,UAEJC,WAAY,SAASC,GAEjBC,KAAKC,MAAQ,IAAIC,EAAAC,QAAeC,mBAChCJ,KAAKK,SAASL,KAAKC,MAAO,OAAQD,KAAKM,QACvC,IAAIC,EAAOR,EAAOS,UAAUC,QAAQ,MAAO,OAC3CT,KAAKC,MAAMS,KAAX,kBAAoCH,EAApC,gBAAwDR,EAAOY,YAC/DX,KAAKC,MAAMO,UAAYD,EACvBP,KAAKC,MAAMW,SAAWb,EAAOY,YAC7BX,KAAKC,MAAMY,SAXnBP,OAAIb,SAAAA,GACAI,KAAIiB,QADgDC,EAAAnB,OAAAI,KAAAc,QAAAA,GAgBhD,IAAIE,EAA6BhB,KAAKiB,yBAb1CnB,KAAAA,IAAAA,KACIkB,GACAJ,SAAaZ,KAAIC,MAAAiB,OAAA,GACjBV,UAAcR,KAAKC,MAAOO,UACtBD,MAAOR,EAAAA,QAAOS,iBAGlBW,EAAA,WAAKlB,IAAMW,WAAWb,QACtBC,KAAAoB,cAGJd,WAAQ,WACJ,IAAAe,EAAKP,KACLK,EAAA,eAAIH,cACJM,OAAA,SACIN,EAAAA,GACIJ,IAAAA,EAAeX,EAALA,MAAWiB,UADET,QAAA,OAAA,KAEvBD,EAAgBP,OAAMO,KAAtBA,uBACAe,GAJRC,KAAAC,EAAAD,KAOEE,cAAeC,GAxB+BR,EAAAS,KAAAC,EAAA9B,EAAA,SAAA+B,GAuCpC,IAAIC,EAAcC,EAAA7B,QAAc8B,WAAWH,GAX/CI,EAAAH,MAGJT,UAAAA,EACIa,OAAA,SAAIR,EAAWN,GACf,IAAAe,EAAIP,EAAAA,KAAcQ,MAClBC,EAAAA,gBAAajB,EAAApB,MAAAO,UAAb,MAAa4B,EACTZ,SAAAA,QAAMC,SADGa,GAETZ,SAAAA,EAFSjB,SAAb,QASJ8B,OAAAA,SAAAA,GACAJ,KAAAA,IAAAA,QACInC,KAAAF,WAAIsC,IAGAI,yBAAAA,EAAAA,UADiC,0BAIxC,+CArByB,6CA9BkB,WAkE5C,yEAXRC,4FACI,wJACA,SAzDgD,0DAuE5C,+DAXRxB,4BA5DJ,8LA0EY,UACA,SA+BRyB,8CA7BQ,uBACA,iCACA,OACA,qCACA,oCACA,oBACA,oCACA,QACA,WACA,oEACA,OACA,mCACA,OACA,wEACA,8FACA,SACA,QACA,yCACA,kCACA,QACA,YACA,WACA,SACA,UACFC,KAAK,kBAKXD,SAAUjD","file":"../../../scripts/mvc/toolshed/repositories-view.js","sourcesContent":["import toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nimport \"libs/jquery/jquery-ui\";\nvar ToolShedCategoryContentsView = Backbone.View.extend({\n    el: \"#center\",\n\n    initialize: function(params) {\n        var self = this;\n        this.model = new toolshed_model.CategoryCollection();\n        this.listenTo(this.model, \"sync\", this.render);\n        var shed = params.tool_shed.replace(/\\//g, \"%2f\");\n        this.model.url += `?tool_shed_url=${shed}&category_id=${params.category_id}`;\n        this.model.tool_shed = shed;\n        this.model.category = params.category_id;\n        this.model.fetch();\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var category_contents_template = this.templateCategoryContents;\n        this.$el.html(\n            category_contents_template({\n                category: this.model.models[0],\n                tool_shed: this.model.tool_shed,\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        var that = this;\n        $(\"#search_box\").autocomplete({\n            source: function(request, response) {\n                var shed_url = that.model.tool_shed.replace(/%2f/g, \"/\");\n                var base_url = `${Galaxy.root}api/tool_shed/search`;\n                var params = {\n                    term: request.term,\n                    tool_shed_url: shed_url\n                };\n                $.post(base_url, params, data => {\n                    var result_list = toolshed_util.shedParser(data);\n                    response(result_list);\n                });\n            },\n            minLength: 3,\n            select: function(event, ui) {\n                var tsr_id = ui.item.value;\n                var new_route = `repository/s/${that.model.tool_shed}/r/${tsr_id}`;\n                Backbone.history.navigate(new_route, {\n                    trigger: true,\n                    replace: true\n                });\n            }\n        });\n    },\n\n    reDraw: function(options) {\n        this.$el.empty();\n        this.initialize(options);\n    },\n\n    templateCategoryContents: _.template(\n        [\n            '<style type=\"text/css\">',\n            \".ui-autocomplete { background-color: #fff; }\",\n            \"li.ui-menu-item { list-style-type: none; }\",\n            \"</style>\",\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\">Repositories in <%= category.get(\"name\") %></div>',\n            '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<div class=\"unified-panel-body\" id=\"list_repositories\">',\n            '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n            '<span class=\"ui-widget\" >',\n            '<input class=\"search-box-input\" id=\"search_box\" name=\"search\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n            \"</span>\",\n            \"</div>\",\n            '<div style=\"clear: both; margin-top: 1em;\">',\n            '<table class=\"grid\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th style=\"width: 10%;\">Owner</th>',\n            '<th style=\"width: 15%;\">Name</th>',\n            \"<th>Synopsis</th>\",\n            '<th style=\"width: 10%;\">Type</th>',\n            \"</tr>\",\n            \"</thead>\",\n            '<% _.each(category.get(\"repositories\"), function(repository) { %>',\n            \"<tr>\",\n            \"<td><%= repository.owner %></td>\",\n            \"<td>\",\n            '<div style=\"float: left; margin-left: 1px;\" class=\"menubutton split\">',\n            '<a href=\"#/repository/s/<%= tool_shed %>/r/<%= repository.id %>\"><%= repository.name %></a>',\n            \"</div>\",\n            \"</td>\",\n            \"<td><%= repository.description %></td>\",\n            \"<td><%= repository.type %></td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</table>\",\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    Category: ToolShedCategoryContentsView\n};\n"]}