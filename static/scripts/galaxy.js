define("galaxy",["exports","libs/underscore","libs/backbone","mvc/base-mvc","mvc/user/user-model","utils/metrics-logger","utils/add-logging","utils/localization"],function(e,t,o,r,a,n,i,l){"use strict";function g(e){return e&&e.__esModule?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function u(e,t){return this._init(e||{},t||{})}Object.defineProperty(e,"__esModule",{value:!0});var c=s(t),p=s(o),f=g(r),d=g(a),y=g(n),b=g(i),v=g(l);(0,b.default)(u,"GalaxyApp");var m="galaxy:debug:namespaces",_=!1;try{_="true"==localStorage.getItem("galaxy:debug")}catch(e){console.log((0,v.default)("localStorage not available for debug flag retrieval"))}u.prototype._init=function(e,t){var o=this;return c.extend(o,p.Events),_&&(o.logger=console,console.debug("debugging galaxy:","options:",e,"bootstrapped:",t)),o._processOptions(e),o.root=e.root||"/",o.params=e.params||{},o.session_csrf_token=e.session_csrf_token||null,o._initConfig(e.config||{}),o._patchGalaxy(window.Galaxy),o._initLogger(o.options.loggerOptions||{}),o.debug("GalaxyApp.options: ",o.options),o.debug("GalaxyApp.config: ",o.config),o.debug("GalaxyApp.logger: ",o.logger),o._initLocale(),o.debug("GalaxyApp.localize: ",o.localize),o.config=e.config||{},o.debug("GalaxyApp.config: ",o.config),o._initUser(e.user||{}),o.debug("GalaxyApp.user: ",o.user),o._setUpListeners(),o.trigger("ready",o),o},u.prototype.defaultOptions={patchExisting:!0,root:"/",session_csrf_token:null},u.prototype._processOptions=function(e){var t=this,o=t.defaultOptions;t.options={};for(var r in o)o.hasOwnProperty(r)&&(t.options[r]=e.hasOwnProperty(r)?e[r]:o[r]);return t},u.prototype._initConfig=function(e){var t=this;return t.config=e,t.config.debug=_||t.config.debug,t},u.prototype._patchGalaxy=function(e){var t=this;if(t.options.patchExisting&&e)for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},u.prototype._initLogger=function(e){var t=this;if(t.config.debug){e.consoleLogger=e.consoleLogger||console,e.consoleLevel=e.consoleLevel||y.default.MetricsLogger.ALL;try{e.consoleNamespaceWhitelist=localStorage.getItem(m).split(",")}catch(e){}}return t.logger=new y.default.MetricsLogger(e),t.emit={},["log","debug","info","warn","error","metric"].map(function(e){t.emit[e]=function(o){t.logger.emit(e,arguments[0],Array.prototype.slice.call(arguments,1))}}),t.config.debug&&(f.default.LoggableMixin.logger=t.logger),t},u.prototype._initLocale=function(e){var t=this;return t.debug("_initLocale:",e),t.localize=v.default,window._l=t.localize,t},u.prototype._initUser=function(e){var t=this;return t.debug("_initUser:",e),t.user=new d.default.User(e),t.user.logger=t.logger,t},u.prototype._setUpListeners=function(){var e=this;return e.lastAjax={},$(document).bind("ajaxSend",function(t,o,r){var a=r.data;try{a=JSON.parse(a)}catch(e){}e.lastAjax={url:location.href.slice(0,-1)+r.url,data:a}}),e},u.prototype.debugging=function(e){var t=this;try{if(void 0===e)return"true"===localStorage.getItem("galaxy:debug");if(e)return localStorage.setItem("galaxy:debug",!0),!0;localStorage.removeItem("galaxy:debug"),t.debuggingNamespaces(null)}catch(e){console.log((0,v.default)("localStorage not available for debug flag retrieval"))}return!1},u.prototype.debuggingNamespaces=function(e){var t=this;try{if(void 0===e){var o=localStorage.getItem(m);return"string"==typeof o?o.split(","):[]}null===e?localStorage.removeItem(m):localStorage.setItem(m,e);var r=t.debuggingNamespaces();return t.logger&&(t.logger.options.consoleNamespaceWhitelist=r),r}catch(e){console.log((0,v.default)("localStorage not available for debug namespace retrieval"))}},u.prototype.toString=function(){return"GalaxyApp("+(this.user?this.user.get("email")||"(anonymous)":"uninitialized")+")"},e.default={GalaxyApp:u}});
//# sourceMappingURL=../maps/galaxy.js.map
