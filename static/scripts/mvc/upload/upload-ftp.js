define("mvc/upload/upload-ftp",["exports","utils/utils"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(t){return t&&t.__esModule?t:{default:t}}(e);t.default=Backbone.View.extend({initialize:function(t){this.model=new Backbone.Model({cls:"upload-ftp",class_add:"upload-icon-button fa fa-square-o",class_remove:"upload-icon-button fa fa-check-square-o",class_partial:"upload-icon-button fa fa-minus-square-o",help_enabled:!0,help_text:"This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>"+t.ftp_upload_site+"</strong> using your Galaxy credentials.",collection:null,onchange:function(){},onadd:function(){},onremove:function(){}}).set(t),this.collection=this.model.get("collection"),this.setElement(this._template()),this.$content=this.$(".upload-ftp-content"),this.$wait=this.$(".upload-ftp-wait"),this.$help=this.$(".upload-ftp-help"),this.$number=this.$(".upload-ftp-number"),this.$disk=this.$(".upload-ftp-disk"),this.$body=this.$(".upload-ftp-body"),this.$warning=this.$(".upload-ftp-warning"),this.$select=this.$(".upload-ftp-select-all"),this.render()},render:function(){var t=this;this.$wait.show(),this.$content.hide(),this.$warning.hide(),this.$help.hide(),$.ajax({url:Galaxy.root+"api/remote_files",method:"GET",success:function(e){t.model.set("ftp_files",e),t._index(),t._renderTable()},error:function(){t._renderTable()}})},_renderTable:function(){var t=this,e=this.model.get("ftp_files");if(this.rows=[],e&&e.length>0){this.$body.empty();var i=0;_.each(e,function(e){t.rows.push(t._renderRow(e)),i+=e.size}),this.$number.html(e.length+" files"),this.$disk.html(s.default.bytesToString(i,!0)),this.collection&&(this.$("._has_collection").show(),this.$select.addClass(this.model.get("class_add")).off().on("click",function(){t._all()}),this._refresh()),this.$content.show()}else this.$warning.show();this.model.get("help_enabled")&&this.$help.show(),this.$wait.hide()},_renderRow:function(t){var e=this,s=this.model.attributes,i=$(this._templateRow(t)),a=i.find(".icon");if(this.$body.append(i),this.collection){var l=this.ftp_index[t.path];a.addClass(void 0===l?s.class_add:s.class_remove),i.on("click",function(){e._switch(a,t),e._refresh()})}else i.on("click",function(){s.onchange(t)});return a},_index:function(){var t=this;this.ftp_index={},this.collection&&this.collection.each(function(e){"ftp"==e.get("file_mode")&&(t.ftp_index[e.get("file_path")]=e.id)})},_all:function(){var t=this.model.attributes,e=this.model.get("ftp_files"),s=this.$select.hasClass(t.class_add);for(var i in e){var a=e[i],l=this.ftp_index[a.path];(void 0===l&&s||void 0!==l&&!s)&&this._switch(this.rows[i],a)}this._refresh()},_switch:function(t,e){t.removeClass();var s=this.model.attributes,i=this.ftp_index[e.path];if(void 0===i){var a=s.onadd(e);t.addClass(s.class_remove),this.ftp_index[e.path]=a}else s.onremove(i),t.addClass(s.class_add),this.ftp_index[e.path]=void 0},_refresh:function(){var t=_.reduce(this.ftp_index,function(t,e){return void 0!==e&&t++,t},0);this.$select.removeClass(),0==t?this.$select.addClass(this.model.get("class_add")):this.$select.addClass(t==this.rows.length?this.model.get("class_remove"):this.model.get("class_partial"))},_templateRow:function(t){return'<tr class="upload-ftp-row"><td class="_has_collection" style="display: none;"><div class="icon"/></td><td class="ftp-name">'+_.escape(t.path)+'</td><td class="ftp-size">'+s.default.bytesToString(t.size)+'</td><td class="ftp-time">'+t.ctime+"</td></tr>"},_template:function(){return'<div class="'+this.model.get("cls")+'"><div class="upload-ftp-wait fa fa-spinner fa-spin"/><div class="upload-ftp-help">'+this.model.get("help_text")+'</div><div class="upload-ftp-content"><span style="whitespace: nowrap; float: left;">Available files: </span><span style="whitespace: nowrap; float: right;"><span class="upload-icon fa fa-file-text-o"/><span class="upload-ftp-number"/>&nbsp;&nbsp;<span class="upload-icon fa fa-hdd-o"/><span class="upload-ftp-disk"/></span><table class="grid" style="float: left;"><thead><tr><th class="_has_collection" style="display: none;"><div class="upload-ftp-select-all"></th><th>Name</th><th>Size</th><th>Created</th></tr></thead><tbody class="upload-ftp-body"/></table></div><div class="upload-ftp-warning warningmessage">Your FTP directory does not contain any files.</div>'}})});
//# sourceMappingURL=../../../maps/mvc/upload/upload-ftp.js.map
